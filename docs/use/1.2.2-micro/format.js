window.storyFormat({"source":"<!DOCTYPE html><html><head><title>{{STORY_NAME}}</title><meta charset=\"utf-8\"><meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"><style>.fade-in{animation:fade-in 1s ease-out forwards;opacity:0}.fade-out{animation:fade-in 1s ease-out reverse forwards}.skip-animation{animation-delay:0s!important}@keyframes fade-in{0%{opacity:0}to{opacity:1}}\n#page .warnings{list-style-type:none;margin-left:0;padding-left:0}\n:root{--oc-white:#fff;--oc-white-rgb:255,255,255;--oc-black:#000;--oc-black-rgb:0,0,0;--oc-gray-0:#f8f9fa;--oc-gray-0-rgb:248,249,250;--oc-gray-1:#f1f3f5;--oc-gray-1-rgb:241,243,245;--oc-gray-2:#e9ecef;--oc-gray-2-rgb:233,236,239;--oc-gray-3:#dee2e6;--oc-gray-3-rgb:222,226,230;--oc-gray-4:#ced4da;--oc-gray-4-rgb:206,212,218;--oc-gray-5:#adb5bd;--oc-gray-5-rgb:173,181,189;--oc-gray-6:#868e96;--oc-gray-6-rgb:134,142,150;--oc-gray-7:#495057;--oc-gray-7-rgb:73,80,87;--oc-gray-8:#343a40;--oc-gray-8-rgb:52,58,64;--oc-gray-9:#212529;--oc-gray-9-rgb:33,37,41;--oc-red-0:#fff5f5;--oc-red-0-rgb:255,245,245;--oc-red-1:#ffe3e3;--oc-red-1-rgb:255,227,227;--oc-red-2:#ffc9c9;--oc-red-2-rgb:255,201,201;--oc-red-3:#ffa8a8;--oc-red-3-rgb:255,168,168;--oc-red-4:#ff8787;--oc-red-4-rgb:255,135,135;--oc-red-5:#ff6b6b;--oc-red-5-rgb:255,107,107;--oc-red-6:#fa5252;--oc-red-6-rgb:250,82,82;--oc-red-7:#f03e3e;--oc-red-7-rgb:240,62,62;--oc-red-8:#e03131;--oc-red-8-rgb:224,49,49;--oc-red-9:#c92a2a;--oc-red-9-rgb:201,42,42;--oc-pink-0:#fff0f6;--oc-pink-0-rgb:255,240,246;--oc-pink-1:#ffdeeb;--oc-pink-1-rgb:255,222,235;--oc-pink-2:#fcc2d7;--oc-pink-2-rgb:252,194,215;--oc-pink-3:#faa2c1;--oc-pink-3-rgb:250,162,193;--oc-pink-4:#f783ac;--oc-pink-4-rgb:247,131,172;--oc-pink-5:#f06595;--oc-pink-5-rgb:240,101,149;--oc-pink-6:#e64980;--oc-pink-6-rgb:230,73,128;--oc-pink-7:#d6336c;--oc-pink-7-rgb:214,51,108;--oc-pink-8:#c2255c;--oc-pink-8-rgb:194,37,92;--oc-pink-9:#a61e4d;--oc-pink-9-rgb:166,30,77;--oc-grape-0:#f8f0fc;--oc-grape-0-rgb:248,240,252;--oc-grape-1:#f3d9fa;--oc-grape-1-rgb:243,217,250;--oc-grape-2:#eebefa;--oc-grape-2-rgb:238,190,250;--oc-grape-3:#e599f7;--oc-grape-3-rgb:229,153,247;--oc-grape-4:#da77f2;--oc-grape-4-rgb:218,119,242;--oc-grape-5:#cc5de8;--oc-grape-5-rgb:204,93,232;--oc-grape-6:#be4bdb;--oc-grape-6-rgb:190,75,219;--oc-grape-7:#ae3ec9;--oc-grape-7-rgb:174,62,201;--oc-grape-8:#9c36b5;--oc-grape-8-rgb:156,54,181;--oc-grape-9:#862e9c;--oc-grape-9-rgb:134,46,156;--oc-violet-0:#f3f0ff;--oc-violet-0-rgb:243,240,255;--oc-violet-1:#e5dbff;--oc-violet-1-rgb:229,219,255;--oc-violet-2:#d0bfff;--oc-violet-2-rgb:208,191,255;--oc-violet-3:#b197fc;--oc-violet-3-rgb:177,151,252;--oc-violet-4:#9775fa;--oc-violet-4-rgb:151,117,250;--oc-violet-5:#845ef7;--oc-violet-5-rgb:132,94,247;--oc-violet-6:#7950f2;--oc-violet-6-rgb:121,80,242;--oc-violet-7:#7048e8;--oc-violet-7-rgb:112,72,232;--oc-violet-8:#6741d9;--oc-violet-8-rgb:103,65,217;--oc-violet-9:#5f3dc4;--oc-violet-9-rgb:95,61,196;--oc-indigo-0:#edf2ff;--oc-indigo-0-rgb:237,242,255;--oc-indigo-1:#dbe4ff;--oc-indigo-1-rgb:219,228,255;--oc-indigo-2:#bac8ff;--oc-indigo-2-rgb:186,200,255;--oc-indigo-3:#91a7ff;--oc-indigo-3-rgb:145,167,255;--oc-indigo-4:#748ffc;--oc-indigo-4-rgb:116,143,252;--oc-indigo-5:#5c7cfa;--oc-indigo-5-rgb:92,124,250;--oc-indigo-6:#4c6ef5;--oc-indigo-6-rgb:76,110,245;--oc-indigo-7:#4263eb;--oc-indigo-7-rgb:66,99,235;--oc-indigo-8:#3b5bdb;--oc-indigo-8-rgb:59,91,219;--oc-indigo-9:#364fc7;--oc-indigo-9-rgb:54,79,199;--oc-blue-0:#e7f5ff;--oc-blue-0-rgb:231,245,255;--oc-blue-1:#d0ebff;--oc-blue-1-rgb:208,235,255;--oc-blue-2:#a5d8ff;--oc-blue-2-rgb:165,216,255;--oc-blue-3:#74c0fc;--oc-blue-3-rgb:116,192,252;--oc-blue-4:#4dabf7;--oc-blue-4-rgb:77,171,247;--oc-blue-5:#339af0;--oc-blue-5-rgb:51,154,240;--oc-blue-6:#228be6;--oc-blue-6-rgb:34,139,230;--oc-blue-7:#1c7ed6;--oc-blue-7-rgb:28,126,214;--oc-blue-8:#1971c2;--oc-blue-8-rgb:25,113,194;--oc-blue-9:#1864ab;--oc-blue-9-rgb:24,100,171;--oc-cyan-0:#e3fafc;--oc-cyan-0-rgb:227,250,252;--oc-cyan-1:#c5f6fa;--oc-cyan-1-rgb:197,246,250;--oc-cyan-2:#99e9f2;--oc-cyan-2-rgb:153,233,242;--oc-cyan-3:#66d9e8;--oc-cyan-3-rgb:102,217,232;--oc-cyan-4:#3bc9db;--oc-cyan-4-rgb:59,201,219;--oc-cyan-5:#22b8cf;--oc-cyan-5-rgb:34,184,207;--oc-cyan-6:#15aabf;--oc-cyan-6-rgb:21,170,191;--oc-cyan-7:#1098ad;--oc-cyan-7-rgb:16,152,173;--oc-cyan-8:#0c8599;--oc-cyan-8-rgb:12,133,153;--oc-cyan-9:#0b7285;--oc-cyan-9-rgb:11,114,133;--oc-teal-0:#e6fcf5;--oc-teal-0-rgb:230,252,245;--oc-teal-1:#c3fae8;--oc-teal-1-rgb:195,250,232;--oc-teal-2:#96f2d7;--oc-teal-2-rgb:150,242,215;--oc-teal-3:#63e6be;--oc-teal-3-rgb:99,230,190;--oc-teal-4:#38d9a9;--oc-teal-4-rgb:56,217,169;--oc-teal-5:#20c997;--oc-teal-5-rgb:32,201,151;--oc-teal-6:#12b886;--oc-teal-6-rgb:18,184,134;--oc-teal-7:#0ca678;--oc-teal-7-rgb:12,166,120;--oc-teal-8:#099268;--oc-teal-8-rgb:9,146,104;--oc-teal-9:#087f5b;--oc-teal-9-rgb:8,127,91;--oc-green-0:#ebfbee;--oc-green-0-rgb:235,251,238;--oc-green-1:#d3f9d8;--oc-green-1-rgb:211,249,216;--oc-green-2:#b2f2bb;--oc-green-2-rgb:178,242,187;--oc-green-3:#8ce99a;--oc-green-3-rgb:140,233,154;--oc-green-4:#69db7c;--oc-green-4-rgb:105,219,124;--oc-green-5:#51cf66;--oc-green-5-rgb:81,207,102;--oc-green-6:#40c057;--oc-green-6-rgb:64,192,87;--oc-green-7:#37b24d;--oc-green-7-rgb:55,178,77;--oc-green-8:#2f9e44;--oc-green-8-rgb:47,158,68;--oc-green-9:#2b8a3e;--oc-green-9-rgb:43,138,62;--oc-lime-0:#f4fce3;--oc-lime-0-rgb:244,252,227;--oc-lime-1:#e9fac8;--oc-lime-1-rgb:233,250,200;--oc-lime-2:#d8f5a2;--oc-lime-2-rgb:216,245,162;--oc-lime-3:#c0eb75;--oc-lime-3-rgb:192,235,117;--oc-lime-4:#a9e34b;--oc-lime-4-rgb:169,227,75;--oc-lime-5:#94d82d;--oc-lime-5-rgb:148,216,45;--oc-lime-6:#82c91e;--oc-lime-6-rgb:130,201,30;--oc-lime-7:#74b816;--oc-lime-7-rgb:116,184,22;--oc-lime-8:#66a80f;--oc-lime-8-rgb:102,168,15;--oc-lime-9:#5c940d;--oc-lime-9-rgb:92,148,13;--oc-yellow-0:#fff9db;--oc-yellow-0-rgb:255,249,219;--oc-yellow-1:#fff3bf;--oc-yellow-1-rgb:255,243,191;--oc-yellow-2:#ffec99;--oc-yellow-2-rgb:255,236,153;--oc-yellow-3:#ffe066;--oc-yellow-3-rgb:255,224,102;--oc-yellow-4:#ffd43b;--oc-yellow-4-rgb:255,212,59;--oc-yellow-5:#fcc419;--oc-yellow-5-rgb:252,196,25;--oc-yellow-6:#fab005;--oc-yellow-6-rgb:250,176,5;--oc-yellow-7:#f59f00;--oc-yellow-7-rgb:245,159,0;--oc-yellow-8:#f08c00;--oc-yellow-8-rgb:240,140,0;--oc-yellow-9:#e67700;--oc-yellow-9-rgb:230,119,0;--oc-orange-0:#fff4e6;--oc-orange-0-rgb:255,244,230;--oc-orange-1:#ffe8cc;--oc-orange-1-rgb:255,232,204;--oc-orange-2:#ffd8a8;--oc-orange-2-rgb:255,216,168;--oc-orange-3:#ffc078;--oc-orange-3-rgb:255,192,120;--oc-orange-4:#ffa94d;--oc-orange-4-rgb:255,169,77;--oc-orange-5:#ff922b;--oc-orange-5-rgb:255,146,43;--oc-orange-6:#fd7e14;--oc-orange-6-rgb:253,126,20;--oc-orange-7:#f76707;--oc-orange-7-rgb:247,103,7;--oc-orange-8:#e8590c;--oc-orange-8-rgb:232,89,12;--oc-orange-9:#d9480f;--oc-orange-9-rgb:217,72,15;--page-margin:1em;--page-width:40em;--font-monospaced:\"Courier New\",\"Courier\",monospace;--font-system:-apple-system,BlinkMacSystemFont,\"Segoe UI\",Roboto,Oxygen-Sans,Ubuntu Cantarell,\"Helvetica Neue\",sans-serif}.small-caps{font-size:70%;letter-spacing:.075em;text-transform:uppercase}#backdrop{align-items:center;min-height:100vh}#backdrop,#page{display:flex;justify-content:center}#page{flex-direction:column;line-height:150%;margin:var(--page-margin);max-width:calc(100vw - 2em);min-height:calc(100vh - var(--page-margin)*2);padding:4em 4em 2em;position:relative;width:var(--page-width)}#page article{display:flex;flex-grow:1}#page article>:first-child{margin-top:0;width:100%}#page footer,#page header{display:flex}#page footer>div,#page header>div{flex-grow:1}#page footer p,#page header p{margin:.5em 0 0}#page footer .center,#page header .center{text-align:center}#page footer .right p,#page header .right p{text-align:right}#page header{margin-top:0}#page header.has-content{border-bottom:1px solid #000}#page header.has-content+article>article>div>p:first-child,#page header.has-content+article>div>p:first-child{margin-top:1em}#page footer{margin-bottom:0}#page footer.has-content{border-top:1px solid #000}#page hr{border:none}#page hr:after{content:\"*  *  *\";display:block;text-align:center}#page .error,#page .warning{background:var(--oc-red-0);border-left:4px solid var(--oc-red-3);color:var(--oc-red-9);margin-bottom:1em;overflow:auto;padding:.5em;position:relative}#page .error :first-child,#page .warning :first-child{margin-top:0}#page .error :last-child,#page .warning :last-child{margin-bottom:0}#page .error a,#page .warning a{color:var(--oc-red-9)}#page .warning{background:var(--oc-yellow-0)}#page .warning,#page .warning a{color:var(--oc-yellow-9)}#page .fork p{display:flex;flex-direction:column;width:100%}#page .fork p a{display:block;flex-grow:1;padding:.5em;text-align:center}@media screen and (max-width:768px){#page{margin:0;max-width:100vw;min-height:100vh;padding:1em;width:100vw}}#spinner{bottom:0;opacity:0;pointer-events:none;position:absolute;right:0;transition:opacity .25s ease-in-out}#spinner.visible{display:block;opacity:1}.connection-client{border-top:1px solid #000;padding:.5rem 0}#session-id{margin-right:.5rem}#host-game{margin-right:.625rem}#session-label{margin-right:.5rem}\n*{box-sizing:border-box}body{margin:0;padding:0}img{height:auto;max-width:100%}input[type=text],select{padding:.25em}pre{white-space:pre-wrap}tw-storydata{display:none}</style></head><body></body><html></html><head></head><body><form id=\"cb-validation\" action=\"javascript:void(0)\"><button id=\"cb-validation-tester\" hidden=\"\"></button><button id=\"cb-block-enter-key\" hidden=\"\"></button><div id=\"backdrop\"><div id=\"page\" aria-live=\"polite\"><header><div class=\"left\"></div><div class=\"center\"></div><div class=\"right\"></div></header><article></article><ul class=\"warnings\"></ul><article class=\"connection-client\"><div class=\"connection-client_host\"><button id=\"host-game\" type=\"button\">Host</button><button id=\"join-game\" type=\"button\">Join</button></div><div class=\"connection-client_client\" id=\"session-connection\"><label id=\"session-label\" for=\"session-id\">Session ID:</label><input id=\"session-id\" type=\"text\"></div><div class=\"connection-client_status\" id=\"connection-status\">Not Connected</div></article><footer><div class=\"left\"></div><div class=\"center\"></div><div class=\"right\"></div></footer><div id=\"spinner\"><svg xmlns=\"http://www.w3.org/2000/svg\"\n    xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 100 100\">\n    <rect x=\"31\" y=\"14\" width=\"38\" height=\"72\" rx=\"4\" fill=\"white\" />\n    <circle cx=\"50\" cy=\"50\" r=\"28\" fill=\"white\" />\n\t<rect x=\"35\" y=\"18\" width=\"30\" height=\"64\" rx=\"4\" fill=\"white\" stroke-width=\"2px\" stroke=\"black\" />\n    <circle cx=\"50\" cy=\"50\" r=\"20\" stroke=\"black\" fill=\"white\" stroke-width=\"2px\" />\n\t<line x1=\"50\" y1=\"50\" x2=\"50\" y2=\"37\" stroke=\"black\" stroke-width=\"2px\" stroke-linecap=\"round\">\n        <animateTransform\n            attributeName=\"transform\"\n            begin=\"0s\"\n            dur=\"20s\"\n            type=\"rotate\"\n            from=\"0 50 50\"\n            to=\"360 50 50\"\n            repeatCount=\"indefinite\"\n        />\n\t</line>\n\t<line x1=\"50\" y1=\"50\" x2=\"42\" y2=\"50\" stroke=\"black\" stroke-width=\"2px\" stroke-linecap=\"round\">\n        <animateTransform\n            attributeName=\"transform\"\n            begin=\"0s\"\n            dur=\"120s\"\n            type=\"rotate\"\n            from=\"0 50 50\"\n            to=\"360 50 50\"\n            repeatCount=\"indefinite\"\n        />\n\t</line>\n</svg></div></div></div></form>{{STORY_DATA}}<script>!function(e){\"use strict\";function t(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if(\"default\"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var n=t(e),r=\"undefined\"!=typeof globalThis?globalThis:\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:{};function o(e){if(e.__esModule)return e;var t=Object.defineProperty({},\"__esModule\",{value:!0});return Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})})),t}var i=\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{};function a(){throw new Error(\"setTimeout has not been defined\")}function s(){throw new Error(\"clearTimeout has not been defined\")}var c=a,l=s;function u(e){if(c===setTimeout)return setTimeout(e,0);if((c===a||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(t){try{return c.call(null,e,0)}catch(t){return c.call(this,e,0)}}}\"function\"==typeof i.setTimeout&&(c=setTimeout),\"function\"==typeof i.clearTimeout&&(l=clearTimeout);var p,d=[],f=!1,h=-1;function m(){f&&p&&(f=!1,p.length?d=p.concat(d):h=-1,d.length&&g())}function g(){if(!f){var e=u(m);f=!0;for(var t=d.length;t;){for(p=d,d=[];++h<t;)p&&p[h].run();h=-1,t=d.length}p=null,f=!1,function(e){if(l===clearTimeout)return clearTimeout(e);if((l===s||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(e);try{l(e)}catch(t){try{return l.call(null,e)}catch(t){return l.call(this,e)}}}(e)}}function y(e,t){this.fun=e,this.array=t}y.prototype.run=function(){this.fun.apply(null,this.array)};function v(){}var b=v,w=v,k=v,_=v,S=v,C=v,x=v;var T=i.performance||{},E=T.now||T.mozNow||T.msNow||T.oNow||T.webkitNow||function(){return(new Date).getTime()};var P=new Date;var R={nextTick:function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];d.push(new y(e,t)),1!==d.length||f||u(g)},title:\"browser\",browser:!0,env:{},argv:[],version:\"\",versions:{},on:b,addListener:w,once:k,off:_,removeListener:S,removeAllListeners:C,emit:x,binding:function(e){throw new Error(\"process.binding is not supported\")},cwd:function(){return\"/\"},chdir:function(e){throw new Error(\"process.chdir is not supported\")},umask:function(){return 0},hrtime:function(e){var t=.001*E.call(T),n=Math.floor(t),r=Math.floor(t%1*1e9);return e&&(n-=e[0],(r-=e[1])<0&&(n--,r+=1e9)),[n,r]},platform:\"browser\",release:{},config:{},uptime:function(){return(new Date-P)/1e3}};function O(e){return null!=e&&(!!e._isBuffer||j(e)||function(e){return\"function\"==typeof e.readFloatLE&&\"function\"==typeof e.slice&&j(e.slice(0,0))}(e))}function j(e){return!!e.constructor&&\"function\"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}void 0===i.TYPED_ARRAY_SUPPORT||i.TYPED_ARRAY_SUPPORT;var D=\"function\"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e};function I(e,t){var n={seen:[],stylize:M};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),N(t)?n.showHidden=t:t&&Y(n,t),$(n.showHidden)&&(n.showHidden=!1),$(n.depth)&&(n.depth=2),$(n.colors)&&(n.colors=!1),$(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=A),L(n,e,n.depth)}function A(e,t){var n=I.styles[t];return n?\"\u001b[\"+I.colors[n][0]+\"m\"+e+\"\u001b[\"+I.colors[n][1]+\"m\":e}function M(e,t){return e}function L(e,t,n){if(e.customInspect&&t&&H(t.inspect)&&t.inspect!==I&&(!t.constructor||t.constructor.prototype!==t)){var r=t.inspect(n,e);return U(r)||(r=L(e,r,n)),r}var o=function(e,t){if($(t))return e.stylize(\"undefined\",\"undefined\");if(U(t)){var n=\"'\"+JSON.stringify(t).replace(/^\"|\"$/g,\"\").replace(/'/g,\"\\\\'\").replace(/\\\\\"/g,'\"')+\"'\";return e.stylize(n,\"string\")}if(r=t,\"number\"==typeof r)return e.stylize(\"\"+t,\"number\");var r;if(N(t))return e.stylize(\"\"+t,\"boolean\");if(F(t))return e.stylize(\"null\",\"null\")}(e,t);if(o)return o;var i=Object.keys(t),a=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(i);if(e.showHidden&&(i=Object.getOwnPropertyNames(t)),J(t)&&(i.indexOf(\"message\")>=0||i.indexOf(\"description\")>=0))return z(t);if(0===i.length){if(H(t)){var s=t.name?\": \"+t.name:\"\";return e.stylize(\"[Function\"+s+\"]\",\"special\")}if(q(t))return e.stylize(RegExp.prototype.toString.call(t),\"regexp\");if(V(t))return e.stylize(Date.prototype.toString.call(t),\"date\");if(J(t))return z(t)}var c,l,u=\"\",p=!1,d=[\"{\",\"}\"];(c=t,Array.isArray(c)&&(p=!0,d=[\"[\",\"]\"]),H(t))&&(u=\" [Function\"+(t.name?\": \"+t.name:\"\")+\"]\");return q(t)&&(u=\" \"+RegExp.prototype.toString.call(t)),V(t)&&(u=\" \"+Date.prototype.toUTCString.call(t)),J(t)&&(u=\" \"+z(t)),0!==i.length||p&&0!=t.length?n<0?q(t)?e.stylize(RegExp.prototype.toString.call(t),\"regexp\"):e.stylize(\"[Object]\",\"special\"):(e.seen.push(t),l=p?function(e,t,n,r,o){for(var i=[],a=0,s=t.length;a<s;++a)K(t,String(a))?i.push(B(e,t,n,r,String(a),!0)):i.push(\"\");return o.forEach((function(o){o.match(/^\\d+$/)||i.push(B(e,t,n,r,o,!0))})),i}(e,t,n,a,i):i.map((function(r){return B(e,t,n,a,r,p)})),e.seen.pop(),function(e,t,n){if(e.reduce((function(e,t){return t.indexOf(\"\\n\"),e+t.replace(/\\u001b\\[\\d\\d?m/g,\"\").length+1}),0)>60)return n[0]+(\"\"===t?\"\":t+\"\\n \")+\" \"+e.join(\",\\n  \")+\" \"+n[1];return n[0]+t+\" \"+e.join(\", \")+\" \"+n[1]}(l,u,d)):d[0]+u+d[1]}function z(e){return\"[\"+Error.prototype.toString.call(e)+\"]\"}function B(e,t,n,r,o,i){var a,s,c;if((c=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]}).get?s=c.set?e.stylize(\"[Getter/Setter]\",\"special\"):e.stylize(\"[Getter]\",\"special\"):c.set&&(s=e.stylize(\"[Setter]\",\"special\")),K(r,o)||(a=\"[\"+o+\"]\"),s||(e.seen.indexOf(c.value)<0?(s=F(n)?L(e,c.value,null):L(e,c.value,n-1)).indexOf(\"\\n\")>-1&&(s=i?s.split(\"\\n\").map((function(e){return\"  \"+e})).join(\"\\n\").substr(2):\"\\n\"+s.split(\"\\n\").map((function(e){return\"   \"+e})).join(\"\\n\")):s=e.stylize(\"[Circular]\",\"special\")),$(a)){if(i&&o.match(/^\\d+$/))return s;(a=JSON.stringify(\"\"+o)).match(/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,\"name\")):(a=a.replace(/'/g,\"\\\\'\").replace(/\\\\\"/g,'\"').replace(/(^\"|\"$)/g,\"'\"),a=e.stylize(a,\"string\"))}return a+\": \"+s}function N(e){return\"boolean\"==typeof e}function F(e){return null===e}function U(e){return\"string\"==typeof e}function $(e){return void 0===e}function q(e){return G(e)&&\"[object RegExp]\"===Z(e)}function G(e){return\"object\"==typeof e&&null!==e}function V(e){return G(e)&&\"[object Date]\"===Z(e)}function J(e){return G(e)&&(\"[object Error]\"===Z(e)||e instanceof Error)}function H(e){return\"function\"==typeof e}function W(e){return null===e||\"boolean\"==typeof e||\"number\"==typeof e||\"string\"==typeof e||\"symbol\"==typeof e||void 0===e}function Z(e){return Object.prototype.toString.call(e)}function Y(e,t){if(!t||!G(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}function K(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function X(e,t){if(e===t)return 0;for(var n=e.length,r=t.length,o=0,i=Math.min(n,r);o<i;++o)if(e[o]!==t[o]){n=e[o],r=t[o];break}return n<r?-1:r<n?1:0}I.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},I.styles={special:\"cyan\",number:\"yellow\",boolean:\"yellow\",undefined:\"grey\",null:\"bold\",string:\"green\",date:\"magenta\",regexp:\"red\"};var Q,ee=Object.prototype.hasOwnProperty,te=Object.keys||function(e){var t=[];for(var n in e)ee.call(e,n)&&t.push(n);return t},ne=Array.prototype.slice;function re(){return void 0!==Q?Q:Q=\"foo\"===function(){}.name}function oe(e){return Object.prototype.toString.call(e)}function ie(e){return!O(e)&&(\"function\"==typeof i.ArrayBuffer&&(\"function\"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer))))}function ae(e,t){e||de(e,!0,t,\"==\",fe)}var se=/\\s*function\\s+([^\\(\\s]*)\\s*/;function ce(e){if(H(e)){if(re())return e.name;var t=e.toString().match(se);return t&&t[1]}}function le(e){this.name=\"AssertionError\",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=function(e){return ue(pe(e.actual),128)+\" \"+e.operator+\" \"+ue(pe(e.expected),128)}(this),this.generatedMessage=!0);var t=e.stackStartFunction||de;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var n=new Error;if(n.stack){var r=n.stack,o=ce(t),i=r.indexOf(\"\\n\"+o);if(i>=0){var a=r.indexOf(\"\\n\",i+1);r=r.substring(a+1)}this.stack=r}}}function ue(e,t){return\"string\"==typeof e?e.length<t?e:e.slice(0,t):e}function pe(e){if(re()||!H(e))return I(e);var t=ce(e);return\"[Function\"+(t?\": \"+t:\"\")+\"]\"}function de(e,t,n,r,o){throw new le({message:n,actual:e,expected:t,operator:r,stackStartFunction:o})}function fe(e,t){e||de(e,!0,t,\"==\",fe)}function he(e,t,n){e!=t&&de(e,t,n,\"==\",he)}function me(e,t,n){e==t&&de(e,t,n,\"!=\",me)}function ge(e,t,n){ve(e,t,!1)||de(e,t,n,\"deepEqual\",ge)}function ye(e,t,n){ve(e,t,!0)||de(e,t,n,\"deepStrictEqual\",ye)}function ve(e,t,n,r){if(e===t)return!0;if(O(e)&&O(t))return 0===X(e,t);if(V(e)&&V(t))return e.getTime()===t.getTime();if(q(e)&&q(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&\"object\"==typeof e||null!==t&&\"object\"==typeof t){if(ie(e)&&ie(t)&&oe(e)===oe(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===X(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(O(e)!==O(t))return!1;var o=(r=r||{actual:[],expected:[]}).actual.indexOf(e);return-1!==o&&o===r.expected.indexOf(t)||(r.actual.push(e),r.expected.push(t),function(e,t,n,r){if(null==e||null==t)return!1;if(W(e)||W(t))return e===t;if(n&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var o=be(e),i=be(t);if(o&&!i||!o&&i)return!1;if(o)return ve(e=ne.call(e),t=ne.call(t),n);var a,s,c=te(e),l=te(t);if(c.length!==l.length)return!1;for(c.sort(),l.sort(),s=c.length-1;s>=0;s--)if(c[s]!==l[s])return!1;for(s=c.length-1;s>=0;s--)if(!ve(e[a=c[s]],t[a],n,r))return!1;return!0}(e,t,n,r))}return n?e===t:e==t}function be(e){return\"[object Arguments]\"==Object.prototype.toString.call(e)}function we(e,t,n){ve(e,t,!1)&&de(e,t,n,\"notDeepEqual\",we)}function ke(e,t,n){ve(e,t,!0)&&de(e,t,n,\"notDeepStrictEqual\",ke)}function _e(e,t,n){e!==t&&de(e,t,n,\"===\",_e)}function Se(e,t,n){e===t&&de(e,t,n,\"!==\",Se)}function Ce(e,t){if(!e||!t)return!1;if(\"[object RegExp]\"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function xe(e,t,n,r){var o;if(\"function\"!=typeof t)throw new TypeError('\"block\" argument must be a function');\"string\"==typeof n&&(r=n,n=null),o=function(e){var t;try{e()}catch(e){t=e}return t}(t),r=(n&&n.name?\" (\"+n.name+\").\":\".\")+(r?\" \"+r:\".\"),e&&!o&&de(o,n,\"Missing expected exception\"+r);var i=\"string\"==typeof r,a=!e&&o&&!n;if((!e&&J(o)&&i&&Ce(o,n)||a)&&de(o,n,\"Got unwanted exception\"+r),e&&o&&n&&!Ce(o,n)||!e&&o)throw o}function Te(e,t,n){xe(!0,e,t,n)}function Ee(e,t,n){xe(!1,e,t,n)}function Pe(e){if(e)throw e}ae.AssertionError=le,D(le,Error),ae.fail=de,ae.ok=fe,ae.equal=he,ae.notEqual=me,ae.deepEqual=ge,ae.deepStrictEqual=ye,ae.notDeepEqual=we,ae.notDeepStrictEqual=ke,ae.strictEqual=_e,ae.notStrictEqual=Se,ae.throws=Te,ae.doesNotThrow=Ee,ae.ifError=Pe;var Re=o(Object.freeze({__proto__:null,default:ae,AssertionError:le,fail:de,ok:fe,assert:fe,equal:he,notEqual:me,deepEqual:ge,deepStrictEqual:ye,notDeepEqual:we,notDeepStrictEqual:ke,strictEqual:_e,notStrictEqual:Se,throws:Te,doesNotThrow:Ee,ifError:Pe})),Oe=Re,je=\"undefined\"!=typeof window;function De(e){this.hasWindow=e,this.hasIdle=this.hasWindow&&window.requestIdleCallback,this.method=this.hasIdle?window.requestIdleCallback.bind(window):this.setTimeout,this.scheduled=!1,this.queue=[]}De.prototype.push=function(e){Oe.equal(typeof e,\"function\",\"nanoscheduler.push: cb should be type function\"),this.queue.push(e),this.schedule()},De.prototype.schedule=function(){if(!this.scheduled){this.scheduled=!0;var e=this;this.method((function(t){for(;e.queue.length&&t.timeRemaining()>0;)e.queue.shift()(t);e.scheduled=!1,e.queue.length&&e.schedule()}))}},De.prototype.setTimeout=function(e){setTimeout(e,0,{timeRemaining:function(){return 1}})};var Ie,Ae=function(){var e;return je?(window._nanoScheduler||(window._nanoScheduler=new De(!0)),e=window._nanoScheduler):e=new De,e},Me=Ae(),Le=Re;Be.disabled=!0;try{Ie=window.performance,Be.disabled=\"true\"===window.localStorage.DISABLE_NANOTIMING||!Ie.mark}catch(e){}var ze=Be;function Be(e){if(Le.equal(typeof e,\"string\",\"nanotiming: name should be type string\"),Be.disabled)return Ne;var t=(1e4*Ie.now()).toFixed()%Number.MAX_SAFE_INTEGER,n=\"start-\"+t+\"-\"+e;function r(r){var o=\"end-\"+t+\"-\"+e;Ie.mark(o),Me.push((function(){var i=null;try{var a=e+\" [\"+t+\"]\";Ie.measure(a,n,o),Ie.clearMarks(n),Ie.clearMarks(o)}catch(e){i=e}r&&r(i,e)}))}return Ie.mark(n),r.uuid=t,r}function Ne(e){e&&Me.push((function(){e(new Error(\"nanotiming: performance API unavailable\"))}))}var Fe,Ue=Re;$e.disabled=!0;try{Fe=require(\"perf_hooks\").performance,$e.disabled=R.env.DISABLE_NANOTIMING||!Fe.mark}catch(e){}function $e(e){if(\"undefined\"!=typeof window)return ze(e);if(Ue.equal(typeof e,\"string\",\"nanotiming: name should be type string\"),$e.disabled)return qe;var t=(1e4*Fe.now()).toFixed()%Number.MAX_SAFE_INTEGER,n=\"start-\"+t+\"-\"+e;function r(r){var o=\"end-\"+t+\"-\"+e;Fe.mark(o);var i=null;try{var a=e+\" [\"+t+\"]\";Fe.measure(a,n,o),Fe.clearMarks(n),Fe.clearMarks(o)}catch(e){i=e}r&&r(i,e)}return Fe.mark(n),r.uuid=t,r}function qe(e){e&&e(new Error(\"nanotiming: performance API unavailable\"))}var Ge=function(e,t,n){var r,o=e.length;if(!(t>=o||0===n)){var i=o-(n=t+n>o?o-t:n);for(r=t;r<i;++r)e[r]=e[r+n];e.length=i}},Ve=$e,Je=Re,He=We;function We(e){if(!(this instanceof We))return new We(e);this._name=e||\"nanobus\",this._starListeners=[],this._listeners={}}We.prototype.emit=function(e){Je.ok(\"string\"==typeof e||\"symbol\"==typeof e,\"nanobus.emit: eventName should be type string or symbol\");for(var t=[],n=1,r=arguments.length;n<r;n++)t.push(arguments[n]);var o=Ve(this._name+\"('\"+e.toString()+\"')\"),i=this._listeners[e];return i&&i.length>0&&this._emit(this._listeners[e],t),this._starListeners.length>0&&this._emit(this._starListeners,e,t,o.uuid),o(),this},We.prototype.on=We.prototype.addListener=function(e,t){return Je.ok(\"string\"==typeof e||\"symbol\"==typeof e,\"nanobus.on: eventName should be type string or symbol\"),Je.equal(typeof t,\"function\",\"nanobus.on: listener should be type function\"),\"*\"===e?this._starListeners.push(t):(this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t)),this},We.prototype.prependListener=function(e,t){return Je.ok(\"string\"==typeof e||\"symbol\"==typeof e,\"nanobus.prependListener: eventName should be type string or symbol\"),Je.equal(typeof t,\"function\",\"nanobus.prependListener: listener should be type function\"),\"*\"===e?this._starListeners.unshift(t):(this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].unshift(t)),this},We.prototype.once=function(e,t){Je.ok(\"string\"==typeof e||\"symbol\"==typeof e,\"nanobus.once: eventName should be type string or symbol\"),Je.equal(typeof t,\"function\",\"nanobus.once: listener should be type function\");var n=this;return this.on(e,(function r(){t.apply(n,arguments),n.removeListener(e,r)})),this},We.prototype.prependOnceListener=function(e,t){Je.ok(\"string\"==typeof e||\"symbol\"==typeof e,\"nanobus.prependOnceListener: eventName should be type string or symbol\"),Je.equal(typeof t,\"function\",\"nanobus.prependOnceListener: listener should be type function\");var n=this;return this.prependListener(e,(function r(){t.apply(n,arguments),n.removeListener(e,r)})),this},We.prototype.removeListener=function(e,t){return Je.ok(\"string\"==typeof e||\"symbol\"==typeof e,\"nanobus.removeListener: eventName should be type string or symbol\"),Je.equal(typeof t,\"function\",\"nanobus.removeListener: listener should be type function\"),\"*\"===e?(this._starListeners=this._starListeners.slice(),n(this._starListeners,t)):(void 0!==this._listeners[e]&&(this._listeners[e]=this._listeners[e].slice()),n(this._listeners[e],t));function n(e,t){if(e){var n=e.indexOf(t);return-1!==n?(Ge(e,n,1),!0):void 0}}},We.prototype.removeAllListeners=function(e){return e?\"*\"===e?this._starListeners=[]:this._listeners[e]=[]:(this._starListeners=[],this._listeners={}),this},We.prototype.listeners=function(e){var t=\"*\"!==e?this._listeners[e]:this._starListeners,n=[];if(t)for(var r=t.length,o=0;o<r;o++)n.push(t[o]);return n},We.prototype._emit=function(e,t,n,r){if(void 0!==e&&0!==e.length){void 0===n&&(n=t,t=null),t&&(n=void 0!==r?[t].concat(n,r):[t].concat(n));for(var o=e.length,i=0;i<o;i++){var a=e[i];a.apply(a,n)}}};var Ze=He();function Ye(e){return Ye=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e},Ye(e)}function Ke(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(null==n)return;var r,o,i=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}(e,t)||Qe(e,t)||function(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}\n/*!\n\t * isobject <https://github.com/jonschlinkert/isobject>\n\t *\n\t * Copyright (c) 2014-2017, Jon Schlinkert.\n\t * Released under the MIT License.\n\t */()}function Xe(e){return function(e){if(Array.isArray(e))return et(e)}(e)||function(e){if(\"undefined\"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e[\"@@iterator\"])return Array.from(e)}(e)||Qe(e)||function(){throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}()}function Qe(e,t){if(e){if(\"string\"==typeof e)return et(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return\"Object\"===n&&e.constructor&&(n=e.constructor.name),\"Map\"===n||\"Set\"===n?Array.from(e):\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?et(e,t):void 0}}function et(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var tt=function(e){return null!=e&&\"object\"==typeof e&&!1===Array.isArray(e)};\n/*!\n\t * get-value <https://github.com/jonschlinkert/get-value>\n\t *\n\t * Copyright (c) 2014-2018, Jon Schlinkert.\n\t * Released under the MIT License.\n\t */const nt=tt;var rt=function(e,t,n){if(nt(n)||(n={default:n}),!at(e))return void 0!==n.default?n.default:e;\"number\"==typeof t&&(t=String(t));const r=Array.isArray(t),o=\"string\"==typeof t,i=n.separator||\".\",a=n.joinChar||(\"string\"==typeof i?i:\".\");if(!o&&!r)return e;if(o&&t in e)return it(t,e,n)?e[t]:n.default;let s=r?t:function(e,t,n){if(\"function\"==typeof n.split)return n.split(e);return e.split(t)}(t,i,n),c=s.length,l=0;do{let t=s[l];for(\"number\"==typeof t&&(t=String(t));t&&\"\\\\\"===t.slice(-1);)t=ot([t.slice(0,-1),s[++l]||\"\"],a,n);if(t in e){if(!it(t,e,n))return n.default;e=e[t]}else{let r=!1,o=l+1;for(;o<c;)if(t=ot([t,s[o++]],a,n),r=t in e){if(!it(t,e,n))return n.default;e=e[t],l=o-1;break}if(!r)return n.default}}while(++l<c&&at(e));return l===c?e:n.default};function ot(e,t,n){return\"function\"==typeof n.join?n.join(e):e[0]+t+e[1]}function it(e,t,n){return\"function\"!=typeof n.isValid||n.isValid(e,t)}function at(e){return nt(e)||Array.isArray(e)||\"function\"==typeof e}\n/*!\n\t * is-plain-object <https://github.com/jonschlinkert/is-plain-object>\n\t *\n\t * Copyright (c) 2014-2017, Jon Schlinkert.\n\t * Released under the MIT License.\n\t */var st=tt;function ct(e){return!0===st(e)&&\"[object Object]\"===Object.prototype.toString.call(e)}\n/*!\n\t * set-value <https://github.com/jonschlinkert/set-value>\n\t *\n\t * Copyright (c) 2014-2018, Jon Schlinkert.\n\t * Released under the MIT License.\n\t */\nconst lt=function(e){var t,n;return!1!==ct(e)&&(\"function\"==typeof(t=e.constructor)&&(!1!==ct(n=t.prototype)&&!1!==n.hasOwnProperty(\"isPrototypeOf\")))};function ut(e,t,n,r){if(!ft(e))return e;let o=r||{};const i=Array.isArray(t);if(!i&&\"string\"!=typeof t)return e;let a=o.merge;a&&\"function\"!=typeof a&&(a=Object.assign);const s=(i?t:function(e,t){const n=function(e,t){let n=e;if(void 0===t)return n+\"\";const r=Object.keys(t);for(let e=0;e<r.length;e++){const o=r[e];n+=\";\"+o+\"=\"+String(t[o])}return n}(e,t);if(ut.memo[n])return ut.memo[n];const r=t&&t.separator?t.separator:\".\";let o=[],i=[];o=t&&\"function\"==typeof t.split?t.split(e):e.split(r);for(let e=0;e<o.length;e++){let t=o[e];for(;t&&\"\\\\\"===t.slice(-1)&&o[e+1];)t=t.slice(0,-1)+r+o[++e];i.push(t)}return ut.memo[n]=i,i}(t,o)).filter(dt),c=s.length,l=e;if(!r&&1===s.length)return pt(e,s[0],n,a),e;for(let t=0;t<c;t++){let r=s[t];if(ft(e[r])||(e[r]={}),t===c-1){pt(e,r,n,a);break}e=e[r]}return l}function pt(e,t,n,r){r&&lt(e[t])&&lt(n)?e[t]=r({},e[t],n):e[t]=n}function dt(e){return\"__proto__\"!==e&&\"constructor\"!==e&&\"prototype\"!==e}function ft(e){return null!==e&&(\"object\"==typeof e||\"function\"==typeof e)}ut.memo={};var ht=ut,mt={}.toString,gt=Array.isArray||function(e){return\"[object Array]\"==mt.call(e)};function yt(e){return e?Array.isArray(e)?e.join(\".\"):e:\"\"}\n/*!\n\t * has-value <https://github.com/jonschlinkert/has-value>\n\t *\n\t * Copyright (c) 2014-2016, Jon Schlinkert.\n\t * Licensed under the MIT License.\n\t */var vt=function(e){return null!=e&&\"object\"==typeof e&&!1===gt(e)},bt=function(e,t){if(null==e)return!1;if(\"boolean\"==typeof e)return!0;if(\"number\"==typeof e)return 0!==e||!0!==t;if(void 0!==e.length)return 0!==e.length;for(var n in e)if(e.hasOwnProperty(n))return!0;return!1},wt=function(e,t,n,r,o){if(null===(i=e)||\"object\"!=typeof i&&\"function\"!=typeof i||!t)return e;var i;if(t=yt(t),n&&(t+=\".\"+yt(n)),r&&(t+=\".\"+yt(r)),o&&(t+=\".\"+yt(o)),t in e)return e[t];for(var a=t.split(\".\"),s=a.length,c=-1;e&&++c<s;){for(var l=a[c];\"\\\\\"===l[l.length-1];)l=l.slice(0,-1)+\".\"+a[++c];e=e[l]}return e},kt=tt,_t=function(e,t,n){return vt(e)?bt(wt(e,t),n):bt(e,t)},St={\"config.logger.show.parse\":!1,\"config.logger.show.render\":!1,\"config.logger.show.sound\":!1,\"config.logger.show.state\":!1,\"config.logger.show.story\":!1,\"config.logger.show.style\":!1};function Ct(e){return e+\": \"}function xt(e,t){nn(\"config.logger.show.\".concat(e))&&console.log(Ct(e)+t),Ze.emit(\"log\",{source:e,message:t})}function Tt(e,t){console.warn(Ct(e)+t),Ze.emit(\"log-warning\",{source:e,message:t})}function Et(e){return{log:function(t){xt(e,t)},warn:function(t){Tt(e,t)}}}function Pt(e,t){return Array.from(e.querySelectorAll(t))}window.logger={log:xt,warn:Tt};var Rt=Et(\"story\"),Ot={customScripts:[],customStyles:[]},jt=[];function Dt(e){[\"name\",\"creator\",\"ifid\",\"options\"].forEach((function(t){return Ot[t]=e.getAttribute(t)})),Ot.startNode=parseInt(e.getAttribute(\"startnode\")),Ot.creatorVersion=e.getAttribute(\"creator-version\");var t=function(e){return e.map((function(e){return e.textContent}))};Ot.customScripts=t(Pt(e,'[type=\"text/twine-javascript\"]')),Ot.customStyles=t(Pt(e,'[type=\"text/twine-css\"]')),jt=Pt(e,\"tw-passagedata\").map((function(e){var t={id:parseInt(e.getAttribute(\"pid\")),name:e.getAttribute(\"name\"),source:e.textContent},n=e.getAttribute(\"tags\");return t.tags=n?n.split(\" \"):[],t}))}function It(){en(\"trail\",[Nt().name]),en(\"config.testing\",\"string\"==typeof Ot.options&&-1!==Ot.options.indexOf(\"debug\")||!1),document.title=Ot.name}function At(){Rt.log(\"Running custom scripts (\".concat(Ot.customScripts.length,\")\")),Ot.customScripts.forEach((function(e){new Function(e).apply(window)}))}function Mt(){Rt.log(\"Adding custom styles (\".concat(Ot.customStyles.length,\")\")),Ot.customStyles.forEach((function(e){var t=document.createElement(\"style\");t.innerHTML=e,document.head.appendChild(t)}))}function Lt(){return Ot.ifid}function zt(){return Ot.name}function Bt(){return jt}function Nt(){return jt.find((function(e){return e.id===Ot.startNode}))}function Ft(e){return jt.find((function(t){return t.name===e}))}var Ut,$t=Object.freeze({__proto__:null,loadFromData:Dt,init:It,runCustomScripts:At,addCustomStyles:Mt,ifid:Lt,name:zt,exportedPassages:Bt,passages:Bt,startPassage:Nt,passageNamed:Ft,passageWithId:function(e){return jt.find((function(t){return t.id===e}))}}),qt=Et(\"state\").log,Gt={},Vt={},Jt={},Ht={\"config.state.autosave\":!0};function Wt(e,t){if(!e[t]){Object.defineProperty(e,t,{get:function(){return nn(t)},set:function(e){Qt(t,e)},configurable:!0});var n=t.split(\".\");n.length>1&&(n.pop(),Wt(e,n.join(\".\")))}}function Zt(e,t){!function(e,t){if(!kt(e))throw new TypeError(\"expected an object.\");if(e.hasOwnProperty(t))return delete e[t],!0;if(_t(e,t)){for(var n=t.split(\".\"),r=n.pop();n.length&&\"\\\\\"===n[n.length-1].slice(-1);)r=n.pop().slice(0,-1)+\".\"+r;for(;n.length;)e=e[t=n.shift()];return delete e[r]}}(e,t)}function Yt(){var e=Lt(),t=zt();if(void 0===t)throw new Error(\"Cannot set up state: the story has no name\");Ut=\"chapbook-state-\".concat(t,\"-\").concat(e)}function Kt(){!function e(t,n){Object.keys(t).forEach((function(r){var o=\"\"===n?r:\"\".concat(n,\".\").concat(r);if(\"object\"!==Ye(t[r])||Array.isArray(t[r])){var i=t[r];delete t[r],Zt(window,n),Ze.emit(\"state-change\",{name:o,value:nn(o),previous:i})}else e(t[r],o)}))}(Gt,\"\"),Ze.emit(\"state-reset\"),nn(\"config.state.autosave\")&&sn()}function Xt(e,t){for(var n=e.split(\".\"),r=t.split(\".\"),o=0;o<n.length&&o<r.length;o++)if(n[o]!==r[o])return!1;return!0}function Qt(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=nn(e);ht(Gt,e,t),Wt(window,e),t!==r&&Ze.emit(\"state-change\",{name:e,previous:r,value:t,isFromPeers:n}),nn(\"config.state.autosave\")&&sn()}function en(e,t){var n=nn(e);qt('Defaulting \"'.concat(e,'\" to ').concat(JSON.stringify(t))),ht(Vt,e,t),Wt(window,e),null==n&&Ze.emit(\"state-change\",{name:e,value:t,previous:n})}function tn(e,t){var n=nn(e);qt(\"Adding lookup variable \".concat(e)),ht(Jt,e,t),function(e,t){if(!e[t]){for(var n=t.split(\".\"),r=n[n.length-1],o=0;o<n.length-1;o++)e[n[o]]=e[n[o]]||{},e=e[n[o]];Object.defineProperty(e,r,{get:function(){return nn(t)},set:function(){throw new Error(\"Chapbook lookup variables may only be read.\")},configurable:!0})}}(window,e),null==n&&Ze.emit(\"state-change\",{name:e,value:nn(e),previous:n})}function nn(e){var t=rt(Jt,e);if(\"function\"==typeof t)return t(nn,Qt);var n=rt(Gt,e);return null==n?rt(Vt,e):n}function rn(){return Object.assign({},Gt)}function on(e){Kt(),Object.keys(e).forEach((function(t){return Qt(t,e[t])}))}function an(){try{return window.localStorage.setItem(\"chapbook-test\",\"a\"),window.localStorage.removeItem(\"chapbook-test\"),!0}catch(e){return!1}}function sn(){qt(\"Saving to local storage: \"+JSON.stringify(rn())),window.localStorage.setItem(Ut,JSON.stringify(rn())),qt(\"Save complete\")}function cn(){return an()&&null!==window.localStorage.getItem(Ut)}function ln(){qt(\"Restoring variables from local storage\"),on(JSON.parse(window.localStorage.getItem(Ut))),qt(\"Restore complete\")}function un(e){e||qt(\"Purging variables from local storage\"),on(JSON.parse(window.localStorage.getItem(Ut))),e||qt(\"Purge complete\")}var pn=Object.freeze({__proto__:null,defaults:Ht,init:Yt,reset:Kt,sameObject:Xt,set:Qt,setDefault:en,setLookup:tn,get:nn,saveToObject:rn,restoreFromObject:on,canSaveToStorage:an,saveToStorage:sn,canRestoreFromStorage:cn,restoreFromStorage:ln,purgeFromStorage:un,varNames:function(e){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return Object.keys(e).reduce((function(r,o){if(\"object\"===Ye(e[o])&&e[o]&&!Array.isArray(e[o]))t(e[o],n?n+\".\"+o:o,r);else{var i=n?n+\".\"+o:o;-1===r.indexOf(i)&&r.push(i)}return r}),r)}return e?t(Vt,null,t(Gt,null)).sort():t(Gt).sort()}});function dn(e){xt(\"actions\",e)}function fn(e){dn('Going to passage \"'.concat(e,'\"'));var t=Ft(e);if(!t)throw new Error('There is no passage with the name \"'.concat(e,'\"'));Pt(document,\"[data-cb-set]\").forEach((function(e){var t=e.dataset.set;switch(e.nodeName){case\"INPUT\":Qt(t,e.value);break;case\"SELECT\":Qt(t,e.options[e.selectedIndex].value);break;default:Qt(t,e.textContent)}})),Qt(\"trail\",nn(\"trail\").concat(t.name))}function hn(){dn(\"Restarting\"),Kt(),window.location.reload()}Ze.on(\"dom-click\",(function(e){var t,n;e.dataset.cbGo&&(t=document.querySelector(\"form#cb-validation\"),n=Pt(t,\"input, select\"),new Promise((function(e,r){var o=function e(){t.removeEventListener(\"submit\",i),n.forEach((function(t){return t.removeEventListener(\"invalid\",e)})),r()},i=function r(){t.removeEventListener(\"submit\",r),n.forEach((function(e){return e.removeEventListener(\"invalid\",o)})),e()};n.forEach((function(e){return e.addEventListener(\"invalid\",o)})),t.addEventListener(\"submit\",i),document.querySelector(\"button#cb-validation-tester\").click()}))).then((function(){return fn(e.dataset.cbGo)}))})),Ze.on(\"dom-click\",(function(e){e.dataset.cbRestart&&hn()}));var mn={match:/^(no )?ambient\\s+sound/i,render:function(e,t){var n=nn(\"sound.ambient\");if(n&&Object.keys(n).forEach((function(t){t!==e&&n[t].playing&&Qt(\"sound.ambient.\".concat(t,\".playing\"),!1)})),e){var r=nn(\"sound.ambient.\".concat(e,\".description\"))||\"\";return t.volume&&Qt(\"sound.ambient.\".concat(e,\".volume\"),t.volume),Qt(\"sound.ambient.\".concat(e,\".playing\"),!0),\"<audio>\".concat(r,\"</audio>\")}}};function gn(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=document.createElement(e);return Object.keys(t).forEach((function(e){void 0!==t[e]&&r.setAttribute(e,t[e])})),n.forEach((function(e){\"string\"==typeof e?r.appendChild(document.createTextNode(e)):r.appendChild(e)})),r}function yn(){return gn.apply(void 0,arguments).outerHTML}function vn(e,t){return/^\\w+:\\/\\/\\/?\\w/i.test(e)?yn(\"a\",{href:e},[t||e]):yn(\"a\",{href:\"javascript:void(0)\",\"data-cb-go\":e},[t||e])}function bn(e){return e.replace(/\\[\\[(.*?)\\]\\]/g,(function(e,t){var n=t,r=t.indexOf(\"|\");if(-1!==r)n=t.substr(0,r),t=t.substr(r+1);else{var o=t.indexOf(\"->\");if(-1!==o)n=t.substr(0,o),t=t.substr(o+2);else{var i=t.indexOf(\"<-\");-1!==i&&(n=t.substr(i+2),t=t.substr(0,i))}}return vn(t,n||t)}))}var wn={match:/^back\\s+link/i,render:function(e,t){var n=nn(\"trail\");return vn(n.length>1?n[n.length-2]:n[0],t.label||\"Back\")}};var kn=function(e,t,n){n=Object.assign({},_n,n||{});let r=0,o=function(e){let t={ms:.001,s:1,m:60,h:3600};return t.d=e.hoursPerDay*t.h,t.w=e.daysPerWeek*t.d,t.mth=e.daysPerYear/e.monthsPerYear*t.d,t.y=e.daysPerYear*t.d,t}(n),i=e.toLowerCase().replace(/[^.\\w+-]+/g,\"\").match(/[-+]?[0-9.]+[a-z]+/g);null!==i&&i.forEach((e=>{let t=e.match(/[0-9.]+/g)[0],n=e.match(/[a-z]+/g)[0];r+=function(e,t,n){return e*n[Cn(t)]}(t,n,o)}));if(t)return function(e,t,n){return e/n[Cn(t)]}(r,t,o);return r};const _n={hoursPerDay:24,daysPerWeek:7,weeksPerMonth:4,monthsPerYear:12,daysPerYear:365.25},Sn={ms:[\"ms\",\"milli\",\"millisecond\",\"milliseconds\"],s:[\"s\",\"sec\",\"secs\",\"second\",\"seconds\"],m:[\"m\",\"min\",\"mins\",\"minute\",\"minutes\"],h:[\"h\",\"hr\",\"hrs\",\"hour\",\"hours\"],d:[\"d\",\"day\",\"days\"],w:[\"w\",\"week\",\"weeks\"],mth:[\"mon\",\"mth\",\"mths\",\"month\",\"months\"],y:[\"y\",\"yr\",\"yrs\",\"year\",\"years\"]};function Cn(e){for(let t of Object.keys(Sn))if(Sn[t].indexOf(e)>-1)return t;throw new Error(`The unit [${e}] is not supported by timestring`)}function xn(e){\"static\"===window.getComputedStyle(e).position&&(e.style.position=\"relative\")}function Tn(e){var t=document.createElement(e.nodeName.toLowerCase());return t.innerHTML=e.innerHTML,t.style.width=e.clientWidth+\"px\",t.style.height=e.clientHeight+\"px\",t.setAttribute(\"aria-hidden\",!0),t.style.pointerEvents=\"none\",Pt(t,\"audio\").forEach((function(e){return e.parentNode.removeChild(e)})),t}var En=Element.prototype,Pn=En.matchesSelector||En.webkitMatchesSelector||En.mozMatchesSelector||En.msMatchesSelector||En.oMatchesSelector;var Rn=function(e,t){if(Pn)return Pn.call(e,t);for(var n=e.parentNode.querySelectorAll(t),r=0;r<n.length;++r)if(n[r]==e)return!0;return!1},On=function(e,t,n){for(var r=n?e:e.parentNode;r&&r!==document;){if(Rn(r,t))return r;r=r.parentNode}};function jn(e){try{var t=\"\";t=(t=e.error&&e.error.stack?e.message+\"\\n\\nStack trace:\\n\"+e.error.stack:e.message+\"\\n\\n[No stack trace available]\").replace(\"\\nPlease report this to https://github.com/chjj/marked.\",\"\");var n=document.createElement(\"div\"),r=document.querySelector(\"#page article\"),o=nn(\"trail\");n.className=\"error\",n.innerHTML=\"\\n\\t\\t\\t<p>\\n\\t\\t\\tAn unexpected error has occurred.\\n\\t\\t\\t</p>\\n\\t\\t\\t<pre>\".concat(nn(\"config.testing\")?t:\"\",'</pre>\\n\\t\\t\\t<ul>\\n\\t\\t\\t\\t<li>\\n\\t\\t\\t\\t\\t<a href=\"javascript:void(0)\" ').concat(o.length>1?\"data-cb-back\":\"data-cb-refresh\",'>Go back</a> to the previous passage.\\n\\t\\t\\t\\t</li>\\n\\t\\t\\t\\t<li>\\n\\t\\t\\t\\t\\t<a href=\"javascript:void(0)\" data-cb-hard-restart>Hard restart</a>, clearing all progress and beginning from the start.\\n\\t\\t\\t\\t</li>\\n\\t\\t\\t</ul>\\n\\t\\t'),n.addEventListener(\"click\",(function(e){if(On(e.target,\"[data-cb-back]\",!0)){var t=nn(\"trail\");Array.isArray(t)?Qt(\"trail\",t.slice(0,t.length-1)):window.alert(\"Sorry, going back was not successful. Please try hard restarting.\")}else{if(On(e.target,\"[data-cb-refresh]\",!0))Qt(\"trail\",Xe(nn(\"trail\")));else On(e.target,\"[data-cb-hard-restart]\",!0)&&(un(!0),window.location.reload())}})),r.innerHTML=\"\",r.appendChild(n)}catch(e){console.error(e)}}var Dn=\"[object Symbol]\",In=/[&<>\"'`]/g,An=RegExp(In.source),Mn=\"object\"==typeof r&&r&&r.Object===Object&&r,Ln=\"object\"==typeof self&&self&&self.Object===Object&&self,zn=Mn||Ln||Function(\"return this\")();var Bn,Nn=(Bn={\"&\":\"&amp;\",\"<\":\"&lt;\",\">\":\"&gt;\",'\"':\"&quot;\",\"'\":\"&#39;\",\"`\":\"&#96;\"},function(e){return null==Bn?void 0:Bn[e]}),Fn=Object.prototype.toString,Un=zn.Symbol,$n=Un?Un.prototype:void 0,qn=$n?$n.toString:void 0;function Gn(e){if(\"string\"==typeof e)return e;if(function(e){return\"symbol\"==typeof e||function(e){return!!e&&\"object\"==typeof e}(e)&&Fn.call(e)==Dn}(e))return qn?qn.call(e):\"\";var t=e+\"\";return\"0\"==t&&1/e==-Infinity?\"-0\":t}var Vn,Jn,Hn,Wn=function(e){var t;return(e=null==(t=e)?\"\":Gn(t))&&An.test(e)?e.replace(In,Nn):e};var Zn={crossfade:function(e,t,n){return new Promise((function(r){var o=e.style.pointerEvents,i=kn(n,\"s\");xn(e),e.style.pointerEvents=\"none\";var a=document.createElement(\"div\");if(a.innerHTML=t,a.className=\"fade-in\",a.style.animationDuration=i+\"s\",a.addEventListener(\"animationend\",(function t(){a.removeEventListener(\"animationend\",t),a.style.animationDuration=null,a.className=\"\",e.style.pointerEvents=o,r()})),\"\"!==e.innerHTML.trim()){var s=Tn(e);s.style.position=\"absolute\",s.style.top=\"0\",s.style.left=\"0\",s.className=\"fade-out\",s.style.animationDuration=i+\"s\",s.addEventListener(\"animationend\",(function e(){s.removeEventListener(\"animationend\",e),s.style.opacity=.5,s.parentNode.removeChild(s)})),e.innerHTML=\"\",e.appendChild(a),e.appendChild(s)}else e.innerHTML=\"\",e.appendChild(a)}))},fadeInOut:function(e,t,n){return new Promise((function(r){var o=e.style.pointerEvents,i=kn(n,\"s\")/2;xn(e),e.style.pointerEvents=\"none\";var a=document.createElement(\"div\");if(a.innerHTML=t,a.style.visibility=\"hidden\",a.style.animationDuration=i+\"s\",a.addEventListener(\"animationend\",(function t(){a.removeEventListener(\"animationend\",t),a.className=\"\",a.style.animationDuration=i+\"s\",e.style.pointerEvents=o,r()})),\"\"!==e.innerHTML.trim()){var s=Tn(e);s.style.position=\"absolute\",s.style.top=\"0\",s.style.left=\"0\",s.className=\"fade-out\",s.style.animationDuration=i+\"s\",s.addEventListener(\"animationend\",(function e(){s.removeEventListener(\"animationend\",e),s.parentNode.removeChild(s),a.style.visibility=\"visible\",a.className=\"fade-in\"})),e.innerHTML=\"\",e.appendChild(a),e.appendChild(s)}else a.className=\"fade-in\",a.animationDuration=2*i,a.style.visibility=\"visible\",a.className=\"fade-in\",e.appendChild(a)}))},none:function(e,t){return new Promise((function(n){e.innerHTML=\"<div>\".concat(t,\"</div>\"),n()}))}},Yn={\"config.body.transition.name\":\"crossfade\",\"config.body.transition.duration\":\"500ms\",\"config.header.left\":\"\",\"config.header.center\":\"\",\"config.header.right\":\"\",\"config.header.transition.name\":\"none\",\"config.header.transition.duration\":\"500ms\",\"config.footer.left\":\"_{story.name}_\",\"config.footer.center\":\"\",\"config.footer.right\":\"{restart link}\",\"config.footer.transition.name\":\"none\",\"config.footer.transition.duration\":\"500ms\"};function Kn(e,t,n,r){Zn[n]?Zn[n](e,t,r):Zn.none(e,t)}var Xn,Qn,er,tr=(Xn=function(e){if(e.some((function(e){return e[0]}))){var t=nn(\"trail\"),n=Ft(t[t.length-1]);if(!n)throw new Error('There is no passage named \"'.concat(t[t.length-1],'\".'));window.scrollTo(0,0),Kn(Vn,ai(n.source),nn(\"config.body.transition.name\"),nn(\"config.body.transition.duration\")),function(e,t){var n,r=Date.now(),o=Pt(e,\"[data-cb-skippable]\").map((function(e){return{el:e,delay:1e3*kn(window.getComputedStyle(e).animationDelay)}})).sort((function(e,t){return e.delay-t.delay}));function i(){var e=Date.now()-r,t=Object.assign({},o.find((function(t){return t.delay>e})));t?(o.forEach((function(e){e.delay<=t.delay?(e.delay=0,e.el.classList.add(\"skip-animation\")):(e.delay-=t.delay,e.el.style.animationDelay=\"\".concat(e.delay,\"ms\"))})),r=Date.now(),window.clearTimeout(n),a()):s()}function a(){n&&window.clearTimeout(n),n=window.setTimeout(s,o[o.length-1].delay)}function s(){t.classList.remove(\"visible\"),document.body.removeEventListener(\"click\",i),document.body.removeEventListener(\"keyup\",i)}0!==o.length&&(t.classList.add(\"visible\"),a(),window.setTimeout((function(){document.body.addEventListener(\"click\",i),document.body.addEventListener(\"keyup\",i)}),50))}(Vn,Hn)}[\"header\",\"footer\"].forEach((function(e){Jn[e].container.classList.remove(\"has-content\"),[\"left\",\"center\",\"right\"].forEach((function(t){var n=ai(nn(\"config.\".concat(e,\".\").concat(t)));\"\"!==n&&Jn[e].container.classList.add(\"has-content\"),Kn(Jn[e][t],n,nn(\"config.\".concat(e,\".transition.name\")),nn(\"config.\".concat(e,\".transition.duration\")))}))}))},Qn=[],er=!1,function(){er||(er=!0,Promise.resolve().then((function(){try{Xn(Qn)}catch(e){window.setTimeout((function(){throw e}),0)}Qn=[],er=!1})));for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Qn.push(t)});function nr(e){Pt(Vn,\"input\").forEach((function(e){e.setAttribute(\"value\",e.value)})),Pt(Vn,\"select\").forEach((function(e){for(var t=0;t<e.options.length;t++)t===e.options.selectedIndex?e.options[t].setAttribute(\"selected\",\"\"):e.options[t].removeAttribute(\"selected\")}));for(var t={x:window.scrollX,y:window.scrollY},n=Vn.innerHTML,r=document.createElement(\"div\");Vn.firstChild;)r.insertBefore(Vn.firstChild,r.firstChild);Vn.innerHTML=n,e(r),window.scrollX=t.x,window.scrollY=t.y,Kn(Vn,r.innerHTML,nn(\"config.body.transition.name\"),nn(\"config.body.transition.duration\"))}var rr={match:/^cycling\\s+link(\\s+for)?/i,render:function(e,t){var n;return e?void 0===(n=nn(e))&&(Qt(e,t.choices[0]),n=t.choices[0]):n=t.choices[0],yn(\"a\",{href:\"javascript:void(0)\",\"data-cb-cycle-set\":e||void 0,\"data-cb-cycle-choices\":JSON.stringify(t.choices)},[n])}};Ze.on(\"dom-click\",(function(e){if(e.dataset.cbCycleChoices){var t=JSON.parse(e.dataset.cbCycleChoices),n=t.indexOf(e.textContent)+1;n===t.length&&(n=0),nr((function(){return e.textContent=t[n]})),e.dataset.cbCycleSet&&Qt(e.dataset.cbCycleSet,t[n])}}));var or={match:/^embed\\s+flickr(\\s+image)?/i,render:function(e,t){return yn(\"img\",Object.assign({},t,{src:/img src=\"(.+?)\"/.exec(e)[1]}))}},ir={match:/^embed\\s+image?/i,render:function(e,t){return yn(\"img\",Object.assign({},t,{src:e}))}},ar={match:/^embed\\s+passage(\\s+named)?/i,render:function(e){return ai(Ft(e).source)}},sr={match:/^embed\\s+unsplash(\\s+image)?/i,render:function(e,t){return yn(\"img\",Object.assign({},t,{src:\"https://source.unsplash.com/\".concat(e.replace(/.*\\//,\"\"),\"/\").concat(t.width,\"x\").concat(t.height)}))}},cr={match:/^embed\\s+youtube(\\s+video)?/i,render:function(e,t){var n=\"https://www.youtube-nocookie.com/embed/\".concat(e.replace(/.*\\?v=/,\"\"),\"?modestbranding=1&rel=0&controls=\").concat(t.controls?1:0,\"&\");return t.autoplay&&(n+=\"autoplay=1&\"),t.loop&&(n+=\"loop=1&\"),yn(\"div\",{style:\"position: relative; height: 0; padding-bottom: 56.25%; margin-bottom: 1em\"},[gn(\"iframe\",{src:n,frameBorder:0,style:\"position: absolute; top: 0; left: 0; width: 100%; height: 100%\"})])}},lr={match:/^link\\s+to/i,render:function(e,t){return vn(e,t.label)}},ur={match:/^dropdown menu(\\s+for)?/i,render:function(e,t){var n;return e&&void 0===(n=nn(e))&&(Qt(e,t.choices[0]),n=t.choices[0]),yn(\"select\",{\"data-cb-menu-set\":e||void 0},t.choices.map((function(t){var r={value:t};return e&&n===t&&(r.selected=\"\"),gn(\"option\",r,[t])})))}};Ze.on(\"dom-change\",(function(e){e.dataset.cbMenuSet&&Qt(e.dataset.cbMenuSet,e.querySelectorAll(\"option\")[e.selectedIndex].value)}));var pr={match:/^restart\\s+link/i,render:function(e,t){return yn(\"a\",{href:\"javascript:void(0)\",\"data-cb-restart\":!0},[t.label||\"Restart\"])}},dr={match:/^reveal\\s+link/i,render:function(e,t){return t.text?yn(\"a\",{href:\"javascript:void(0)\",\"data-cb-reveal-text\":t.text},[e]):t.passage?yn(\"a\",{href:\"javascript:void(0)\",\"data-cb-reveal-passage\":t.passage},[e]):void 0}};Ze.on(\"dom-click\",(function(e){var t=e.dataset.cbRevealText;if(e.dataset.cbRevealPassage&&(t=Ft(e.dataset.cbRevealPassage).source),t){var n=document.createElement(\"div\");n.innerHTML=ai(t).trim(),nr((function(){var t=n.children.length;if(t>0){var r=document.createElement(\"span\");if(r.innerHTML=n.firstChild.innerHTML,e.parentNode.insertBefore(r,e),n.removeChild(n.firstChild),t>1){for(var o=n.lastChild;n.lastChild;)e.parentNode.parentNode.insertBefore(n.lastChild,e.parentNode.nextSibling);for(;e.nextSibling;)o.insertBefore(e.nextSibling,null)}}e.parentNode.removeChild(e)}))}}));var fr={match:/^sound\\s+effect/i,render:function(e,t){var n=nn(\"sound.effect.\".concat(e,\".description\"))||\"\";return t.volume&&Qt(\"sound.effect.\".concat(e,\".volume\"),t.volume),Qt(\"sound.effect.\".concat(e,\".playing\"),!0),\"<audio>\".concat(n,\"</audio>\")}},hr={match:/^text\\s+input(\\s+for)?/i,render:function(e,t){return yn(\"input\",{type:\"text\",value:e?nn(e):\"\",\"data-cb-text-field-set\":e||void 0,required:!1!==t.required?\"\":void 0})}};Ze.on(\"dom-change\",(function(e){e.dataset.cbTextFieldSet&&Qt(e.dataset.cbTextFieldSet,e.value)}));var mr=[mn,wn,rr,or,ir,ar,sr,cr,lr,ur,pr,dr,fr,hr],gr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=\"<span\"+Object.keys(t).reduce((function(e,n){return e+\" \".concat(n,'=\"').concat(t[n],'\"')}),\"\")+\">\",r=n+e.replace(/[\\r\\n]{2,}/g,\"</span>$&\".concat(n))+\"</span>\";return r=r.replace(/(<span.*?>)\\s*(#+)/gi,\"$2 $1\")},yr={match:/^after\\s/i,process:function(e,t){var n=t.invocation,r=kn(n.replace(/^after\\s/i,\"\"),\"ms\");e.text=gr(e.text,{\"data-cb-skippable\":\"\",class:\"fade-in\",style:\"animation-delay: \".concat(r,\"ms\")})}},vr={match:/^align\\s+(left|right|center)/i,process:function(e,t){var n=t.invocation.replace(/^align\\s+/i,\"\");e.text=gr(e.text,{style:\"display: block; text-align: \".concat(n)})}},br={match:/^if(always|never)?\\s|else$|unless\\s/i,processRaw:function(e,t){var n,r=t.invocation,o=t.state,i=r.replace(/\\s.*/,\"\").toLowerCase();switch(\"else\"!==i&&(n=new Function(\"return \"+r.replace(/.*?\\s/,\"\"))),i){case\"if\":o.conditionEval=n.apply(window);break;case\"ifalways\":o.conditionEval=!0;break;case\"ifnever\":o.conditionEval=!1;break;case\"unless\":o.conditionEval=!n.apply(window);break;case\"else\":if(void 0===o.conditionEval)throw new Error(\"There was no matching if modifier for an else modifier.\");o.conditionEval=!o.conditionEval}o.conditionEval||(e.text=\"\")}},wr=\"[object Symbol]\",kr=/&(?:amp|lt|gt|quot|#39|#96);/g,_r=RegExp(kr.source),Sr=\"object\"==typeof r&&r&&r.Object===Object&&r,Cr=\"object\"==typeof self&&self&&self.Object===Object&&self,xr=Sr||Cr||Function(\"return this\")();var Tr=function(e){return function(t){return null==e?void 0:e[t]}}({\"&amp;\":\"&\",\"&lt;\":\"<\",\"&gt;\":\">\",\"&quot;\":'\"',\"&#39;\":\"'\",\"&#96;\":\"`\"}),Er=Object.prototype.toString,Pr=xr.Symbol,Rr=Pr?Pr.prototype:void 0,Or=Rr?Rr.toString:void 0;function jr(e){if(\"string\"==typeof e)return e;if(function(e){return\"symbol\"==typeof e||function(e){return!!e&&\"object\"==typeof e}(e)&&Er.call(e)==wr}(e))return Or?Or.call(e):\"\";var t=e+\"\";return\"0\"==t&&1/e==-Infinity?\"-0\":t}var Dr=function(e){var t;return(e=null==(t=e)?\"\":jr(t))&&_r.test(e)?e.replace(kr,Tr):e},Ir={match:/^javascript$/i,process:function(e){try{var t=new Function(\"\\n\\t\\t\\t\\t\\t\\tfunction write() { write.__out += write.__join.call(arguments, ''); }\\n\\t\\t\\t\\t\\t\\twrite.__out = '';\\n\\t\\t\\t\\t\\t\\twrite.__join = Array.prototype.join;\\n\\t\\t\\t\\t\\t\\t\".concat(Dr(e.text),\";\\n\\t\\t\\t\\t\\t\\treturn write.__out;\\n\\t\\t\\t\\t\\t\"));e.text=t.apply(window)}catch(t){if(!nn(\"config.testing\"))throw t;var n=\"unknown error\";n=t.error&&t.error.stack?t.error.stack:t.message+\"\\n[No stack trace available]\",e.text='<div class=\"error\">An error occured evaluating:<pre>'.concat(e.text,\"</pre><p><pre>\").concat(n,\"</pre></p></div>\")}}},Ar=[yr,vr,{match:/^append$/i,process:function(e){e.startsNewParagraph=!1}},br,{match:/^continued?|cont('d)?$/i,process:function(){}},{match:/^css$/i,process:function(e){e.text=\"<style>\".concat(e.text,\"</style>\")}},Ir,{match:/^(note(\\s+to\\s+self)?|n?b?|todo|fixme)$/i,process:function(e){e.text=\"\"}}],Mr=function(e,t){if(\"string\"!=typeof e)throw new TypeError(\"Expected a string in the first argument, got \"+typeof e);if(!(t&&t.preserveNewlines))return e.split(/\\r?\\n/);for(var n=e.split(/(\\r?\\n)/),r=[],o=0;o<n.length;o+=2)r.push(n[o]+(n[o+1]||\"\"));return r},Lr=Et(\"parse\"),zr=Lr.log,Br=Lr.warn,Nr={varsSep:/^--$/m,modifierPattern:/^\\[([^[].+[^\\]])\\]$/gm};function Fr(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Nr,o={vars:[],blocks:[]},i=e.split(r.varsSep,2);if(2===i.length){zr(\"Detected vars section\");var a=Ke(i,2);t=a[0],n=a[1],Mr(t).forEach((function(e){if(\"\"!==e.trim()){var t=e.indexOf(\":\");if(-1!==t){var n=e.substr(0,t).trim(),r=e.substr(t+1).trim(),i={name:n,value:new Function(\"return (\".concat(r,\")\"))},a=n.match(/\\(.+\\)/);a?(i.condition=new Function(\"return (\".concat(a[0],\")\")),i.name=(i.name.substr(0,a.index)+i.name.substr(a.index+a[0].length)).trim(),zr('Setting variable \"'.concat(i.name,'\" to \"').concat(r,'\" with condition (').concat(a[0],\")\"))):zr('Setting variable \"'.concat(n,'\" to \"').concat(r,'\" without condition')),o.vars.push(i)}else Br('The line \"'.concat(e,'\" in the vars section is missing a colon. It was ignored.'))}}))}else zr(\"No vars section detected\"),n=i[0];for(var s=function(e,t){var n=t.trim();\"\"!==n&&(zr(\"Creating '\".concat(e,\"' block with content: \\\"\").concat(n,'\"')),o.blocks.push({type:e,content:n}))},c=new RegExp(r.modifierPattern),l=0,u=c.exec(n);u;){s(\"text\",n.substring(l,u.index));for(var p=u[1],d=\"\",f=0;f<p.length;f++)switch(p[f]){case'\"':for(d+='\"',f+=1;f<p.length&&(d+=p[f],'\"'!==p[f]||\"\\\\\"===p[f-1]);f++);break;case\";\":s(\"modifier\",d),d=\"\";break;default:d+=p[f]}s(\"modifier\",d),l=c.lastIndex,u=c.exec(n)}return s(\"text\",n.substring(l)),o}var Ur={exports:{}};function $r(){return{baseUrl:null,breaks:!1,gfm:!0,headerIds:!0,headerPrefix:\"\",highlight:null,langPrefix:\"language-\",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}Ur.exports={defaults:{baseUrl:null,breaks:!1,gfm:!0,headerIds:!0,headerPrefix:\"\",highlight:null,langPrefix:\"language-\",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1},getDefaults:$r,changeDefaults:function(e){Ur.exports.defaults=e}};const qr=/[&<>\"']/,Gr=/[&<>\"']/g,Vr=/[<>\"']|&(?!#?\\w+;)/,Jr=/[<>\"']|&(?!#?\\w+;)/g,Hr={\"&\":\"&amp;\",\"<\":\"&lt;\",\">\":\"&gt;\",'\"':\"&quot;\",\"'\":\"&#39;\"},Wr=e=>Hr[e];const Zr=/&(#(?:\\d+)|(?:#x[0-9A-Fa-f]+)|(?:\\w+));?/gi;function Yr(e){return e.replace(Zr,((e,t)=>\"colon\"===(t=t.toLowerCase())?\":\":\"#\"===t.charAt(0)?\"x\"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):\"\"))}const Kr=/(^|[^\\[])\\^/g;const Xr=/[^\\w:]/g,Qr=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;const eo={},to=/^[^:]+:\\/*[^/]*$/,no=/^([^:]+:)[\\s\\S]*$/,ro=/^([^:]+:\\/*[^/]*)[\\s\\S]*$/;function oo(e,t){eo[\" \"+e]||(to.test(e)?eo[\" \"+e]=e+\"/\":eo[\" \"+e]=io(e,\"/\",!0));const n=-1===(e=eo[\" \"+e]).indexOf(\":\");return\"//\"===t.substring(0,2)?n?t:e.replace(no,\"$1\")+t:\"/\"===t.charAt(0)?n?t:e.replace(ro,\"$1\")+t:e+t}function io(e,t,n){const r=e.length;if(0===r)return\"\";let o=0;for(;o<r;){const i=e.charAt(r-o-1);if(i!==t||n){if(i===t||!n)break;o++}else o++}return e.substr(0,r-o)}var ao={escape:function(e,t){if(t){if(qr.test(e))return e.replace(Gr,Wr)}else if(Vr.test(e))return e.replace(Jr,Wr);return e},unescape:Yr,edit:function(e,t){e=e.source||e,t=t||\"\";const n={replace:(t,r)=>(r=(r=r.source||r).replace(Kr,\"$1\"),e=e.replace(t,r),n),getRegex:()=>new RegExp(e,t)};return n},cleanUrl:function(e,t,n){if(e){let e;try{e=decodeURIComponent(Yr(n)).replace(Xr,\"\").toLowerCase()}catch(e){return null}if(0===e.indexOf(\"javascript:\")||0===e.indexOf(\"vbscript:\")||0===e.indexOf(\"data:\"))return null}t&&!Qr.test(n)&&(n=oo(t,n));try{n=encodeURI(n).replace(/%25/g,\"%\")}catch(e){return null}return n},resolveUrl:oo,noopTest:{exec:function(){}},merge:function(e){let t,n,r=1;for(;r<arguments.length;r++)for(n in t=arguments[r],t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},splitCells:function(e,t){const n=e.replace(/\\|/g,((e,t,n)=>{let r=!1,o=t;for(;--o>=0&&\"\\\\\"===n[o];)r=!r;return r?\"|\":\" |\"})).split(/ \\|/);let r=0;if(n.length>t)n.splice(t);else for(;n.length<t;)n.push(\"\");for(;r<n.length;r++)n[r]=n[r].trim().replace(/\\\\\\|/g,\"|\");return n},rtrim:io,findClosingBracket:function(e,t){if(-1===e.indexOf(t[1]))return-1;const n=e.length;let r=0,o=0;for(;o<n;o++)if(\"\\\\\"===e[o])o++;else if(e[o]===t[0])r++;else if(e[o]===t[1]&&(r--,r<0))return o;return-1},checkSanitizeDeprecation:function(e){e&&e.sanitize&&!e.silent&&console.warn(\"marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options\")},repeatString:function(e,t){if(t<1)return\"\";let n=\"\";for(;t>1;)1&t&&(n+=e),t>>=1,e+=e;return n+e}};const{defaults:so}=Ur.exports,{rtrim:co,splitCells:lo,escape:uo,findClosingBracket:po}=ao;function fo(e,t,n){const r=t.href,o=t.title?uo(t.title):null,i=e[1].replace(/\\\\([\\[\\]])/g,\"$1\");return\"!\"!==e[0].charAt(0)?{type:\"link\",raw:n,href:r,title:o,text:i}:{type:\"image\",raw:n,href:r,title:o,text:uo(i)}}var ho=class{constructor(e){this.options=e||so}space(e){const t=this.rules.block.newline.exec(e);if(t)return t[0].length>1?{type:\"space\",raw:t[0]}:{raw:\"\\n\"}}code(e,t){const n=this.rules.block.code.exec(e);if(n){const e=t[t.length-1];if(e&&\"paragraph\"===e.type)return{raw:n[0],text:n[0].trimRight()};const r=n[0].replace(/^ {4}/gm,\"\");return{type:\"code\",raw:n[0],codeBlockStyle:\"indented\",text:this.options.pedantic?r:co(r,\"\\n\")}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const e=t[0],n=function(e,t){const n=e.match(/^(\\s+)(?:```)/);if(null===n)return t;const r=n[1];return t.split(\"\\n\").map((e=>{const t=e.match(/^\\s+/);if(null===t)return e;const[n]=t;return n.length>=r.length?e.slice(r.length):e})).join(\"\\n\")}(e,t[3]||\"\");return{type:\"code\",raw:e,lang:t[2]?t[2].trim():t[2],text:n}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let e=t[2].trim();if(/#$/.test(e)){const t=co(e,\"#\");this.options.pedantic?e=t.trim():t&&!/ $/.test(t)||(e=t.trim())}return{type:\"heading\",raw:t[0],depth:t[1].length,text:e}}}nptable(e){const t=this.rules.block.nptable.exec(e);if(t){const e={type:\"table\",header:lo(t[1].replace(/^ *| *\\| *$/g,\"\")),align:t[2].replace(/^ *|\\| *$/g,\"\").split(/ *\\| */),cells:t[3]?t[3].replace(/\\n$/,\"\").split(\"\\n\"):[],raw:t[0]};if(e.header.length===e.align.length){let t,n=e.align.length;for(t=0;t<n;t++)/^ *-+: *$/.test(e.align[t])?e.align[t]=\"right\":/^ *:-+: *$/.test(e.align[t])?e.align[t]=\"center\":/^ *:-+ *$/.test(e.align[t])?e.align[t]=\"left\":e.align[t]=null;for(n=e.cells.length,t=0;t<n;t++)e.cells[t]=lo(e.cells[t],e.header.length);return e}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:\"hr\",raw:t[0]}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){const e=t[0].replace(/^ *> ?/gm,\"\");return{type:\"blockquote\",raw:t[0],text:e}}}list(e){const t=this.rules.block.list.exec(e);if(t){let e=t[0];const n=t[2],r=n.length>1,o={type:\"list\",raw:e,ordered:r,start:r?+n.slice(0,-1):\"\",loose:!1,items:[]},i=t[0].match(this.rules.block.item);let a,s,c,l,u,p,d,f,h=!1,m=i.length;c=this.rules.block.listItemStart.exec(i[0]);for(let t=0;t<m;t++){if(a=i[t],e=a,t!==m-1){if(l=this.rules.block.listItemStart.exec(i[t+1]),l[1].length>c[0].length||l[1].length>3){i.splice(t,2,i[t]+\"\\n\"+i[t+1]),t--,m--;continue}(!this.options.pedantic||this.options.smartLists?l[2][l[2].length-1]!==n[n.length-1]:r===(1===l[2].length))&&(u=i.slice(t+1).join(\"\\n\"),o.raw=o.raw.substring(0,o.raw.length-u.length),t=m-1),c=l}s=a.length,a=a.replace(/^ *([*+-]|\\d+[.)]) ?/,\"\"),~a.indexOf(\"\\n \")&&(s-=a.length,a=this.options.pedantic?a.replace(/^ {1,4}/gm,\"\"):a.replace(new RegExp(\"^ {1,\"+s+\"}\",\"gm\"),\"\")),p=h||/\\n\\n(?!\\s*$)/.test(a),t!==m-1&&(h=\"\\n\"===a.charAt(a.length-1),p||(p=h)),p&&(o.loose=!0),this.options.gfm&&(d=/^\\[[ xX]\\] /.test(a),f=void 0,d&&(f=\" \"!==a[1],a=a.replace(/^\\[[ xX]\\] +/,\"\"))),o.items.push({type:\"list_item\",raw:e,task:d,checked:f,loose:p,text:a})}return o}}html(e){const t=this.rules.block.html.exec(e);if(t)return{type:this.options.sanitize?\"paragraph\":\"html\",raw:t[0],pre:!this.options.sanitizer&&(\"pre\"===t[1]||\"script\"===t[1]||\"style\"===t[1]),text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(t[0]):uo(t[0]):t[0]}}def(e){const t=this.rules.block.def.exec(e);if(t){t[3]&&(t[3]=t[3].substring(1,t[3].length-1));return{tag:t[1].toLowerCase().replace(/\\s+/g,\" \"),raw:t[0],href:t[2],title:t[3]}}}table(e){const t=this.rules.block.table.exec(e);if(t){const e={type:\"table\",header:lo(t[1].replace(/^ *| *\\| *$/g,\"\")),align:t[2].replace(/^ *|\\| *$/g,\"\").split(/ *\\| */),cells:t[3]?t[3].replace(/\\n$/,\"\").split(\"\\n\"):[]};if(e.header.length===e.align.length){e.raw=t[0];let n,r=e.align.length;for(n=0;n<r;n++)/^ *-+: *$/.test(e.align[n])?e.align[n]=\"right\":/^ *:-+: *$/.test(e.align[n])?e.align[n]=\"center\":/^ *:-+ *$/.test(e.align[n])?e.align[n]=\"left\":e.align[n]=null;for(r=e.cells.length,n=0;n<r;n++)e.cells[n]=lo(e.cells[n].replace(/^ *\\| *| *\\| *$/g,\"\"),e.header.length);return e}}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:\"heading\",raw:t[0],depth:\"=\"===t[2].charAt(0)?1:2,text:t[1]}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t)return{type:\"paragraph\",raw:t[0],text:\"\\n\"===t[1].charAt(t[1].length-1)?t[1].slice(0,-1):t[1]}}text(e,t){const n=this.rules.block.text.exec(e);if(n){const e=t[t.length-1];return e&&\"text\"===e.type?{raw:n[0],text:n[0]}:{type:\"text\",raw:n[0],text:n[0]}}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:\"escape\",raw:t[0],text:uo(t[1])}}tag(e,t,n){const r=this.rules.inline.tag.exec(e);if(r)return!t&&/^<a /i.test(r[0])?t=!0:t&&/^<\\/a>/i.test(r[0])&&(t=!1),!n&&/^<(pre|code|kbd|script)(\\s|>)/i.test(r[0])?n=!0:n&&/^<\\/(pre|code|kbd|script)(\\s|>)/i.test(r[0])&&(n=!1),{type:this.options.sanitize?\"text\":\"html\",raw:r[0],inLink:t,inRawBlock:n,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(r[0]):uo(r[0]):r[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const e=t[2].trim();if(!this.options.pedantic&&/^</.test(e)){if(!/>$/.test(e))return;const t=co(e.slice(0,-1),\"\\\\\");if((e.length-t.length)%2==0)return}else{const e=po(t[2],\"()\");if(e>-1){const n=(0===t[0].indexOf(\"!\")?5:4)+t[1].length+e;t[2]=t[2].substring(0,e),t[0]=t[0].substring(0,n).trim(),t[3]=\"\"}}let n=t[2],r=\"\";if(this.options.pedantic){const e=/^([^'\"]*[^\\s])\\s+(['\"])(.*)\\2/.exec(n);e&&(n=e[1],r=e[3])}else r=t[3]?t[3].slice(1,-1):\"\";return n=n.trim(),/^</.test(n)&&(n=this.options.pedantic&&!/>$/.test(e)?n.slice(1):n.slice(1,-1)),fo(t,{href:n?n.replace(this.rules.inline._escapes,\"$1\"):n,title:r?r.replace(this.rules.inline._escapes,\"$1\"):r},t[0])}}reflink(e,t){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){let e=(n[2]||n[1]).replace(/\\s+/g,\" \");if(e=t[e.toLowerCase()],!e||!e.href){const e=n[0].charAt(0);return{type:\"text\",raw:e,text:e}}return fo(n,e,n[0])}}strong(e,t,n=\"\"){let r=this.rules.inline.strong.start.exec(e);if(r&&(!r[1]||r[1]&&(\"\"===n||this.rules.inline.punctuation.exec(n)))){t=t.slice(-1*e.length);const n=\"**\"===r[0]?this.rules.inline.strong.endAst:this.rules.inline.strong.endUnd;let o;for(n.lastIndex=0;null!=(r=n.exec(t));)if(o=this.rules.inline.strong.middle.exec(t.slice(0,r.index+3)),o)return{type:\"strong\",raw:e.slice(0,o[0].length),text:e.slice(2,o[0].length-2)}}}em(e,t,n=\"\"){let r=this.rules.inline.em.start.exec(e);if(r&&(!r[1]||r[1]&&(\"\"===n||this.rules.inline.punctuation.exec(n)))){t=t.slice(-1*e.length);const n=\"*\"===r[0]?this.rules.inline.em.endAst:this.rules.inline.em.endUnd;let o;for(n.lastIndex=0;null!=(r=n.exec(t));)if(o=this.rules.inline.em.middle.exec(t.slice(0,r.index+2)),o)return{type:\"em\",raw:e.slice(0,o[0].length),text:e.slice(1,o[0].length-1)}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let e=t[2].replace(/\\n/g,\" \");const n=/[^ ]/.test(e),r=/^ /.test(e)&&/ $/.test(e);return n&&r&&(e=e.substring(1,e.length-1)),e=uo(e,!0),{type:\"codespan\",raw:t[0],text:e}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:\"br\",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:\"del\",raw:t[0],text:t[2]}}autolink(e,t){const n=this.rules.inline.autolink.exec(e);if(n){let e,r;return\"@\"===n[2]?(e=uo(this.options.mangle?t(n[1]):n[1]),r=\"mailto:\"+e):(e=uo(n[1]),r=e),{type:\"link\",raw:n[0],text:e,href:r,tokens:[{type:\"text\",raw:e,text:e}]}}}url(e,t){let n;if(n=this.rules.inline.url.exec(e)){let e,r;if(\"@\"===n[2])e=uo(this.options.mangle?t(n[0]):n[0]),r=\"mailto:\"+e;else{let t;do{t=n[0],n[0]=this.rules.inline._backpedal.exec(n[0])[0]}while(t!==n[0]);e=uo(n[0]),r=\"www.\"===n[1]?\"http://\"+e:e}return{type:\"link\",raw:n[0],text:e,href:r,tokens:[{type:\"text\",raw:e,text:e}]}}}inlineText(e,t,n){const r=this.rules.inline.text.exec(e);if(r){let e;return e=t?this.options.sanitize?this.options.sanitizer?this.options.sanitizer(r[0]):uo(r[0]):r[0]:uo(this.options.smartypants?n(r[0]):r[0]),{type:\"text\",raw:r[0],text:e}}}};const{noopTest:mo,edit:go,merge:yo}=ao,vo={newline:/^\\n+/,code:/^( {4}[^\\n]+\\n*)+/,fences:/^ {0,3}(`{3,}(?=[^`\\n]*\\n)|~{3,})([^\\n]*)\\n(?:|([\\s\\S]*?)\\n)(?: {0,3}\\1[~`]* *(?:\\n+|$)|$)/,hr:/^ {0,3}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\\s|$)(.*)(?:\\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\\n]*)(?:\\n|$))+/,list:/^( {0,3})(bull) [\\s\\S]+?(?:hr|def|\\n{2,}(?! )(?! {0,3}bull )\\n*|\\s*$)/,html:\"^ {0,3}(?:<(script|pre|style)[\\\\s>][\\\\s\\\\S]*?(?:</\\\\1>[^\\\\n]*\\\\n+|$)|comment[^\\\\n]*(\\\\n+|$)|<\\\\?[\\\\s\\\\S]*?(?:\\\\?>\\\\n*|$)|<![A-Z][\\\\s\\\\S]*?(?:>\\\\n*|$)|<!\\\\[CDATA\\\\[[\\\\s\\\\S]*?(?:\\\\]\\\\]>\\\\n*|$)|</?(tag)(?: +|\\\\n|/?>)[\\\\s\\\\S]*?(?:\\\\n{2,}|$)|<(?!script|pre|style)([a-z][\\\\w-]*)(?:attribute)*? */?>(?=[ \\\\t]*(?:\\\\n|$))[\\\\s\\\\S]*?(?:\\\\n{2,}|$)|</(?!script|pre|style)[a-z][\\\\w-]*\\\\s*>(?=[ \\\\t]*(?:\\\\n|$))[\\\\s\\\\S]*?(?:\\\\n{2,}|$))\",def:/^ {0,3}\\[(label)\\]: *\\n? *<?([^\\s>]+)>?(?:(?: +\\n? *| *\\n *)(title))? *(?:\\n+|$)/,nptable:mo,table:mo,lheading:/^([^\\n]+)\\n {0,3}(=+|-+) *(?:\\n+|$)/,_paragraph:/^([^\\n]+(?:\\n(?!hr|heading|lheading|blockquote|fences|list|html)[^\\n]+)*)/,text:/^[^\\n]+/,_label:/(?!\\s*\\])(?:\\\\[\\[\\]]|[^\\[\\]])+/,_title:/(?:\"(?:\\\\\"?|[^\"\\\\])*\"|'[^'\\n]*(?:\\n[^'\\n]+)*\\n?'|\\([^()]*\\))/};vo.def=go(vo.def).replace(\"label\",vo._label).replace(\"title\",vo._title).getRegex(),vo.bullet=/(?:[*+-]|\\d{1,9}[.)])/,vo.item=/^( *)(bull) ?[^\\n]*(?:\\n(?! *bull ?)[^\\n]*)*/,vo.item=go(vo.item,\"gm\").replace(/bull/g,vo.bullet).getRegex(),vo.listItemStart=go(/^( *)(bull)/).replace(\"bull\",vo.bullet).getRegex(),vo.list=go(vo.list).replace(/bull/g,vo.bullet).replace(\"hr\",\"\\\\n+(?=\\\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\\\* *){3,})(?:\\\\n+|$))\").replace(\"def\",\"\\\\n+(?=\"+vo.def.source+\")\").getRegex(),vo._tag=\"address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul\",vo._comment=/<!--(?!-?>)[\\s\\S]*?(?:-->|$)/,vo.html=go(vo.html,\"i\").replace(\"comment\",vo._comment).replace(\"tag\",vo._tag).replace(\"attribute\",/ +[a-zA-Z:_][\\w.:-]*(?: *= *\"[^\"\\n]*\"| *= *'[^'\\n]*'| *= *[^\\s\"'=<>`]+)?/).getRegex(),vo.paragraph=go(vo._paragraph).replace(\"hr\",vo.hr).replace(\"heading\",\" {0,3}#{1,6} \").replace(\"|lheading\",\"\").replace(\"blockquote\",\" {0,3}>\").replace(\"fences\",\" {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n\").replace(\"list\",\" {0,3}(?:[*+-]|1[.)]) \").replace(\"html\",\"</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|!--)\").replace(\"tag\",vo._tag).getRegex(),vo.blockquote=go(vo.blockquote).replace(\"paragraph\",vo.paragraph).getRegex(),vo.normal=yo({},vo),vo.gfm=yo({},vo.normal,{nptable:\"^ *([^|\\\\n ].*\\\\|.*)\\\\n {0,3}([-:]+ *\\\\|[-| :]*)(?:\\\\n((?:(?!\\\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\\\n|$))*)\\\\n*|$)\",table:\"^ *\\\\|(.+)\\\\n {0,3}\\\\|?( *[-:]+[-| :]*)(?:\\\\n *((?:(?!\\\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\\\n|$))*)\\\\n*|$)\"}),vo.gfm.nptable=go(vo.gfm.nptable).replace(\"hr\",vo.hr).replace(\"heading\",\" {0,3}#{1,6} \").replace(\"blockquote\",\" {0,3}>\").replace(\"code\",\" {4}[^\\\\n]\").replace(\"fences\",\" {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n\").replace(\"list\",\" {0,3}(?:[*+-]|1[.)]) \").replace(\"html\",\"</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|!--)\").replace(\"tag\",vo._tag).getRegex(),vo.gfm.table=go(vo.gfm.table).replace(\"hr\",vo.hr).replace(\"heading\",\" {0,3}#{1,6} \").replace(\"blockquote\",\" {0,3}>\").replace(\"code\",\" {4}[^\\\\n]\").replace(\"fences\",\" {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n\").replace(\"list\",\" {0,3}(?:[*+-]|1[.)]) \").replace(\"html\",\"</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|!--)\").replace(\"tag\",vo._tag).getRegex(),vo.pedantic=yo({},vo.normal,{html:go(\"^ *(?:comment *(?:\\\\n|\\\\s*$)|<(tag)[\\\\s\\\\S]+?</\\\\1> *(?:\\\\n{2,}|\\\\s*$)|<tag(?:\\\"[^\\\"]*\\\"|'[^']*'|\\\\s[^'\\\"/>\\\\s]*)*?/?> *(?:\\\\n{2,}|\\\\s*$))\").replace(\"comment\",vo._comment).replace(/tag/g,\"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\\\b)\\\\w+(?!:|[^\\\\w\\\\s@]*@)\\\\b\").getRegex(),def:/^ *\\[([^\\]]+)\\]: *<?([^\\s>]+)>?(?: +([\"(][^\\n]+[\")]))? *(?:\\n+|$)/,heading:/^(#{1,6})(.*)(?:\\n+|$)/,fences:mo,paragraph:go(vo.normal._paragraph).replace(\"hr\",vo.hr).replace(\"heading\",\" *#{1,6} *[^\\n]\").replace(\"lheading\",vo.lheading).replace(\"blockquote\",\" {0,3}>\").replace(\"|fences\",\"\").replace(\"|list\",\"\").replace(\"|html\",\"\").getRegex()});const bo={escape:/^\\\\([!\"#$%&'()*+,\\-./:;<=>?@\\[\\]\\\\^_`{|}~])/,autolink:/^<(scheme:[^\\s\\x00-\\x1f<>]*|email)>/,url:mo,tag:\"^comment|^</[a-zA-Z][\\\\w:-]*\\\\s*>|^<[a-zA-Z][\\\\w-]*(?:attribute)*?\\\\s*/?>|^<\\\\?[\\\\s\\\\S]*?\\\\?>|^<![a-zA-Z]+\\\\s[\\\\s\\\\S]*?>|^<!\\\\[CDATA\\\\[[\\\\s\\\\S]*?\\\\]\\\\]>\",link:/^!?\\[(label)\\]\\(\\s*(href)(?:\\s+(title))?\\s*\\)/,reflink:/^!?\\[(label)\\]\\[(?!\\s*\\])((?:\\\\[\\[\\]]?|[^\\[\\]\\\\])+)\\]/,nolink:/^!?\\[(?!\\s*\\])((?:\\[[^\\[\\]]*\\]|\\\\[\\[\\]]|[^\\[\\]])*)\\](?:\\[\\])?/,reflinkSearch:\"reflink|nolink(?!\\\\()\",strong:{start:/^(?:(\\*\\*(?=[*punctuation]))|\\*\\*)(?![\\s])|__/,middle:/^\\*\\*(?:(?:(?!overlapSkip)(?:[^*]|\\\\\\*)|overlapSkip)|\\*(?:(?!overlapSkip)(?:[^*]|\\\\\\*)|overlapSkip)*?\\*)+?\\*\\*$|^__(?![\\s])((?:(?:(?!overlapSkip)(?:[^_]|\\\\_)|overlapSkip)|_(?:(?!overlapSkip)(?:[^_]|\\\\_)|overlapSkip)*?_)+?)__$/,endAst:/[^punctuation\\s]\\*\\*(?!\\*)|[punctuation]\\*\\*(?!\\*)(?:(?=[punctuation_\\s]|$))/,endUnd:/[^\\s]__(?!_)(?:(?=[punctuation*\\s])|$)/},em:{start:/^(?:(\\*(?=[punctuation]))|\\*)(?![*\\s])|_/,middle:/^\\*(?:(?:(?!overlapSkip)(?:[^*]|\\\\\\*)|overlapSkip)|\\*(?:(?!overlapSkip)(?:[^*]|\\\\\\*)|overlapSkip)*?\\*)+?\\*$|^_(?![_\\s])(?:(?:(?!overlapSkip)(?:[^_]|\\\\_)|overlapSkip)|_(?:(?!overlapSkip)(?:[^_]|\\\\_)|overlapSkip)*?_)+?_$/,endAst:/[^punctuation\\s]\\*(?!\\*)|[punctuation]\\*(?!\\*)(?:(?=[punctuation_\\s]|$))/,endUnd:/[^\\s]_(?!_)(?:(?=[punctuation*\\s])|$)/},code:/^(`+)([^`]|[^`][\\s\\S]*?[^`])\\1(?!`)/,br:/^( {2,}|\\\\)\\n(?!\\s*$)/,del:mo,text:/^(`+|[^`])(?:(?= {2,}\\n)|[\\s\\S]*?(?:(?=[\\\\<!\\[`*]|\\b_|$)|[^ ](?= {2,}\\n)))/,punctuation:/^([\\s*punctuation])/,_punctuation:\"!\\\"#$%&'()+\\\\-.,/:;<=>?@\\\\[\\\\]`^{|}~\"};bo.punctuation=go(bo.punctuation).replace(/punctuation/g,bo._punctuation).getRegex(),bo._blockSkip=\"\\\\[[^\\\\]]*?\\\\]\\\\([^\\\\)]*?\\\\)|`[^`]*?`|<[^>]*?>\",bo._overlapSkip=\"__[^_]*?__|\\\\*\\\\*\\\\[^\\\\*\\\\]*?\\\\*\\\\*\",bo._comment=go(vo._comment).replace(\"(?:--\\x3e|$)\",\"--\\x3e\").getRegex(),bo.em.start=go(bo.em.start).replace(/punctuation/g,bo._punctuation).getRegex(),bo.em.middle=go(bo.em.middle).replace(/punctuation/g,bo._punctuation).replace(/overlapSkip/g,bo._overlapSkip).getRegex(),bo.em.endAst=go(bo.em.endAst,\"g\").replace(/punctuation/g,bo._punctuation).getRegex(),bo.em.endUnd=go(bo.em.endUnd,\"g\").replace(/punctuation/g,bo._punctuation).getRegex(),bo.strong.start=go(bo.strong.start).replace(/punctuation/g,bo._punctuation).getRegex(),bo.strong.middle=go(bo.strong.middle).replace(/punctuation/g,bo._punctuation).replace(/overlapSkip/g,bo._overlapSkip).getRegex(),bo.strong.endAst=go(bo.strong.endAst,\"g\").replace(/punctuation/g,bo._punctuation).getRegex(),bo.strong.endUnd=go(bo.strong.endUnd,\"g\").replace(/punctuation/g,bo._punctuation).getRegex(),bo.blockSkip=go(bo._blockSkip,\"g\").getRegex(),bo.overlapSkip=go(bo._overlapSkip,\"g\").getRegex(),bo._escapes=/\\\\([!\"#$%&'()*+,\\-./:;<=>?@\\[\\]\\\\^_`{|}~])/g,bo._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/,bo._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/,bo.autolink=go(bo.autolink).replace(\"scheme\",bo._scheme).replace(\"email\",bo._email).getRegex(),bo._attribute=/\\s+[a-zA-Z:_][\\w.:-]*(?:\\s*=\\s*\"[^\"]*\"|\\s*=\\s*'[^']*'|\\s*=\\s*[^\\s\"'=<>`]+)?/,bo.tag=go(bo.tag).replace(\"comment\",bo._comment).replace(\"attribute\",bo._attribute).getRegex(),bo._label=/(?:\\[(?:\\\\.|[^\\[\\]\\\\])*\\]|\\\\.|`[^`]*`|[^\\[\\]\\\\`])*?/,bo._href=/<(?:\\\\.|[^\\n<>\\\\])+>|[^\\s\\x00-\\x1f]*/,bo._title=/\"(?:\\\\\"?|[^\"\\\\])*\"|'(?:\\\\'?|[^'\\\\])*'|\\((?:\\\\\\)?|[^)\\\\])*\\)/,bo.link=go(bo.link).replace(\"label\",bo._label).replace(\"href\",bo._href).replace(\"title\",bo._title).getRegex(),bo.reflink=go(bo.reflink).replace(\"label\",bo._label).getRegex(),bo.reflinkSearch=go(bo.reflinkSearch,\"g\").replace(\"reflink\",bo.reflink).replace(\"nolink\",bo.nolink).getRegex(),bo.normal=yo({},bo),bo.pedantic=yo({},bo.normal,{strong:{start:/^__|\\*\\*/,middle:/^__(?=\\S)([\\s\\S]*?\\S)__(?!_)|^\\*\\*(?=\\S)([\\s\\S]*?\\S)\\*\\*(?!\\*)/,endAst:/\\*\\*(?!\\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\\*/,middle:/^()\\*(?=\\S)([\\s\\S]*?\\S)\\*(?!\\*)|^_(?=\\S)([\\s\\S]*?\\S)_(?!_)/,endAst:/\\*(?!\\*)/g,endUnd:/_(?!_)/g},link:go(/^!?\\[(label)\\]\\((.*?)\\)/).replace(\"label\",bo._label).getRegex(),reflink:go(/^!?\\[(label)\\]\\s*\\[([^\\]]*)\\]/).replace(\"label\",bo._label).getRegex()}),bo.gfm=yo({},bo.normal,{escape:go(bo.escape).replace(\"])\",\"~|])\").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\\/\\/|www\\.)(?:[a-zA-Z0-9\\-]+\\.?)+[^\\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_~()&]+|\\([^)]*\\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_~)]+(?!$))+/,del:/^(~~?)(?=[^\\s~])([\\s\\S]*?[^\\s~])\\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\\n)|[\\s\\S]*?(?:(?=[\\\\<!\\[`*~]|\\b_|https?:\\/\\/|ftp:\\/\\/|www\\.|$)|[^ ](?= {2,}\\n)|[^a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-](?=[a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-]+@))|(?=[a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-]+@))/}),bo.gfm.url=go(bo.gfm.url,\"i\").replace(\"email\",bo.gfm._extended_email).getRegex(),bo.breaks=yo({},bo.gfm,{br:go(bo.br).replace(\"{2,}\",\"*\").getRegex(),text:go(bo.gfm.text).replace(\"\\\\b_\",\"\\\\b_| {2,}\\\\n\").replace(/\\{2,\\}/g,\"*\").getRegex()});var wo={block:vo,inline:bo};const ko=ho,{defaults:_o}=Ur.exports,{block:So,inline:Co}=wo,{repeatString:xo}=ao;function To(e){return e.replace(/---/g,\"—\").replace(/--/g,\"–\").replace(/(^|[-\\u2014/(\\[{\"\\s])'/g,\"$1‘\").replace(/'/g,\"’\").replace(/(^|[-\\u2014/(\\[{\\u2018\\s])\"/g,\"$1“\").replace(/\"/g,\"”\").replace(/\\.{3}/g,\"…\")}function Eo(e){let t,n,r=\"\";const o=e.length;for(t=0;t<o;t++)n=e.charCodeAt(t),Math.random()>.5&&(n=\"x\"+n.toString(16)),r+=\"&#\"+n+\";\";return r}const{defaults:Po}=Ur.exports,{cleanUrl:Ro,escape:Oo}=ao;var jo=class{constructor(e){this.options=e||Po}code(e,t,n){const r=(t||\"\").match(/\\S*/)[0];if(this.options.highlight){const t=this.options.highlight(e,r);null!=t&&t!==e&&(n=!0,e=t)}return r?'<pre><code class=\"'+this.options.langPrefix+Oo(r,!0)+'\">'+(n?e:Oo(e,!0))+\"</code></pre>\\n\":\"<pre><code>\"+(n?e:Oo(e,!0))+\"</code></pre>\\n\"}blockquote(e){return\"<blockquote>\\n\"+e+\"</blockquote>\\n\"}html(e){return e}heading(e,t,n,r){return this.options.headerIds?\"<h\"+t+' id=\"'+this.options.headerPrefix+r.slug(n)+'\">'+e+\"</h\"+t+\">\\n\":\"<h\"+t+\">\"+e+\"</h\"+t+\">\\n\"}hr(){return this.options.xhtml?\"<hr/>\\n\":\"<hr>\\n\"}list(e,t,n){const r=t?\"ol\":\"ul\";return\"<\"+r+(t&&1!==n?' start=\"'+n+'\"':\"\")+\">\\n\"+e+\"</\"+r+\">\\n\"}listitem(e){return\"<li>\"+e+\"</li>\\n\"}checkbox(e){return\"<input \"+(e?'checked=\"\" ':\"\")+'disabled=\"\" type=\"checkbox\"'+(this.options.xhtml?\" /\":\"\")+\"> \"}paragraph(e){return\"<p>\"+e+\"</p>\\n\"}table(e,t){return t&&(t=\"<tbody>\"+t+\"</tbody>\"),\"<table>\\n<thead>\\n\"+e+\"</thead>\\n\"+t+\"</table>\\n\"}tablerow(e){return\"<tr>\\n\"+e+\"</tr>\\n\"}tablecell(e,t){const n=t.header?\"th\":\"td\";return(t.align?\"<\"+n+' align=\"'+t.align+'\">':\"<\"+n+\">\")+e+\"</\"+n+\">\\n\"}strong(e){return\"<strong>\"+e+\"</strong>\"}em(e){return\"<em>\"+e+\"</em>\"}codespan(e){return\"<code>\"+e+\"</code>\"}br(){return this.options.xhtml?\"<br/>\":\"<br>\"}del(e){return\"<del>\"+e+\"</del>\"}link(e,t,n){if(null===(e=Ro(this.options.sanitize,this.options.baseUrl,e)))return n;let r='<a href=\"'+Oo(e)+'\"';return t&&(r+=' title=\"'+t+'\"'),r+=\">\"+n+\"</a>\",r}image(e,t,n){if(null===(e=Ro(this.options.sanitize,this.options.baseUrl,e)))return n;let r='<img src=\"'+e+'\" alt=\"'+n+'\"';return t&&(r+=' title=\"'+t+'\"'),r+=this.options.xhtml?\"/>\":\">\",r}text(e){return e}},Do=class{strong(e){return e}em(e){return e}codespan(e){return e}del(e){return e}html(e){return e}text(e){return e}link(e,t,n){return\"\"+n}image(e,t,n){return\"\"+n}br(){return\"\"}},Io=class{constructor(){this.seen={}}serialize(e){return e.toLowerCase().trim().replace(/<[!\\/a-z].*?>/gi,\"\").replace(/[\\u2000-\\u206F\\u2E00-\\u2E7F\\\\'!\"#$%&()*+,./:;<=>?@[\\]^`{|}~]/g,\"\").replace(/\\s/g,\"-\")}getNextSafeSlug(e,t){let n=e,r=0;if(this.seen.hasOwnProperty(n)){r=this.seen[e];do{r++,n=e+\"-\"+r}while(this.seen.hasOwnProperty(n))}return t||(this.seen[e]=r,this.seen[n]=0),n}slug(e,t={}){const n=this.serialize(e);return this.getNextSafeSlug(n,t.dryrun)}};const Ao=jo,Mo=Do,Lo=Io,{defaults:zo}=Ur.exports,{unescape:Bo}=ao;const No=class e{constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||_o,this.options.tokenizer=this.options.tokenizer||new ko,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options;const t={block:So.normal,inline:Co.normal};this.options.pedantic?(t.block=So.pedantic,t.inline=Co.pedantic):this.options.gfm&&(t.block=So.gfm,this.options.breaks?t.inline=Co.breaks:t.inline=Co.gfm),this.tokenizer.rules=t}static get rules(){return{block:So,inline:Co}}static lex(t,n){return new e(n).lex(t)}static lexInline(t,n){return new e(n).inlineTokens(t)}lex(e){return e=e.replace(/\\r\\n|\\r/g,\"\\n\").replace(/\\t/g,\"    \"),this.blockTokens(e,this.tokens,!0),this.inline(this.tokens),this.tokens}blockTokens(e,t=[],n=!0){let r,o,i,a;for(e=e.replace(/^ +$/gm,\"\");e;)if(r=this.tokenizer.space(e))e=e.substring(r.raw.length),r.type&&t.push(r);else if(r=this.tokenizer.code(e,t))e=e.substring(r.raw.length),r.type?t.push(r):(a=t[t.length-1],a.raw+=\"\\n\"+r.raw,a.text+=\"\\n\"+r.text);else if(r=this.tokenizer.fences(e))e=e.substring(r.raw.length),t.push(r);else if(r=this.tokenizer.heading(e))e=e.substring(r.raw.length),t.push(r);else if(r=this.tokenizer.nptable(e))e=e.substring(r.raw.length),t.push(r);else if(r=this.tokenizer.hr(e))e=e.substring(r.raw.length),t.push(r);else if(r=this.tokenizer.blockquote(e))e=e.substring(r.raw.length),r.tokens=this.blockTokens(r.text,[],n),t.push(r);else if(r=this.tokenizer.list(e)){for(e=e.substring(r.raw.length),i=r.items.length,o=0;o<i;o++)r.items[o].tokens=this.blockTokens(r.items[o].text,[],!1);t.push(r)}else if(r=this.tokenizer.html(e))e=e.substring(r.raw.length),t.push(r);else if(n&&(r=this.tokenizer.def(e)))e=e.substring(r.raw.length),this.tokens.links[r.tag]||(this.tokens.links[r.tag]={href:r.href,title:r.title});else if(r=this.tokenizer.table(e))e=e.substring(r.raw.length),t.push(r);else if(r=this.tokenizer.lheading(e))e=e.substring(r.raw.length),t.push(r);else if(n&&(r=this.tokenizer.paragraph(e)))e=e.substring(r.raw.length),t.push(r);else if(r=this.tokenizer.text(e,t))e=e.substring(r.raw.length),r.type?t.push(r):(a=t[t.length-1],a.raw+=\"\\n\"+r.raw,a.text+=\"\\n\"+r.text);else if(e){const t=\"Infinite loop on byte: \"+e.charCodeAt(0);if(this.options.silent){console.error(t);break}throw new Error(t)}return t}inline(e){let t,n,r,o,i,a;const s=e.length;for(t=0;t<s;t++)switch(a=e[t],a.type){case\"paragraph\":case\"text\":case\"heading\":a.tokens=[],this.inlineTokens(a.text,a.tokens);break;case\"table\":for(a.tokens={header:[],cells:[]},o=a.header.length,n=0;n<o;n++)a.tokens.header[n]=[],this.inlineTokens(a.header[n],a.tokens.header[n]);for(o=a.cells.length,n=0;n<o;n++)for(i=a.cells[n],a.tokens.cells[n]=[],r=0;r<i.length;r++)a.tokens.cells[n][r]=[],this.inlineTokens(i[r],a.tokens.cells[n][r]);break;case\"blockquote\":this.inline(a.tokens);break;case\"list\":for(o=a.items.length,n=0;n<o;n++)this.inline(a.items[n].tokens)}return e}inlineTokens(e,t=[],n=!1,r=!1){let o,i,a,s,c=e;if(this.tokens.links){const e=Object.keys(this.tokens.links);if(e.length>0)for(;null!=(i=this.tokenizer.rules.inline.reflinkSearch.exec(c));)e.includes(i[0].slice(i[0].lastIndexOf(\"[\")+1,-1))&&(c=c.slice(0,i.index)+\"[\"+xo(\"a\",i[0].length-2)+\"]\"+c.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(i=this.tokenizer.rules.inline.blockSkip.exec(c));)c=c.slice(0,i.index)+\"[\"+xo(\"a\",i[0].length-2)+\"]\"+c.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;e;)if(a||(s=\"\"),a=!1,o=this.tokenizer.escape(e))e=e.substring(o.raw.length),t.push(o);else if(o=this.tokenizer.tag(e,n,r))e=e.substring(o.raw.length),n=o.inLink,r=o.inRawBlock,t.push(o);else if(o=this.tokenizer.link(e))e=e.substring(o.raw.length),\"link\"===o.type&&(o.tokens=this.inlineTokens(o.text,[],!0,r)),t.push(o);else if(o=this.tokenizer.reflink(e,this.tokens.links))e=e.substring(o.raw.length),\"link\"===o.type&&(o.tokens=this.inlineTokens(o.text,[],!0,r)),t.push(o);else if(o=this.tokenizer.strong(e,c,s))e=e.substring(o.raw.length),o.tokens=this.inlineTokens(o.text,[],n,r),t.push(o);else if(o=this.tokenizer.em(e,c,s))e=e.substring(o.raw.length),o.tokens=this.inlineTokens(o.text,[],n,r),t.push(o);else if(o=this.tokenizer.codespan(e))e=e.substring(o.raw.length),t.push(o);else if(o=this.tokenizer.br(e))e=e.substring(o.raw.length),t.push(o);else if(o=this.tokenizer.del(e))e=e.substring(o.raw.length),o.tokens=this.inlineTokens(o.text,[],n,r),t.push(o);else if(o=this.tokenizer.autolink(e,Eo))e=e.substring(o.raw.length),t.push(o);else if(n||!(o=this.tokenizer.url(e,Eo))){if(o=this.tokenizer.inlineText(e,r,To))e=e.substring(o.raw.length),s=o.raw.slice(-1),a=!0,t.push(o);else if(e){const t=\"Infinite loop on byte: \"+e.charCodeAt(0);if(this.options.silent){console.error(t);break}throw new Error(t)}}else e=e.substring(o.raw.length),t.push(o);return t}},Fo=class e{constructor(e){this.options=e||zo,this.options.renderer=this.options.renderer||new Ao,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new Mo,this.slugger=new Lo}static parse(t,n){return new e(n).parse(t)}static parseInline(t,n){return new e(n).parseInline(t)}parse(e,t=!0){let n,r,o,i,a,s,c,l,u,p,d,f,h,m,g,y,v,b,w=\"\";const k=e.length;for(n=0;n<k;n++)switch(p=e[n],p.type){case\"space\":continue;case\"hr\":w+=this.renderer.hr();continue;case\"heading\":w+=this.renderer.heading(this.parseInline(p.tokens),p.depth,Bo(this.parseInline(p.tokens,this.textRenderer)),this.slugger);continue;case\"code\":w+=this.renderer.code(p.text,p.lang,p.escaped);continue;case\"table\":for(l=\"\",c=\"\",i=p.header.length,r=0;r<i;r++)c+=this.renderer.tablecell(this.parseInline(p.tokens.header[r]),{header:!0,align:p.align[r]});for(l+=this.renderer.tablerow(c),u=\"\",i=p.cells.length,r=0;r<i;r++){for(s=p.tokens.cells[r],c=\"\",a=s.length,o=0;o<a;o++)c+=this.renderer.tablecell(this.parseInline(s[o]),{header:!1,align:p.align[o]});u+=this.renderer.tablerow(c)}w+=this.renderer.table(l,u);continue;case\"blockquote\":u=this.parse(p.tokens),w+=this.renderer.blockquote(u);continue;case\"list\":for(d=p.ordered,f=p.start,h=p.loose,i=p.items.length,u=\"\",r=0;r<i;r++)g=p.items[r],y=g.checked,v=g.task,m=\"\",g.task&&(b=this.renderer.checkbox(y),h?g.tokens.length>0&&\"text\"===g.tokens[0].type?(g.tokens[0].text=b+\" \"+g.tokens[0].text,g.tokens[0].tokens&&g.tokens[0].tokens.length>0&&\"text\"===g.tokens[0].tokens[0].type&&(g.tokens[0].tokens[0].text=b+\" \"+g.tokens[0].tokens[0].text)):g.tokens.unshift({type:\"text\",text:b}):m+=b),m+=this.parse(g.tokens,h),u+=this.renderer.listitem(m,v,y);w+=this.renderer.list(u,d,f);continue;case\"html\":w+=this.renderer.html(p.text);continue;case\"paragraph\":w+=this.renderer.paragraph(this.parseInline(p.tokens));continue;case\"text\":for(u=p.tokens?this.parseInline(p.tokens):p.text;n+1<k&&\"text\"===e[n+1].type;)p=e[++n],u+=\"\\n\"+(p.tokens?this.parseInline(p.tokens):p.text);w+=t?this.renderer.paragraph(u):u;continue;default:{const e='Token with \"'+p.type+'\" type was not found.';if(this.options.silent)return void console.error(e);throw new Error(e)}}return w}parseInline(e,t){t=t||this.renderer;let n,r,o=\"\";const i=e.length;for(n=0;n<i;n++)switch(r=e[n],r.type){case\"escape\":case\"text\":o+=t.text(r.text);break;case\"html\":o+=t.html(r.text);break;case\"link\":o+=t.link(r.href,r.title,this.parseInline(r.tokens,t));break;case\"image\":o+=t.image(r.href,r.title,r.text);break;case\"strong\":o+=t.strong(this.parseInline(r.tokens,t));break;case\"em\":o+=t.em(this.parseInline(r.tokens,t));break;case\"codespan\":o+=t.codespan(r.text);break;case\"br\":o+=t.br();break;case\"del\":o+=t.del(this.parseInline(r.tokens,t));break;default:{const e='Token with \"'+r.type+'\" type was not found.';if(this.options.silent)return void console.error(e);throw new Error(e)}}return o}},Uo=ho,$o=jo,qo=Do,Go=Io,{merge:Vo,checkSanitizeDeprecation:Jo,escape:Ho}=ao,{getDefaults:Wo,changeDefaults:Zo,defaults:Yo}=Ur.exports;function Ko(e,t,n){if(null==e)throw new Error(\"marked(): input parameter is undefined or null\");if(\"string\"!=typeof e)throw new Error(\"marked(): input parameter is of type \"+Object.prototype.toString.call(e)+\", string expected\");if(\"function\"==typeof t&&(n=t,t=null),t=Vo({},Ko.defaults,t||{}),Jo(t),n){const r=t.highlight;let o;try{o=No.lex(e,t)}catch(e){return n(e)}const i=function(e){let i;if(!e)try{i=Fo.parse(o,t)}catch(t){e=t}return t.highlight=r,e?n(e):n(null,i)};if(!r||r.length<3)return i();if(delete t.highlight,!o.length)return i();let a=0;return Ko.walkTokens(o,(function(e){\"code\"===e.type&&(a++,setTimeout((()=>{r(e.text,e.lang,(function(t,n){if(t)return i(t);null!=n&&n!==e.text&&(e.text=n,e.escaped=!0),a--,0===a&&i()}))}),0))})),void(0===a&&i())}try{const n=No.lex(e,t);return t.walkTokens&&Ko.walkTokens(n,t.walkTokens),Fo.parse(n,t)}catch(e){if(e.message+=\"\\nPlease report this to https://github.com/markedjs/marked.\",t.silent)return\"<p>An error occurred:</p><pre>\"+Ho(e.message+\"\",!0)+\"</pre>\";throw e}}Ko.options=Ko.setOptions=function(e){return Vo(Ko.defaults,e),Zo(Ko.defaults),Ko},Ko.getDefaults=Wo,Ko.defaults=Yo,Ko.use=function(e){const t=Vo({},e);if(e.renderer){const n=Ko.defaults.renderer||new $o;for(const t in e.renderer){const r=n[t];n[t]=(...o)=>{let i=e.renderer[t].apply(n,o);return!1===i&&(i=r.apply(n,o)),i}}t.renderer=n}if(e.tokenizer){const n=Ko.defaults.tokenizer||new Uo;for(const t in e.tokenizer){const r=n[t];n[t]=(...o)=>{let i=e.tokenizer[t].apply(n,o);return!1===i&&(i=r.apply(n,o)),i}}t.tokenizer=n}if(e.walkTokens){const n=Ko.defaults.walkTokens;t.walkTokens=t=>{e.walkTokens(t),n&&n(t)}}Ko.setOptions(t)},Ko.walkTokens=function(e,t){for(const n of e)switch(t(n),n.type){case\"table\":for(const e of n.tokens.header)Ko.walkTokens(e,t);for(const e of n.tokens.cells)for(const n of e)Ko.walkTokens(n,t);break;case\"list\":Ko.walkTokens(n.items,t);break;default:n.tokens&&Ko.walkTokens(n.tokens,t)}},Ko.parseInline=function(e,t){if(null==e)throw new Error(\"marked.parseInline(): input parameter is undefined or null\");if(\"string\"!=typeof e)throw new Error(\"marked.parseInline(): input parameter is of type \"+Object.prototype.toString.call(e)+\", string expected\");t=Vo({},Ko.defaults,t||{}),Jo(t);try{const n=No.lexInline(e,t);return t.walkTokens&&Ko.walkTokens(n,t.walkTokens),Fo.parseInline(n,t)}catch(e){if(e.message+=\"\\nPlease report this to https://github.com/markedjs/marked.\",t.silent)return\"<p>An error occurred:</p><pre>\"+Ho(e.message+\"\",!0)+\"</pre>\";throw e}},Ko.Parser=Fo,Ko.parser=Fo.parse,Ko.Renderer=$o,Ko.TextRenderer=qo,Ko.Lexer=No,Ko.lexer=No.lex,Ko.Tokenizer=Uo,Ko.Slugger=Go,Ko.parse=Ko;var Xo=Ko,Qo=new Xo.Renderer;function ei(e,t){var n=e.substr(1,e.length-2).trim();if(/\\s/.test(n)){var r=n.match(/^[^:,]+/)[0],o=t.find((function(e){return e.match.test(r)}));if(o){var i=n.replace(r,\"\");if(\":\"===i[0]){var a=new Function('return {\"'.concat(r,'\" ').concat(i,\"}\"))(),s=a[r];return delete a[r],o.render(s,a,n)}if(\",\"===i[0]){var c=new Function(\"return {\".concat(i.substr(1),\"}\"))();return o.render(null,c,n)}if(\"\"===i)return o.render(null,{},n)}}else{var l,u=/(.+)\\[(.+)\\]$/.exec(n);if(void 0!==(l=u?nn(u[1])[u[2]]:nn(n)))return l}return e}function ti(e,t){var n=\"\",r=0,o=e.indexOf(\"{\");if(-1===o)return e;for(var i,a=!1,s=o+1;s<e.length;s++)switch(e[s]){case\"{\":o=s,a=!1;break;case'\"':case\"'\":s>0&&\"\\\\\"!==e[s-1]&&(a?a&&i===e[s]&&(a=!1):(a=!0,i=e[s]));break;case\"}\":if(!a){var c=e.substring(o,s+1),l=\"\";try{l=ei(c,t)}catch(e){console.warn('An error occurred while rendering \"'.concat(c,'\": ').concat(e.message)),l=c}void 0===l&&(l=\"\"),n+=e.substring(r,o)+l,r=s+1,-1===(o=e.indexOf(\"{\",r))&&(s=e.index)}}return n+e.substring(r)}Object.assign(Qo,{blockquote:function(e){return'<div class=\"fork\">'.concat(e,\"</div>\")},del:function(e){return'<span class=\"small-caps\">'.concat(e,\"</span>\")}});var ni=Et(\"render\").log,ri={renderer:Qo,smartypants:!0};function oi(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!e.vars)throw new Error(\"The renderer was given an object with no vars property.\");if(!e.blocks)throw new Error(\"The renderer was given an object with no blocks property.\");var o=\"\";r||(ni(\"Setting vars (\".concat(e.vars.length,\")\")),e.vars.forEach((function(e){e.condition?e.condition()?(ni('Setting var \"'.concat(name,'\" (condition is currently true)')),Qt(e.name,e.value())):ni('Not setting var \"'.concat(name,'\" (condition is currently false)')):(ni('Setting var \"'.concat(name,'\"')),Qt(e.name,e.value()))})));var i=[],a={};return e.blocks.forEach((function(e){switch(e.type){case\"text\":var r={text:e.content,startsNewParagraph:!0},s=i.filter((function(e){return!!e.mod.processRaw}));ni(\"Running \".concat(s.length,\" modifiers on raw source block\")),s.forEach((function(e){e.mod.processRaw(r,{state:a[e.mod],invocation:e.invocation})})),r.text=ti(bn(r.text),t);var c=i.filter((function(e){return!!e.mod.process}));ni(\"Running \".concat(c.length,\" modifiers on source block\")),c.forEach((function(e){return e.mod.process(r,{state:a[e.mod],invocation:e.invocation})})),ni(\"Output after modifiers: \".concat(JSON.stringify(r))),\"\"!==r.text.trim()&&(\"\"!==o&&(o+=r.startsNewParagraph?\"\\n\\n\":\" \"),o+=r.text),i=[];break;case\"modifier\":var l=n.filter((function(t){return t.match.test(e.content)}));if(1===l.length){var u=l[0];ni('Activated \"'.concat(u.name,'\" modifier matching [').concat(e.content,\"]\")),a[u]=a[u]||{},i.push({mod:u,invocation:e.content})}else 0===l.length||console.warn('More than one modifier matched \"['.concat(e.content,']\".')),o+=\"\\n\\n[\".concat(e.content,\"]\\n\\n\");break;default:throw new Error(\"Don't know how to render a block with type \\\"\".concat(e.type,'\".'))}})),o=o.replace(/^((>|-|\\*).*$)\\n+\\2/gm,\"$1\\n$2\"),Xo.setOptions(ri),ni(\"Final Markdown:\\n\".concat(o)),Xo(o)}var ii={\"config.template.inserts\":mr,\"config.template.modifiers\":Ar};function ai(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return oi(Fr(e),nn(\"config.template.inserts\")||[],nn(\"config.template.modifiers\")||[],t)}var si=Et(\"extensibility\").warn;function ci(e){return e.split(\".\").map(window.parseInt)}function li(e,t,n){var r,o=e.volume,i=t-o,a=0;return new Promise((function(t){return window.requestAnimationFrame((function(s){r=s,window.requestAnimationFrame((function s(c){a+=c-r,e.volume=function(e,t,n,r){return(e/=r/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t}(a,o,i,n),a<n?(r=c,window.requestAnimationFrame(s)):t()}))}))}))}var ui,pi=Et(\"sound\"),di=pi.log,fi=pi.warn,hi={},mi={\"sound.mute\":!1,\"sound.volume\":1,\"sound.transitionDuration\":\"1s\"};function gi(e,t,n){hi[e]?(hi[e].setAttribute(\"src\",t),n?hi[e].setAttribute(\"preload\",\"auto\"):hi[e].removeAttribute(\"preload\"),di('Updated <audio> element in sound bank for \"'.concat(e,'\" to use ').concat(t))):(hi[e]=document.createElement(\"audio\"),hi[e].setAttribute(\"src\",t),n&&hi[e].setAttribute(\"preload\",\"auto\"),ui.appendChild(hi[e]),di('Added new <audio> element to sound bank for \"'.concat(e,'\" for ').concat(t)))}function yi(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!hi[e])throw new Error(\"There is no sound loaded named \".concat(e,\".\"));return di('Playing sound \"'.concat(e,'\" (looping: ').concat(t,\")\")),n>0&&(hi[e].volume=0,li(hi[e],1,n)),t?(hi[e].loop=!0,hi[e].play()):(hi[e].loop=!1,new Promise((function(t,n){try{hi[e].addEventListener(\"ended\",(function n(){hi[e].removeEventListener(\"ended\",n),t()})),hi[e].play().catch((function(e){return n(e)}))}catch(e){n(e)}})))}function vi(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!hi[e])throw new Error(\"There is no sound loaded named \".concat(e,\".\"));if(t<=0)hi[e].pause(),hi[e].currentTime=0;else{var n=hi[e].volume;li(hi[e],0,t).then((function(){hi[e].pause(),hi[e].volume=n,hi[e].currentTime=0}))}}function bi(e,t){if(!hi[e])throw new Error(\"There is no sound loaded named \".concat(e,\".\"));if(t<0||t>1)throw new Error(\"A sound volume must be between 0 and 1.\");hi[e].volume=t}function wi(e,t){if(!hi[e])throw new Error(\"There is no sound loaded named \".concat(e,\".\"));hi[e].muted=t}var ki=\"1.2.2\";var _i={exports:{}};(function(e,t,n){function r(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(\" \"),n.s1=r(\" \"),n.s2=r(\" \"),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function o(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function i(e,t){var n=new r(e),i=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,i&&(\"object\"==typeof i&&o(i,n),a.state=function(){return o(n,{})}),a}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.alea=i})(0,_i,!1);var Si={exports:{}};!function(e){!function(e,t,n){function r(e){var t=this,n=\"\";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function o(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function i(e,t){var n=new r(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&(\"object\"==typeof i&&o(i,n),a.state=function(){return o(n,{})}),a}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.xor128=i}(0,e,!1)}(Si);var Ci={exports:{}};!function(e){!function(e,t,n){function r(e){var t=this,n=\"\";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function o(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function i(e,t){var n=new r(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&(\"object\"==typeof i&&o(i,n),a.state=function(){return o(n,{})}),a}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.xorwow=i}(0,e,!1)}(Ci);var xi={exports:{}};!function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.x,o=t.i;return e=r[o],n=(e^=e>>>7)^e<<24,n^=(e=r[o+1&7])^e>>>10,n^=(e=r[o+3&7])^e>>>3,n^=(e=r[o+4&7])^e<<7,e=r[o+7&7],n^=(e^=e<<13)^e<<9,r[o]=n,t.i=o+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=\"\"+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n&&(r[7]=-1),e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function o(e,t){return t.x=e.x.slice(),t.i=e.i,t}function i(e,t){null==e&&(e=+new Date);var n=new r(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&(i.x&&o(i,n),a.state=function(){return o(n,{})}),a}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.xorshift7=i}(0,e,!1)}(xi);var Ti={exports:{}};!function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.w,o=t.X,i=t.i;return t.w=r=r+1640531527|0,n=o[i+34&127],e=o[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=o[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,o,i,a,s=[],c=128;for(t===(0|t)?(r=t,t=null):(t+=\"\\0\",r=0,c=Math.max(c,t.length)),o=0,i=-32;i<c;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(a=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(a=a+1640531527|0,o=0==(n=s[127&i]^=r+a)?o+1:0);for(o>=128&&(s[127&(t&&t.length||0)]=-1),o=127,i=512;i>0;--i)r=s[o+34&127],n=s[o=o+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[o]=r^n;e.w=a,e.X=s,e.i=o}(t,e)}function o(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function i(e,t){null==e&&(e=+new Date);var n=new r(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&(i.X&&o(i,n),a.state=function(){return o(n,{})}),a}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.xor4096=i}(0,e,!1)}(Ti);var Ei={exports:{}};!function(e){!function(e,t,n){function r(e){var t=this,n=\"\";t.next=function(){var e=t.b,n=t.c,r=t.d,o=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^o,o=o-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^o,t.a=o-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function o(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function i(e,t){var n=new r(e),i=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,i&&(\"object\"==typeof i&&o(i,n),a.state=function(){return o(n,{})}),a}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.tychei=i}(0,e,!1)}(Ei);var Pi={exports:{}};!function(e){!function(t,n){var r,o=(0,eval)(\"this\"),i=256,a=n.pow(i,6),s=n.pow(2,52),c=2*s,l=255;function u(e,l,u){var g=[],y=h(f((l=1==l?{entropy:!0}:l||{}).entropy?[e,m(t)]:null==e?function(){try{var e;return r&&(e=r.randomBytes)?e=e(i):(e=new Uint8Array(i),(o.crypto||o.msCrypto).getRandomValues(e)),m(e)}catch(e){var n=o.navigator,a=n&&n.plugins;return[+new Date,o,a,o.screen,m(t)]}}():e,3),g),v=new p(g),b=function(){for(var e=v.g(6),t=a,n=0;e<s;)e=(e+n)*i,t*=i,n=v.g(1);for(;e>=c;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|v.g(4)},b.quick=function(){return v.g(4)/4294967296},b.double=b,h(m(v.S),t),(l.pass||u||function(e,t,r,o){return o&&(o.S&&d(o,v),e.state=function(){return d(v,{})}),r?(n.random=e,t):e})(b,y,\"global\"in l?l.global:this==n,l.state)}function p(e){var t,n=e.length,r=this,o=0,a=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);o<i;)s[o]=o++;for(o=0;o<i;o++)s[o]=s[a=l&a+e[o%n]+(t=s[o])],s[a]=t;(r.g=function(e){for(var t,n=0,o=r.i,a=r.j,s=r.S;e--;)t=s[o=l&o+1],n=n*i+s[l&(s[o]=s[a=l&a+t])+(s[a]=t)];return r.i=o,r.j=a,n})(i)}function d(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function f(e,t){var n,r=[],o=typeof e;if(t&&\"object\"==o)for(n in e)try{r.push(f(e[n],t-1))}catch(e){}return r.length?r:\"string\"==o?e:e+\"\\0\"}function h(e,t){for(var n,r=e+\"\",o=0;o<r.length;)t[l&o]=l&(n^=19*t[l&o])+r.charCodeAt(o++);return m(t)}function m(e){return String.fromCharCode.apply(0,e)}if(n.seedrandom=u,h(n.random(),t),e.exports){e.exports=u;try{r=require(\"crypto\")}catch(e){}}}([],Math)}(Pi);var Ri=_i.exports,Oi=Si.exports,ji=Ci.exports,Di=xi.exports,Ii=Ti.exports,Ai=Ei.exports,Mi=Pi.exports;Mi.alea=Ri,Mi.xor128=Oi,Mi.xorwow=ji,Mi.xorshift7=Di,Mi.xor4096=Ii,Mi.tychei=Ai;var Li=Mi,zi={\"config.random.seed\":function(){return new Date},\"config.random.privateState\":null},Bi=Li(new Date,{state:!0});Ze.on(\"state-change\",(function(e){var t=e.name,n=e.value;\"config.random.seed\"===t&&(Bi=Li(n,{state:!0}))}));var Ni=Et(\"style\").log,Fi=document.createElement(\"div\"),Ui=document.createElement(\"div\"),$i=document.createElement(\"div\"),qi={};function Gi(e,t,n){var r=t.match(/\\.(.+)$/);if(r&&r[1]){var o=r[1],i=qi[e]||document.createElement(\"style\");i.dataset.cbFontLoader=e,i.innerHTML='@font-face { font-family: \"'.concat(n,'\"; src: url(\"').concat(t,'\") format(\"').concat(o,'\"); }'),i.parentNode||$i.appendChild(i)}}var Vi={white:\"#ffffff\",black:\"#000000\",gray:[\"#f8f9fa\",\"#f1f3f5\",\"#e9ecef\",\"#dee2e6\",\"#ced4da\",\"#adb5bd\",\"#868e96\",\"#495057\",\"#343a40\",\"#212529\"],red:[\"#fff5f5\",\"#ffe3e3\",\"#ffc9c9\",\"#ffa8a8\",\"#ff8787\",\"#ff6b6b\",\"#fa5252\",\"#f03e3e\",\"#e03131\",\"#c92a2a\"],pink:[\"#fff0f6\",\"#ffdeeb\",\"#fcc2d7\",\"#faa2c1\",\"#f783ac\",\"#f06595\",\"#e64980\",\"#d6336c\",\"#c2255c\",\"#a61e4d\"],grape:[\"#f8f0fc\",\"#f3d9fa\",\"#eebefa\",\"#e599f7\",\"#da77f2\",\"#cc5de8\",\"#be4bdb\",\"#ae3ec9\",\"#9c36b5\",\"#862e9c\"],violet:[\"#f3f0ff\",\"#e5dbff\",\"#d0bfff\",\"#b197fc\",\"#9775fa\",\"#845ef7\",\"#7950f2\",\"#7048e8\",\"#6741d9\",\"#5f3dc4\"],indigo:[\"#edf2ff\",\"#dbe4ff\",\"#bac8ff\",\"#91a7ff\",\"#748ffc\",\"#5c7cfa\",\"#4c6ef5\",\"#4263eb\",\"#3b5bdb\",\"#364fc7\"],blue:[\"#e7f5ff\",\"#d0ebff\",\"#a5d8ff\",\"#74c0fc\",\"#4dabf7\",\"#339af0\",\"#228be6\",\"#1c7ed6\",\"#1971c2\",\"#1864ab\"],cyan:[\"#e3fafc\",\"#c5f6fa\",\"#99e9f2\",\"#66d9e8\",\"#3bc9db\",\"#22b8cf\",\"#15aabf\",\"#1098ad\",\"#0c8599\",\"#0b7285\"],teal:[\"#e6fcf5\",\"#c3fae8\",\"#96f2d7\",\"#63e6be\",\"#38d9a9\",\"#20c997\",\"#12b886\",\"#0ca678\",\"#099268\",\"#087f5b\"],green:[\"#ebfbee\",\"#d3f9d8\",\"#b2f2bb\",\"#8ce99a\",\"#69db7c\",\"#51cf66\",\"#40c057\",\"#37b24d\",\"#2f9e44\",\"#2b8a3e\"],lime:[\"#f4fce3\",\"#e9fac8\",\"#d8f5a2\",\"#c0eb75\",\"#a9e34b\",\"#94d82d\",\"#82c91e\",\"#74b816\",\"#66a80f\",\"#5c940d\"],yellow:[\"#fff9db\",\"#fff3bf\",\"#ffec99\",\"#ffe066\",\"#ffd43b\",\"#fcc419\",\"#fab005\",\"#f59f00\",\"#f08c00\",\"#e67700\"],orange:[\"#fff4e6\",\"#ffe8cc\",\"#ffd8a8\",\"#ffc078\",\"#ffa94d\",\"#ff922b\",\"#fd7e14\",\"#f76707\",\"#e8590c\",\"#d9480f\"]},Ji=/-?\\d+(\\.\\d+)?%?/g;var Hi=function(e){return e.match(Ji)};var Wi=function(e,t,n){return Math.min(Math.max(e,t),n)},Zi=Hi,Yi=Wi;function Ki(e,t){switch(e=parseFloat(e),t){case 0:return Yi(e,0,360);case 1:case 2:return Yi(e,0,100);case 3:return Yi(e,0,1)}}var Xi=function(e){4!==e.length&&5!==e.length||(e=function(e){for(var t=\"#\",n=1;n<e.length;n++){var r=e.charAt(n);t+=r+r}return t}(e));var t=[parseInt(e.substring(1,3),16),parseInt(e.substring(3,5),16),parseInt(e.substring(5,7),16)];if(9===e.length){var n=parseFloat((parseInt(e.substring(7,9),16)/255).toFixed(2));t.push(n)}return t},Qi=Hi,ea=Wi;function ta(e,t){return t<3?-1!=e.indexOf(\"%\")?Math.round(255*ea(parseInt(e,10),0,100)/100):ea(parseInt(e,10),0,255):ea(parseFloat(e),0,1)}var na=function(e){var t,n,r,o,i,a=e[0]/360,s=e[1]/100,c=e[2]/100;if(0==s)return[i=255*c,i,i];t=2*c-(n=c<.5?c*(1+s):c+s-c*s),o=[0,0,0];for(var l=0;l<3;l++)(r=a+1/3*-(l-1))<0&&r++,r>1&&r--,i=6*r<1?t+6*(n-t)*r:2*r<1?n:3*r<2?t+(n-t)*(2/3-r)*6:t,o[l]=255*i;return o},ra=function(e){return Zi(e).map(Ki)},oa=Xi,ia=function(e){return Qi(e).map(ta)},aa=na;var sa={\"#\":oa,hsl:function(e){var t=ra(e),n=aa(t);return 4===t.length&&n.push(t[3]),n},rgb:ia};function ca(e){for(var t in sa)if(0===e.indexOf(t))return sa[t](e)}ca.rgb=ia,ca.hsl=ra,ca.hex=oa;var la=ca;var ua=function(e){var t,n,r=e[0]/255,o=e[1]/255,i=e[2]/255,a=Math.min(r,o,i),s=Math.max(r,o,i),c=s-a;return s==a?t=0:r==s?t=(o-i)/c:o==s?t=2+(i-r)/c:i==s&&(t=4+(r-o)/c),(t=Math.min(60*t,360))<0&&(t+=360),n=(a+s)/2,[t,100*(s==a?0:n<=.5?c/(s+a):c/(2-s-a)),100*n]};function pa(e){if(\"string\"!=typeof e)throw new Error(\"Only strings can be parsed as color values.\");Vi[e]&&(e=Array.isArray(Vi[e])?Vi[e][Vi[e].length-1]:Vi[e]);var t=/^(\\w+)-(\\d)$/.exec(e);t&&Vi[t[1]]&&(e=Vi[t[1]][t[2]]);var n=la(e),r=ua(n);return r[3]=void 0!==n[3]?n[3]:1,\"hsla(\".concat(r[0],\", \").concat(r[1],\"%, \").concat(r[2],\"%, \").concat(r[3],\")\")}function da(e){if(void 0===e)return{\"background-color\":\"inherit\",color:\"inherit\"};if(\"string\"!=typeof e)throw new Error(\"Only strings can be parsed as colors.\");var t={color:\"inherit\",\"background-color\":\"inherit\"},n=e.split(/ on /i);return t.color=pa(n[0].trim().toLowerCase()),2===n.length&&(t[\"background-color\"]=pa(n[1].trim().toLowerCase())),t}var fa=Et(\"style\").log,ha={\"config.style.backdrop\":\"gray-0\",\"config.style.page.style\":\"shadow\",\"config.style.page.style.borderColor\":\"gray-2\",\"config.style.page.font\":\"Iowan Old Style/Constantia/Georgia/serif 18\",\"config.style.page.color\":\"gray-9 on white\",\"config.style.page.fork.divider.color\":\"gray-3\",\"config.style.page.fork.divider.style\":\"dashed\",\"config.style.page.fork.divider.size\":1,\"config.style.page.link.color\":\"gray-9\",\"config.style.page.link.lineColor\":\"red-8\",\"config.style.page.link.font\":\"underline\",\"config.style.page.link.active.color\":\"red-8 on red-0\",\"config.style.page.verticalAlign\":\"center\",\"config.style.page.header.font\":\"16\",\"config.style.page.header.link.font\":\"small caps\",\"config.style.page.footer.font\":\"16\",\"config.style.page.footer.link.font\":\"small caps\"},ma={},ga=document.createElement(\"style\");function ya(e,t){ma[e]=ma[e]||{},Object.assign(ma[e],t),function(){function e(e,t){return e+\"{\"+Object.keys(t).sort().reduce((function(e,n){return t[n]?e+n+\":\"+t[n].toString()+\";\":e}),\"\")+\"}\"}ga.innerHTML=Object.keys(ma).reduce((function(t,n){return t+e(n,ma[n])}),\"\")}()}function va(e,t){var n=\"#page\",r=e.replace(/^config\\.style\\.page\\./i,\"\").split(\".\");switch(\"header\"===r[0].toLowerCase()?(n+=\" header\",r.shift()):\"footer\"===r[0].toLowerCase()&&(n+=\" footer\",r.shift()),\"link\"===r[0].toLowerCase()&&(n+=\" a\",r.shift()),\"active\"===r[0].toLowerCase()&&(n=\"\".concat(n,\":hover, \").concat(n,\":active\"),r.shift()),r[0].toLowerCase()){case\"color\":fa(\"Setting color for \".concat(n)),ya(n,da(t));break;case\"linecolor\":fa(\"Setting line color for \".concat(n));var o=da(t).color;ya(n,{\"text-decoration-color\":o,\"-webkit-text-decoration-color\":o});break;case\"font\":fa(\"Setting font for \".concat(n)),ya(n,function(e){var t={\"font-family\":\"inherit\",\"font-size\":\"inherit\",\"font-style\":\"inherit\",\"font-weight\":\"inherit\",\"letter-spacing\":\"inherit\",\"text-decoration\":\"inherit\",\"text-transform\":\"inherit\"};if(void 0===e)return t;if(\"string\"!=typeof e)throw new Error(\"Only strings can be parsed as fonts.\");function n(e,t){e[\"font-family\"]=t.split(\"/\").map((function(e){var t=e;return'\"'!==t[0]&&(t='\"'+t),'\"'!==t[t.length-1]&&(t+='\"'),t})).join(\",\")}function r(e){e[\"font-weight\"]=\"bold\"}function o(e){e[\"font-style\"]=\"italic\"}function i(e){e[\"font-style\"]=\"none\",e[\"font-weight\"]=\"normal\",e[\"letter-spacing\"]=\"normal\",e[\"text-decoration\"]=\"none\",e[\"text-transform\"]=\"none\"}function a(e){e[\"letter-spacing\"]=\"0.075em\",e[\"text-transform\"]=\"uppercase\",e[\"font-size\"]&&\"inherit\"!==e[\"font-size\"]?e[\"font-size\"]=\"calc(0.7 * \".concat(e[\"font-size\"],\")\"):e[\"font-size\"]=\"70%\"}function s(e){e[\"text-decoration\"]=\"underline\"}var c=/\\b\\d+(?:\\.\\d+)?(ch|cm|ex|in|mm|pc|pt|px|r?em|vh|vmax|vmin|vw|%)?/i.exec(e);if(c){/^\\d+$/.test(c[0])?t[\"font-size\"]=c[0]+\"px\":t[\"font-size\"]=c[0],0!==c.index&&n(t,e.substr(0,c.index).trim());var l=e.substr(c.index);/\\bregular\\b/i.test(l)?(t[\"font-style\"]=\"none\",t[\"font-weight\"]=\"normal\",t[\"letter-spacing\"]=\"normal\",t[\"text-decoration\"]=\"none\",t[\"text-transform\"]=\"none\"):(/\\bbold\\b/.test(l)&&r(t),/\\bitalics?\\b/.test(l)&&o(t),/\\bunderlined?/.test(l)&&s(t),/\\bsmall caps?\\b/.test(l)&&a(t))}else{for(var u,p=e;u=/(bold|italics?|regular|small caps|underlined?)$/.exec(p);){switch(u[0]){case\"bold\":r(t);break;case\"italic\":case\"italics\":o(t);break;case\"regular\":i(t);break;case\"small caps\":a(t);break;case\"underline\":case\"underlined\":s(t)}p=p.substr(0,u.index).trim()}\"\"!==p.trim()&&n(t,p)}return t}(t))}}var ba={exports:{}};!function(e){var t={};t.useBlobBuilder=function(){try{return new Blob([]),!1}catch(e){return!0}}(),t.useArrayBufferView=!t.useBlobBuilder&&function(){try{return 0===new Blob([new Uint8Array([])]).size}catch(e){return!0}}(),e.exports.binaryFeatures=t;var n=e.exports.BlobBuilder;function r(){this._pieces=[],this._parts=[]}\"undefined\"!=typeof window&&(n=e.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder),r.prototype.append=function(e){\"number\"==typeof e?this._pieces.push(e):(this.flush(),this._parts.push(e))},r.prototype.flush=function(){if(this._pieces.length>0){var e=new Uint8Array(this._pieces);t.useArrayBufferView||(e=e.buffer),this._parts.push(e),this._pieces=[]}},r.prototype.getBuffer=function(){if(this.flush(),t.useBlobBuilder){for(var e=new n,r=0,o=this._parts.length;r<o;r++)e.append(this._parts[r]);return e.getBlob()}return new Blob(this._parts)},e.exports.BufferBuilder=r}(ba);var wa=ba.exports.BufferBuilder,ka=ba.exports.binaryFeatures,_a={unpack:function(e){return new Sa(e).unpack()},pack:function(e){var t=new Ca;return t.pack(e),t.getBuffer()}};function Sa(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function Ca(){this.bufferBuilder=new wa}function xa(e){var t=e.charCodeAt(0);return t<=2047?\"00\":t<=65535?\"000\":t<=2097151?\"0000\":t<=67108863?\"00000\":\"000000\"}Sa.prototype.unpack=function(){var e,t=this.unpack_uint8();if(t<128)return t;if((224^t)<32)return(224^t)-32;if((e=160^t)<=15)return this.unpack_raw(e);if((e=176^t)<=15)return this.unpack_string(e);if((e=144^t)<=15)return this.unpack_array(e);if((e=128^t)<=15)return this.unpack_map(e);switch(t){case 192:return null;case 193:case 212:case 213:case 214:case 215:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 216:return e=this.unpack_uint16(),this.unpack_string(e);case 217:return e=this.unpack_uint32(),this.unpack_string(e);case 218:return e=this.unpack_uint16(),this.unpack_raw(e);case 219:return e=this.unpack_uint32(),this.unpack_raw(e);case 220:return e=this.unpack_uint16(),this.unpack_array(e);case 221:return e=this.unpack_uint32(),this.unpack_array(e);case 222:return e=this.unpack_uint16(),this.unpack_map(e);case 223:return e=this.unpack_uint32(),this.unpack_map(e)}},Sa.prototype.unpack_uint8=function(){var e=255&this.dataView[this.index];return this.index++,e},Sa.prototype.unpack_uint16=function(){var e=this.read(2),t=256*(255&e[0])+(255&e[1]);return this.index+=2,t},Sa.prototype.unpack_uint32=function(){var e=this.read(4),t=256*(256*(256*e[0]+e[1])+e[2])+e[3];return this.index+=4,t},Sa.prototype.unpack_uint64=function(){var e=this.read(8),t=256*(256*(256*(256*(256*(256*(256*e[0]+e[1])+e[2])+e[3])+e[4])+e[5])+e[6])+e[7];return this.index+=8,t},Sa.prototype.unpack_int8=function(){var e=this.unpack_uint8();return e<128?e:e-256},Sa.prototype.unpack_int16=function(){var e=this.unpack_uint16();return e<32768?e:e-65536},Sa.prototype.unpack_int32=function(){var e=this.unpack_uint32();return e<Math.pow(2,31)?e:e-Math.pow(2,32)},Sa.prototype.unpack_int64=function(){var e=this.unpack_uint64();return e<Math.pow(2,63)?e:e-Math.pow(2,64)},Sa.prototype.unpack_raw=function(e){if(this.length<this.index+e)throw new Error(\"BinaryPackFailure: index is out of range \"+this.index+\" \"+e+\" \"+this.length);var t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t},Sa.prototype.unpack_string=function(e){for(var t,n,r=this.read(e),o=0,i=\"\";o<e;)(t=r[o])<128?(i+=String.fromCharCode(t),o++):(192^t)<32?(n=(192^t)<<6|63&r[o+1],i+=String.fromCharCode(n),o+=2):(n=(15&t)<<12|(63&r[o+1])<<6|63&r[o+2],i+=String.fromCharCode(n),o+=3);return this.index+=e,i},Sa.prototype.unpack_array=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=this.unpack();return t},Sa.prototype.unpack_map=function(e){for(var t={},n=0;n<e;n++){var r=this.unpack(),o=this.unpack();t[r]=o}return t},Sa.prototype.unpack_float=function(){var e=this.unpack_uint32(),t=(e>>23&255)-127;return(0===e>>31?1:-1)*(8388607&e|8388608)*Math.pow(2,t-23)},Sa.prototype.unpack_double=function(){var e=this.unpack_uint32(),t=this.unpack_uint32(),n=(e>>20&2047)-1023;return(0===e>>31?1:-1)*((1048575&e|1048576)*Math.pow(2,n-20)+t*Math.pow(2,n-52))},Sa.prototype.read=function(e){var t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw new Error(\"BinaryPackFailure: read index out of range\")},Ca.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},Ca.prototype.pack=function(e){var t=typeof e;if(\"string\"===t)this.pack_string(e);else if(\"number\"===t)Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(\"boolean\"===t)!0===e?this.bufferBuilder.append(195):!1===e&&this.bufferBuilder.append(194);else if(\"undefined\"===t)this.bufferBuilder.append(192);else{if(\"object\"!==t)throw new Error('Type \"'+t+'\" not yet supported');if(null===e)this.bufferBuilder.append(192);else{var n=e.constructor;if(n==Array)this.pack_array(e);else if(n==Blob||n==File||e instanceof Blob||e instanceof File)this.pack_bin(e);else if(n==ArrayBuffer)ka.useArrayBufferView?this.pack_bin(new Uint8Array(e)):this.pack_bin(e);else if(\"BYTES_PER_ELEMENT\"in e)ka.useArrayBufferView?this.pack_bin(new Uint8Array(e.buffer)):this.pack_bin(e.buffer);else if(n==Object||n.toString().startsWith(\"class\"))this.pack_object(e);else if(n==Date)this.pack_string(e.toString());else{if(\"function\"!=typeof e.toBinaryPack)throw new Error('Type \"'+n.toString()+'\" not yet supported');this.bufferBuilder.append(e.toBinaryPack())}}}this.bufferBuilder.flush()},Ca.prototype.pack_bin=function(e){var t=e.length||e.byteLength||e.size;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this.bufferBuilder.append(218),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error(\"Invalid length\");this.bufferBuilder.append(219),this.pack_uint32(t)}this.bufferBuilder.append(e)},Ca.prototype.pack_string=function(e){var t=function(e){return e.length>600?new Blob([e]).size:e.replace(/[^\\u0000-\\u007F]/g,xa).length}(e);if(t<=15)this.pack_uint8(176+t);else if(t<=65535)this.bufferBuilder.append(216),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error(\"Invalid length\");this.bufferBuilder.append(217),this.pack_uint32(t)}this.bufferBuilder.append(e)},Ca.prototype.pack_array=function(e){var t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this.bufferBuilder.append(220),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error(\"Invalid length\");this.bufferBuilder.append(221),this.pack_uint32(t)}for(var n=0;n<t;n++)this.pack(e[n])},Ca.prototype.pack_integer=function(e){if(e>=-32&&e<=127)this.bufferBuilder.append(255&e);else if(e>=0&&e<=255)this.bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this.bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this.bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this.bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this.bufferBuilder.append(210),this.pack_int32(e);else if(e>=-0x8000000000000000&&e<=0x8000000000000000)this.bufferBuilder.append(211),this.pack_int64(e);else{if(!(e>=0&&e<=0x10000000000000000))throw new Error(\"Invalid integer\");this.bufferBuilder.append(207),this.pack_uint64(e)}},Ca.prototype.pack_double=function(e){var t=0;e<0&&(t=1,e=-e);var n=Math.floor(Math.log(e)/Math.LN2),r=e/Math.pow(2,n)-1,o=Math.floor(r*Math.pow(2,52)),i=Math.pow(2,32),a=t<<31|n+1023<<20|o/i&1048575,s=o%i;this.bufferBuilder.append(203),this.pack_int32(a),this.pack_int32(s)},Ca.prototype.pack_object=function(e){var t=Object.keys(e).length;if(t<=15)this.pack_uint8(128+t);else if(t<=65535)this.bufferBuilder.append(222),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error(\"Invalid length\");this.bufferBuilder.append(223),this.pack_uint32(t)}for(var n in e)e.hasOwnProperty(n)&&(this.pack(n),this.pack(e[n]))},Ca.prototype.pack_uint8=function(e){this.bufferBuilder.append(e)},Ca.prototype.pack_uint16=function(e){this.bufferBuilder.append(e>>8),this.bufferBuilder.append(255&e)},Ca.prototype.pack_uint32=function(e){var t=4294967295&e;this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t)},Ca.prototype.pack_uint64=function(e){var t=e/Math.pow(2,32),n=e%Math.pow(2,32);this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t),this.bufferBuilder.append((4278190080&n)>>>24),this.bufferBuilder.append((16711680&n)>>>16),this.bufferBuilder.append((65280&n)>>>8),this.bufferBuilder.append(255&n)},Ca.prototype.pack_int8=function(e){this.bufferBuilder.append(255&e)},Ca.prototype.pack_int16=function(e){this.bufferBuilder.append((65280&e)>>8),this.bufferBuilder.append(255&e)},Ca.prototype.pack_int32=function(e){this.bufferBuilder.append(e>>>24&255),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e)},Ca.prototype.pack_int64=function(e){var t=Math.floor(e/Math.pow(2,32)),n=e%Math.pow(2,32);this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t),this.bufferBuilder.append((4278190080&n)>>>24),this.bufferBuilder.append((16711680&n)>>>16),this.bufferBuilder.append((65280&n)>>>8),this.bufferBuilder.append(255&n)};let Ta=!0,Ea=!0;function Pa(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function Ra(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,o=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return o.apply(this,arguments);const i=e=>{const t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,i),o.apply(this,[e,i])};const i=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return i.apply(this,arguments);if(!this._eventMap[t].has(n))return i.apply(this,arguments);const r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,i.apply(this,[e,r])},Object.defineProperty(r,\"on\"+t,{get(){return this[\"_on\"+t]},set(e){this[\"_on\"+t]&&(this.removeEventListener(t,this[\"_on\"+t]),delete this[\"_on\"+t]),e&&this.addEventListener(t,this[\"_on\"+t]=e)},enumerable:!0,configurable:!0})}function Oa(e){return\"boolean\"!=typeof e?new Error(\"Argument type: \"+typeof e+\". Please use a boolean.\"):(Ta=e,e?\"adapter.js logging disabled\":\"adapter.js logging enabled\")}function ja(e){return\"boolean\"!=typeof e?new Error(\"Argument type: \"+typeof e+\". Please use a boolean.\"):(Ea=!e,\"adapter.js deprecation warnings \"+(e?\"disabled\":\"enabled\"))}function Da(){if(\"object\"==typeof window){if(Ta)return;\"undefined\"!=typeof console&&\"function\"==typeof console.log&&console.log.apply(console,arguments)}}function Ia(e,t){Ea&&console.warn(e+\" is deprecated, please use \"+t+\" instead.\")}function Aa(e){return\"[object Object]\"===Object.prototype.toString.call(e)}function Ma(e){return Aa(e)?Object.keys(e).reduce((function(t,n){const r=Aa(e[n]),o=r?Ma(e[n]):e[n],i=r&&!Object.keys(o).length;return void 0===o||i?t:Object.assign(t,{[n]:o})}),{}):e}function La(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((r=>{r.endsWith(\"Id\")?La(e,e.get(t[r]),n):r.endsWith(\"Ids\")&&t[r].forEach((t=>{La(e,e.get(t),n)}))})))}function za(e,t,n){const r=n?\"outbound-rtp\":\"inbound-rtp\",o=new Map;if(null===t)return o;const i=[];return e.forEach((e=>{\"track\"===e.type&&e.trackIdentifier===t.id&&i.push(e)})),i.forEach((t=>{e.forEach((n=>{n.type===r&&n.trackId===t.id&&La(e,n,o)}))})),o}const Ba=Da;function Na(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(e){if(\"object\"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((n=>{if(\"require\"===n||\"advanced\"===n||\"mediaSource\"===n)return;const r=\"object\"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&\"number\"==typeof r.exact&&(r.min=r.max=r.exact);const o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):\"deviceId\"===t?\"sourceId\":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};\"number\"==typeof r.ideal?(e[o(\"min\",n)]=r.ideal,t.optional.push(e),e={},e[o(\"max\",n)]=r.ideal,t.optional.push(e)):(e[o(\"\",n)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&\"number\"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[o(\"\",n)]=r.exact):[\"min\",\"max\"].forEach((e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[o(e,n)]=r[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},o=function(e,o){if(t.version>=61)return o(e);if((e=JSON.parse(JSON.stringify(e)))&&\"object\"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,\"autoGainControl\",\"googAutoGainControl\"),t(e.audio,\"noiseSuppression\",\"googNoiseSuppression\"),e.audio=r(e.audio)}if(e&&\"object\"==typeof e.video){let i=e.video.facingMode;i=i&&(\"object\"==typeof i?i:{ideal:i});const a=t.version<66;if(i&&(\"user\"===i.exact||\"environment\"===i.exact||\"user\"===i.ideal||\"environment\"===i.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,\"environment\"===i.exact||\"environment\"===i.ideal?t=[\"back\",\"rear\"]:\"user\"!==i.exact&&\"user\"!==i.ideal||(t=[\"front\"]),t)return n.mediaDevices.enumerateDevices().then((n=>{let a=(n=n.filter((e=>\"videoinput\"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!a&&n.length&&t.includes(\"back\")&&(a=n[n.length-1]),a&&(e.video.deviceId=i.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=r(e.video),Ba(\"chrome: \"+JSON.stringify(e)),o(e)}))}e.video=r(e.video)}return Ba(\"chrome: \"+JSON.stringify(e)),o(e)},i=function(e){return t.version>=64?e:{name:{PermissionDeniedError:\"NotAllowedError\",PermissionDismissedError:\"NotAllowedError\",InvalidStateError:\"NotAllowedError\",DevicesNotFoundError:\"NotFoundError\",ConstraintNotSatisfiedError:\"OverconstrainedError\",TrackStartError:\"NotReadableError\",MediaDeviceFailedDueToShutdown:\"NotAllowedError\",MediaDeviceKillSwitchOn:\"NotAllowedError\",TabCaptureError:\"AbortError\",ScreenCaptureError:\"AbortError\",DeviceCaptureError:\"AbortError\"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&\": \")+this.message}}};if(n.getUserMedia=function(e,t,r){o(e,(e=>{n.webkitGetUserMedia(e,t,(e=>{r&&r(i(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return o(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException(\"\",\"NotFoundError\");return e}),(e=>Promise.reject(i(e))))))}}}function Fa(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Ua(e){if(\"object\"==typeof e&&e.RTCPeerConnection&&!(\"ontrack\"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,\"ontrack\",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener(\"track\",this._ontrack),this.addEventListener(\"track\",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener(\"addtrack\",(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};const o=new Event(\"track\");o.track=n.track,o.receiver=r,o.transceiver={receiver:r},o.streams=[t.stream],this.dispatchEvent(o)})),t.stream.getTracks().forEach((n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};const o=new Event(\"track\");o.track=n,o.receiver=r,o.transceiver={receiver:r},o.streams=[t.stream],this.dispatchEvent(o)}))},this.addEventListener(\"addstream\",this._ontrackpoly)),t.apply(this,arguments)}}else Ra(e,\"track\",(e=>(e.transceiver||Object.defineProperty(e,\"transceiver\",{value:{receiver:e.receiver}}),e)))}function $a(e){if(\"object\"==typeof e&&e.RTCPeerConnection&&!(\"getSenders\"in e.RTCPeerConnection.prototype)&&\"createDTMFSender\"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&(\"audio\"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let o=n.apply(this,arguments);return o||(o=t(this,e),this._senders.push(o)),o};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if(\"object\"==typeof e&&e.RTCPeerConnection&&\"getSenders\"in e.RTCPeerConnection.prototype&&\"createDTMFSender\"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!(\"dtmf\"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,\"dtmf\",{get(){return void 0===this._dtmf&&(\"audio\"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function qa(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,r]=arguments;if(arguments.length>0&&\"function\"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||\"function\"!=typeof e))return t.apply(this,[]);const o=function(e){const t={};return e.result().forEach((e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:\"local-candidate\",remotecandidate:\"remote-candidate\"}[e.type]||e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t[n.id]=n})),t},i=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const r=function(e){n(i(o(e)))};return t.apply(this,[r,e])}return new Promise(((e,n)=>{t.apply(this,[function(t){e(i(o(t)))},n])})).then(n,r)}}function Ga(e){if(!(\"object\"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!(\"getStats\"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>za(t,e.track,!0)))}}if(!(\"getStats\"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),Ra(e,\"track\",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>za(t,e.track,!1)))}}if(!(\"getStats\"in e.RTCRtpSender.prototype)||!(\"getStats\"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,r;return this.getSenders().forEach((n=>{n.track===e&&(t?r=!0:t=n)})),this.getReceivers().forEach((t=>(t.track===e&&(n?r=!0:n=t),t.track===e))),r||t&&n?Promise.reject(new DOMException(\"There are more than one sender or receiver for the track.\",\"InvalidAccessError\")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException(\"There is no sender or receiver for the track.\",\"InvalidAccessError\"))}return t.apply(this,arguments)}}function Va(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException(\"Track already exists.\",\"InvalidAccessError\")}));const t=this.getSenders();n.apply(this,arguments);const r=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(r)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};const o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),o.apply(this,arguments)}}function Ja(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Va(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException(\"Track already exists.\",\"InvalidAccessError\")})),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}r.apply(this,[t])};const o=e.RTCPeerConnection.prototype.removeStream;function i(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],o=e._streams[r.id];n=n.replace(new RegExp(o.id,\"g\"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}function a(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],o=e._streams[r.id];n=n.replace(new RegExp(r.id,\"g\"),o.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if(\"closed\"===this.signalingState)throw new DOMException(\"The RTCPeerConnection's signalingState is 'closed'.\",\"InvalidStateError\");const r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find((e=>e===t)))throw new DOMException(\"The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.\",\"NotSupportedError\");const o=this.getSenders().find((e=>e.track===t));if(o)throw new DOMException(\"Track already exists.\",\"InvalidAccessError\");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const i=this._streams[n.id];if(i)i.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event(\"negotiationneeded\"))}));else{const r=new e.MediaStream([t]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find((e=>e.track===t))},[\"createOffer\",\"createAnswer\"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){const e=arguments;return arguments.length&&\"function\"==typeof arguments[0]?n.apply(this,[t=>{const n=i(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>i(this,e)))}};e.RTCPeerConnection.prototype[t]=r[t]}));const s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=a(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,\"localDescription\");Object.defineProperty(e.RTCPeerConnection.prototype,\"localDescription\",{get(){const e=c.get.apply(this);return\"\"===e.type?e:i(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if(\"closed\"===this.signalingState)throw new DOMException(\"The RTCPeerConnection's signalingState is 'closed'.\",\"InvalidStateError\");if(!e._pc)throw new DOMException(\"Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.\",\"TypeError\");if(!(e._pc===this))throw new DOMException(\"Sender was not created by this connection.\",\"InvalidAccessError\");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event(\"negotiationneeded\")))}}function Ha(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&[\"setLocalDescription\",\"setRemoteDescription\",\"addIceCandidate\"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new(\"addIceCandidate\"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}))}function Wa(e,t){Ra(e,\"negotiationneeded\",(e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&\"plan-b\"===n.getConfiguration().sdpSemantics)||\"stable\"===n.signalingState)return e}))}var Za=Object.freeze({__proto__:null,shimMediaStream:Fa,shimOnTrack:Ua,shimGetSendersWithDtmf:$a,shimGetStats:qa,shimSenderReceiverGetStats:Ga,shimAddTrackRemoveTrackWithNative:Va,shimAddTrackRemoveTrack:Ja,shimPeerConnection:Ha,fixNegotiationNeeded:Wa,shimGetUserMedia:Na,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&\"getDisplayMedia\"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(\"function\"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((t=>{const r=n.video&&n.video.width,o=n.video&&n.video.height,i=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:\"desktop\",chromeMediaSourceId:t,maxFrameRate:i||3}},r&&(n.video.mandatory.maxWidth=r),o&&(n.video.mandatory.maxHeight=o),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error(\"shimGetDisplayMedia: getSourceId argument is not a function\"))}});var Ya={exports:{}};!function(e){var t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split(\"\\n\").map((function(e){return e.trim()}))},t.splitSections=function(e){return e.split(\"\\nm=\").map((function(e,t){return(t>0?\"m=\"+e:e).trim()+\"\\r\\n\"}))},t.getDescription=function(e){var n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){var n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((function(e){return 0===e.indexOf(n)}))},t.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf(\"a=candidate:\")?e.substring(12).split(\" \"):e.substring(10).split(\" \"))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case\"raddr\":n.relatedAddress=t[r+1];break;case\"rport\":n.relatedPort=parseInt(t[r+1],10);break;case\"tcptype\":n.tcpType=t[r+1];break;case\"ufrag\":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},t.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push(\"typ\"),t.push(n),\"host\"!==n&&e.relatedAddress&&e.relatedPort&&(t.push(\"raddr\"),t.push(e.relatedAddress),t.push(\"rport\"),t.push(e.relatedPort)),e.tcpType&&\"tcp\"===e.protocol.toLowerCase()&&(t.push(\"tcptype\"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push(\"ufrag\"),t.push(e.usernameFragment||e.ufrag)),\"candidate:\"+t.join(\" \")},t.parseIceOptions=function(e){return e.substr(14).split(\" \")},t.parseRtpMap=function(e){var t=e.substr(9).split(\" \"),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split(\"/\"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return\"a=rtpmap:\"+t+\" \"+e.name+\"/\"+e.clockRate+(1!==n?\"/\"+n:\"\")+\"\\r\\n\"},t.parseExtmap=function(e){var t=e.substr(9).split(\" \");return{id:parseInt(t[0],10),direction:t[0].indexOf(\"/\")>0?t[0].split(\"/\")[1]:\"sendrecv\",uri:t[1]}},t.writeExtmap=function(e){return\"a=extmap:\"+(e.id||e.preferredId)+(e.direction&&\"sendrecv\"!==e.direction?\"/\"+e.direction:\"\")+\" \"+e.uri+\"\\r\\n\"},t.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(\" \")+1).split(\";\"),o=0;o<r.length;o++)n[(t=r[o].trim().split(\"=\"))[0].trim()]=t[1];return n},t.writeFmtp=function(e){var t=\"\",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?r.push(t+\"=\"+e.parameters[t]):r.push(t)})),t+=\"a=fmtp:\"+n+\" \"+r.join(\";\")+\"\\r\\n\"}return t},t.parseRtcpFb=function(e){var t=e.substr(e.indexOf(\" \")+1).split(\" \");return{type:t.shift(),parameter:t.join(\" \")}},t.writeRtcpFb=function(e){var t=\"\",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+=\"a=rtcp-fb:\"+n+\" \"+e.type+(e.parameter&&e.parameter.length?\" \"+e.parameter:\"\")+\"\\r\\n\"})),t},t.parseSsrcMedia=function(e){var t=e.indexOf(\" \"),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(\":\",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},t.parseSsrcGroup=function(e){var t=e.substr(13).split(\" \");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},t.getMid=function(e){var n=t.matchPrefix(e,\"a=mid:\")[0];if(n)return n.substr(6)},t.parseFingerprint=function(e){var t=e.substr(14).split(\" \");return{algorithm:t[0].toLowerCase(),value:t[1]}},t.getDtlsParameters=function(e,n){return{role:\"auto\",fingerprints:t.matchPrefix(e+n,\"a=fingerprint:\").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){var n=\"a=setup:\"+t+\"\\r\\n\";return e.fingerprints.forEach((function(e){n+=\"a=fingerprint:\"+e.algorithm+\" \"+e.value+\"\\r\\n\"})),n},t.parseCryptoLine=function(e){var t=e.substr(9).split(\" \");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return\"a=crypto:\"+e.tag+\" \"+e.cryptoSuite+\" \"+(\"object\"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?\" \"+e.sessionParams.join(\" \"):\"\")+\"\\r\\n\"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf(\"inline:\"))return null;var t=e.substr(7).split(\"|\");return{keyMethod:\"inline\",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(\":\")[0]:void 0,mkiLength:t[2]?t[2].split(\":\")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+\":\"+e.keySalt+(e.lifeTime?\"|\"+e.lifeTime:\"\")+(e.mkiValue&&e.mkiLength?\"|\"+e.mkiValue+\":\"+e.mkiLength:\"\")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,\"a=crypto:\").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){var r=t.matchPrefix(e+n,\"a=ice-ufrag:\")[0],o=t.matchPrefix(e+n,\"a=ice-pwd:\")[0];return r&&o?{usernameFragment:r.substr(12),password:o.substr(10)}:null},t.writeIceParameters=function(e){return\"a=ice-ufrag:\"+e.usernameFragment+\"\\r\\na=ice-pwd:\"+e.password+\"\\r\\n\"},t.parseRtpParameters=function(e){for(var n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(\" \"),o=3;o<r.length;o++){var i=r[o],a=t.matchPrefix(e,\"a=rtpmap:\"+i+\" \")[0];if(a){var s=t.parseRtpMap(a),c=t.matchPrefix(e,\"a=fmtp:\"+i+\" \");switch(s.parameters=c.length?t.parseFmtp(c[0]):{},s.rtcpFeedback=t.matchPrefix(e,\"a=rtcp-fb:\"+i+\" \").map(t.parseRtcpFb),n.codecs.push(s),s.name.toUpperCase()){case\"RED\":case\"ULPFEC\":n.fecMechanisms.push(s.name.toUpperCase())}}}return t.matchPrefix(e,\"a=extmap:\").forEach((function(e){n.headerExtensions.push(t.parseExtmap(e))})),n},t.writeRtpDescription=function(e,n){var r=\"\";r+=\"m=\"+e+\" \",r+=n.codecs.length>0?\"9\":\"0\",r+=\" UDP/TLS/RTP/SAVPF \",r+=n.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(\" \")+\"\\r\\n\",r+=\"c=IN IP4 0.0.0.0\\r\\n\",r+=\"a=rtcp:9 IN IP4 0.0.0.0\\r\\n\",n.codecs.forEach((function(e){r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)}));var o=0;return n.codecs.forEach((function(e){e.maxptime>o&&(o=e.maxptime)})),o>0&&(r+=\"a=maxptime:\"+o+\"\\r\\n\"),r+=\"a=rtcp-mux\\r\\n\",n.headerExtensions&&n.headerExtensions.forEach((function(e){r+=t.writeExtmap(e)})),r},t.parseRtpEncodingParameters=function(e){var n,r=[],o=t.parseRtpParameters(e),i=-1!==o.fecMechanisms.indexOf(\"RED\"),a=-1!==o.fecMechanisms.indexOf(\"ULPFEC\"),s=t.matchPrefix(e,\"a=ssrc:\").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return\"cname\"===e.attribute})),c=s.length>0&&s[0].ssrc,l=t.matchPrefix(e,\"a=ssrc-group:FID\").map((function(e){return e.substr(17).split(\" \").map((function(e){return parseInt(e,10)}))}));l.length>0&&l[0].length>1&&l[0][0]===c&&(n=l[0][1]),o.codecs.forEach((function(e){if(\"RTX\"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&n&&(t.rtx={ssrc:n}),r.push(t),i&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:c,mechanism:a?\"red+ulpfec\":\"red\"},r.push(t))}})),0===r.length&&c&&r.push({ssrc:c});var u=t.matchPrefix(e,\"b=\");return u.length&&(u=0===u[0].indexOf(\"b=TIAS:\")?parseInt(u[0].substr(7),10):0===u[0].indexOf(\"b=AS:\")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,r.forEach((function(e){e.maxBitrate=u}))),r},t.parseRtcpParameters=function(e){var n={},r=t.matchPrefix(e,\"a=ssrc:\").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return\"cname\"===e.attribute}))[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);var o=t.matchPrefix(e,\"a=rtcp-rsize\");n.reducedSize=o.length>0,n.compound=0===o.length;var i=t.matchPrefix(e,\"a=rtcp-mux\");return n.mux=i.length>0,n},t.parseMsid=function(e){var n,r=t.matchPrefix(e,\"a=msid:\");if(1===r.length)return{stream:(n=r[0].substr(7).split(\" \"))[0],track:n[1]};var o=t.matchPrefix(e,\"a=ssrc:\").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return\"msid\"===e.attribute}));return o.length>0?{stream:(n=o[0].value.split(\" \"))[0],track:n[1]}:void 0},t.parseSctpDescription=function(e){var n,r=t.parseMLine(e),o=t.matchPrefix(e,\"a=max-message-size:\");o.length>0&&(n=parseInt(o[0].substr(19),10)),isNaN(n)&&(n=65536);var i=t.matchPrefix(e,\"a=sctp-port:\");if(i.length>0)return{port:parseInt(i[0].substr(12),10),protocol:r.fmt,maxMessageSize:n};if(t.matchPrefix(e,\"a=sctpmap:\").length>0){var a=t.matchPrefix(e,\"a=sctpmap:\")[0].substr(10).split(\" \");return{port:parseInt(a[0],10),protocol:a[1],maxMessageSize:n}}},t.writeSctpDescription=function(e,t){var n=[];return n=\"DTLS/SCTP\"!==e.protocol?[\"m=\"+e.kind+\" 9 \"+e.protocol+\" \"+t.protocol+\"\\r\\n\",\"c=IN IP4 0.0.0.0\\r\\n\",\"a=sctp-port:\"+t.port+\"\\r\\n\"]:[\"m=\"+e.kind+\" 9 \"+e.protocol+\" \"+t.port+\"\\r\\n\",\"c=IN IP4 0.0.0.0\\r\\n\",\"a=sctpmap:\"+t.port+\" \"+t.protocol+\" 65535\\r\\n\"],void 0!==t.maxMessageSize&&n.push(\"a=max-message-size:\"+t.maxMessageSize+\"\\r\\n\"),n.join(\"\")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,n,r){var o=void 0!==n?n:2;return\"v=0\\r\\no=\"+(r||\"thisisadapterortc\")+\" \"+(e||t.generateSessionId())+\" \"+o+\" IN IP4 127.0.0.1\\r\\ns=-\\r\\nt=0 0\\r\\n\"},t.writeMediaSection=function(e,n,r,o){var i=t.writeRtpDescription(e.kind,n);if(i+=t.writeIceParameters(e.iceGatherer.getLocalParameters()),i+=t.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),\"offer\"===r?\"actpass\":\"active\"),i+=\"a=mid:\"+e.mid+\"\\r\\n\",e.direction?i+=\"a=\"+e.direction+\"\\r\\n\":e.rtpSender&&e.rtpReceiver?i+=\"a=sendrecv\\r\\n\":e.rtpSender?i+=\"a=sendonly\\r\\n\":e.rtpReceiver?i+=\"a=recvonly\\r\\n\":i+=\"a=inactive\\r\\n\",e.rtpSender){var a=\"msid:\"+o.id+\" \"+e.rtpSender.track.id+\"\\r\\n\";i+=\"a=\"+a,i+=\"a=ssrc:\"+e.sendEncodingParameters[0].ssrc+\" \"+a,e.sendEncodingParameters[0].rtx&&(i+=\"a=ssrc:\"+e.sendEncodingParameters[0].rtx.ssrc+\" \"+a,i+=\"a=ssrc-group:FID \"+e.sendEncodingParameters[0].ssrc+\" \"+e.sendEncodingParameters[0].rtx.ssrc+\"\\r\\n\")}return i+=\"a=ssrc:\"+e.sendEncodingParameters[0].ssrc+\" cname:\"+t.localCName+\"\\r\\n\",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(i+=\"a=ssrc:\"+e.sendEncodingParameters[0].rtx.ssrc+\" cname:\"+t.localCName+\"\\r\\n\"),i},t.getDirection=function(e,n){for(var r=t.splitLines(e),o=0;o<r.length;o++)switch(r[o]){case\"a=sendrecv\":case\"a=sendonly\":case\"a=recvonly\":case\"a=inactive\":return r[o].substr(2)}return n?t.getDirection(n):\"sendrecv\"},t.getKind=function(e){return t.splitLines(e)[0].split(\" \")[0].substr(2)},t.isRejected=function(e){return\"0\"===e.split(\" \",2)[1]},t.parseMLine=function(e){var n=t.splitLines(e)[0].substr(2).split(\" \");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(\" \")}},t.parseOLine=function(e){var n=t.matchPrefix(e,\"o=\")[0].substr(2).split(\" \");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if(\"string\"!=typeof e||0===e.length)return!1;for(var n=t.splitLines(e),r=0;r<n.length;r++)if(n[r].length<2||\"=\"!==n[r].charAt(1))return!1;return!0},e.exports=t}(Ya);var Ka=Ya.exports,Xa=Ya.exports;function Qa(e,t,n,r,o){var i=Xa.writeRtpDescription(e.kind,t);if(i+=Xa.writeIceParameters(e.iceGatherer.getLocalParameters()),i+=Xa.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),\"offer\"===n?\"actpass\":o||\"active\"),i+=\"a=mid:\"+e.mid+\"\\r\\n\",e.rtpSender&&e.rtpReceiver?i+=\"a=sendrecv\\r\\n\":e.rtpSender?i+=\"a=sendonly\\r\\n\":e.rtpReceiver?i+=\"a=recvonly\\r\\n\":i+=\"a=inactive\\r\\n\",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var s=\"msid:\"+(r?r.id:\"-\")+\" \"+a+\"\\r\\n\";i+=\"a=\"+s,i+=\"a=ssrc:\"+e.sendEncodingParameters[0].ssrc+\" \"+s,e.sendEncodingParameters[0].rtx&&(i+=\"a=ssrc:\"+e.sendEncodingParameters[0].rtx.ssrc+\" \"+s,i+=\"a=ssrc-group:FID \"+e.sendEncodingParameters[0].ssrc+\" \"+e.sendEncodingParameters[0].rtx.ssrc+\"\\r\\n\")}return i+=\"a=ssrc:\"+e.sendEncodingParameters[0].ssrc+\" cname:\"+Xa.localCName+\"\\r\\n\",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(i+=\"a=ssrc:\"+e.sendEncodingParameters[0].rtx.ssrc+\" cname:\"+Xa.localCName+\"\\r\\n\"),i}function es(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},o=function(e,t,n,o){var i=r(e.parameters.apt,n),a=r(t.parameters.apt,o);return i&&a&&i.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach((function(r){for(var i=0;i<t.codecs.length;i++){var a=t.codecs[i];if(r.name.toLowerCase()===a.name.toLowerCase()&&r.clockRate===a.clockRate){if(\"rtx\"===r.name.toLowerCase()&&r.parameters&&a.parameters.apt&&!o(r,a,e.codecs,t.codecs))continue;(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(r.numChannels,a.numChannels),n.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter((function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var r=0;r<t.headerExtensions.length;r++){var o=t.headerExtensions[r];if(e.uri===o.uri){n.headerExtensions.push(o);break}}})),n}function ts(e,t,n){return-1!=={offer:{setLocalDescription:[\"stable\",\"have-local-offer\"],setRemoteDescription:[\"stable\",\"have-remote-offer\"]},answer:{setLocalDescription:[\"have-remote-offer\",\"have-local-pranswer\"],setRemoteDescription:[\"have-local-offer\",\"have-remote-pranswer\"]}}[t][e].indexOf(n)}function ns(e,t){var n=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));return n||e.addRemoteCandidate(t),!n}function rs(e,t){var n=new Error(t);return n.name=e,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],n}var os=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent(\"addtrack\",{track:t}))}function r(t,n,r,o){var i=new Event(\"track\");i.track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=o,e.setTimeout((function(){t._dispatchEvent(\"track\",i)}))}var o=function(n){var r=this,o=document.createDocumentFragment();if([\"addEventListener\",\"removeEventListener\",\"dispatchEvent\"].forEach((function(e){r[e]=o[e].bind(o)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState=\"stable\",this.iceConnectionState=\"new\",this.connectionState=\"new\",this.iceGatheringState=\"new\",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle=\"max-bundle\"===n.bundlePolicy,\"negotiate\"===n.rtcpMuxPolicy)throw rs(\"NotSupportedError\",\"rtcpMuxPolicy 'negotiate' is not supported\");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy=\"require\"),n.iceTransportPolicy){case\"all\":case\"relay\":break;default:n.iceTransportPolicy=\"all\"}switch(n.bundlePolicy){case\"balanced\":case\"max-compat\":case\"max-bundle\":break;default:n.bundlePolicy=\"balanced\"}if(n.iceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn(\"RTCIceServer.url is deprecated! Use urls instead.\");var o=\"string\"==typeof r;return o&&(r=[r]),r=r.filter((function(e){return 0!==e.indexOf(\"turn:\")||-1===e.indexOf(\"transport=udp\")||-1!==e.indexOf(\"turn:[\")||n?0===e.indexOf(\"stun:\")&&t>=14393&&-1===e.indexOf(\"?transport=udp\"):(n=!0,!0)})),delete e.url,e.urls=o?r[0]:r,!!r.length}}))}(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var i=n.iceCandidatePoolSize;i>0;i--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=Xa.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(o.prototype,\"localDescription\",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(o.prototype,\"remoteDescription\",{configurable:!0,get:function(){return this._remoteDescription}}),o.prototype.onicecandidate=null,o.prototype.onaddstream=null,o.prototype.ontrack=null,o.prototype.onremovestream=null,o.prototype.onsignalingstatechange=null,o.prototype.oniceconnectionstatechange=null,o.prototype.onconnectionstatechange=null,o.prototype.onicegatheringstatechange=null,o.prototype.onnegotiationneeded=null,o.prototype.ondatachannel=null,o.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),\"function\"==typeof this[\"on\"+e]&&this[\"on\"+e](t))},o.prototype._emitGatheringStateChange=function(){var e=new Event(\"icegatheringstatechange\");this._dispatchEvent(\"icegatheringstatechange\",e)},o.prototype.getConfiguration=function(){return this._config},o.prototype.getLocalStreams=function(){return this.localStreams},o.prototype.getRemoteStreams=function(){return this.remoteStreams},o.prototype._createTransceiver=function(e,t){var n=this.transceivers.length>0,r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&n)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var o=this._createIceAndDtlsTransports();r.iceTransport=o.iceTransport,r.dtlsTransport=o.dtlsTransport}return t||this.transceivers.push(r),r},o.prototype.addTrack=function(t,n){if(this._isClosed)throw rs(\"InvalidStateError\",\"Attempted to call addTrack on a closed peerconnection.\");var r;if(this.transceivers.find((function(e){return e.track===t})))throw rs(\"InvalidAccessError\",\"Track already exists.\");for(var o=0;o<this.transceivers.length;o++)this.transceivers[o].track||this.transceivers[o].kind!==t.kind||(r=this.transceivers[o]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),r.track=t,r.stream=n,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},o.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach((function(t){n.addTrack(t,e)}));else{var r=e.clone();e.getTracks().forEach((function(e,t){var n=r.getTracks()[t];e.addEventListener(\"enabled\",(function(e){n.enabled=e.enabled}))})),r.getTracks().forEach((function(e){n.addTrack(e,r)}))}},o.prototype.removeTrack=function(t){if(this._isClosed)throw rs(\"InvalidStateError\",\"Attempted to call removeTrack on a closed peerconnection.\");if(!(t instanceof e.RTCRtpSender))throw new TypeError(\"Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.\");var n=this.transceivers.find((function(e){return e.rtpSender===t}));if(!n)throw rs(\"InvalidAccessError\",\"Sender was not created by this connection.\");var r=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map((function(e){return e.stream})).indexOf(r)&&this.localStreams.indexOf(r)>-1&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},o.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var n=t.getSenders().find((function(t){return t.track===e}));n&&t.removeTrack(n)}))},o.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},o.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},o.prototype._createIceGatherer=function(t,n){var r=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var o=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(o,\"state\",{value:\"new\",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;o.state=n?\"completed\":\"gathering\",null!==r.transceivers[t].bufferedCandidateEvents&&r.transceivers[t].bufferedCandidateEvents.push(e)},o.addEventListener(\"localcandidate\",this.transceivers[t].bufferCandidates),o},o.prototype._gather=function(t,n){var r=this,o=this.transceivers[n].iceGatherer;if(!o.onlocalcandidate){var i=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,o.removeEventListener(\"localcandidate\",this.transceivers[n].bufferCandidates),o.onlocalcandidate=function(e){if(!(r.usingBundle&&n>0)){var i=new Event(\"icecandidate\");i.candidate={sdpMid:t,sdpMLineIndex:n};var a=e.candidate,s=!a||0===Object.keys(a).length;if(s)\"new\"!==o.state&&\"gathering\"!==o.state||(o.state=\"completed\");else{\"new\"===o.state&&(o.state=\"gathering\"),a.component=1,a.ufrag=o.getLocalParameters().usernameFragment;var c=Xa.writeCandidate(a);i.candidate=Object.assign(i.candidate,Xa.parseCandidate(c)),i.candidate.candidate=c,i.candidate.toJSON=function(){return{candidate:i.candidate.candidate,sdpMid:i.candidate.sdpMid,sdpMLineIndex:i.candidate.sdpMLineIndex,usernameFragment:i.candidate.usernameFragment}}}var l=Xa.getMediaSections(r._localDescription.sdp);l[i.candidate.sdpMLineIndex]+=s?\"a=end-of-candidates\\r\\n\":\"a=\"+i.candidate.candidate+\"\\r\\n\",r._localDescription.sdp=Xa.getDescription(r._localDescription.sdp)+l.join(\"\");var u=r.transceivers.every((function(e){return e.iceGatherer&&\"completed\"===e.iceGatherer.state}));\"gathering\"!==r.iceGatheringState&&(r.iceGatheringState=\"gathering\",r._emitGatheringStateChange()),s||r._dispatchEvent(\"icecandidate\",i),u&&(r._dispatchEvent(\"icecandidate\",new Event(\"icecandidate\")),r.iceGatheringState=\"complete\",r._emitGatheringStateChange())}},e.setTimeout((function(){i.forEach((function(e){o.onlocalcandidate(e)}))}),0)}},o.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,\"state\",{value:\"failed\",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:r}},o.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},o.prototype._transceive=function(e,n,r){var o=es(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(o.encodings=e.sendEncodingParameters,o.rtcp={cname:Xa.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(o.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(o)),r&&e.rtpReceiver&&o.codecs.length>0&&(\"video\"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),e.recvEncodingParameters.length?o.encodings=e.recvEncodingParameters:o.encodings=[{}],o.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(o.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(o.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(o))},o.prototype.setLocalDescription=function(e){var t,n,r=this;if(-1===[\"offer\",\"answer\"].indexOf(e.type))return Promise.reject(rs(\"TypeError\",'Unsupported type \"'+e.type+'\"'));if(!ts(\"setLocalDescription\",e.type,r.signalingState)||r._isClosed)return Promise.reject(rs(\"InvalidStateError\",\"Can not set local \"+e.type+\" in state \"+r.signalingState));if(\"offer\"===e.type)t=Xa.splitSections(e.sdp),n=t.shift(),t.forEach((function(e,t){var n=Xa.parseRtpParameters(e);r.transceivers[t].localCapabilities=n})),r.transceivers.forEach((function(e,t){r._gather(e.mid,t)}));else if(\"answer\"===e.type){t=Xa.splitSections(r._remoteDescription.sdp),n=t.shift();var o=Xa.matchPrefix(n,\"a=ice-lite\").length>0;t.forEach((function(e,t){var i=r.transceivers[t],a=i.iceGatherer,s=i.iceTransport,c=i.dtlsTransport,l=i.localCapabilities,u=i.remoteCapabilities;if(!(Xa.isRejected(e)&&0===Xa.matchPrefix(e,\"a=bundle-only\").length)&&!i.rejected){var p=Xa.getIceParameters(e,n),d=Xa.getDtlsParameters(e,n);o&&(d.role=\"server\"),r.usingBundle&&0!==t||(r._gather(i.mid,t),\"new\"===s.state&&s.start(a,p,o?\"controlling\":\"controlled\"),\"new\"===c.state&&c.start(d));var f=es(l,u);r._transceive(i,f.codecs.length>0,!1)}}))}return r._localDescription={type:e.type,sdp:e.sdp},\"offer\"===e.type?r._updateSignalingState(\"have-local-offer\"):r._updateSignalingState(\"stable\"),Promise.resolve()},o.prototype.setRemoteDescription=function(o){var i=this;if(-1===[\"offer\",\"answer\"].indexOf(o.type))return Promise.reject(rs(\"TypeError\",'Unsupported type \"'+o.type+'\"'));if(!ts(\"setRemoteDescription\",o.type,i.signalingState)||i._isClosed)return Promise.reject(rs(\"InvalidStateError\",\"Can not set remote \"+o.type+\" in state \"+i.signalingState));var a={};i.remoteStreams.forEach((function(e){a[e.id]=e}));var s=[],c=Xa.splitSections(o.sdp),l=c.shift(),u=Xa.matchPrefix(l,\"a=ice-lite\").length>0,p=Xa.matchPrefix(l,\"a=group:BUNDLE \").length>0;i.usingBundle=p;var d=Xa.matchPrefix(l,\"a=ice-options:\")[0];return i.canTrickleIceCandidates=!!d&&d.substr(14).split(\" \").indexOf(\"trickle\")>=0,c.forEach((function(r,c){var d=Xa.splitLines(r),f=Xa.getKind(r),h=Xa.isRejected(r)&&0===Xa.matchPrefix(r,\"a=bundle-only\").length,m=d[0].substr(2).split(\" \")[2],g=Xa.getDirection(r,l),y=Xa.parseMsid(r),v=Xa.getMid(r)||Xa.generateIdentifier();if(h||\"application\"===f&&(\"DTLS/SCTP\"===m||\"UDP/DTLS/SCTP\"===m))i.transceivers[c]={mid:v,kind:f,protocol:m,rejected:!0};else{var b,w,k,_,S,C,x,T,E;!h&&i.transceivers[c]&&i.transceivers[c].rejected&&(i.transceivers[c]=i._createTransceiver(f,!0));var P,R,O=Xa.parseRtpParameters(r);h||(P=Xa.getIceParameters(r,l),(R=Xa.getDtlsParameters(r,l)).role=\"client\"),x=Xa.parseRtpEncodingParameters(r);var j=Xa.parseRtcpParameters(r),D=Xa.matchPrefix(r,\"a=end-of-candidates\",l).length>0,I=Xa.matchPrefix(r,\"a=candidate:\").map((function(e){return Xa.parseCandidate(e)})).filter((function(e){return 1===e.component}));if((\"offer\"===o.type||\"answer\"===o.type)&&!h&&p&&c>0&&i.transceivers[c]&&(i._disposeIceAndDtlsTransports(c),i.transceivers[c].iceGatherer=i.transceivers[0].iceGatherer,i.transceivers[c].iceTransport=i.transceivers[0].iceTransport,i.transceivers[c].dtlsTransport=i.transceivers[0].dtlsTransport,i.transceivers[c].rtpSender&&i.transceivers[c].rtpSender.setTransport(i.transceivers[0].dtlsTransport),i.transceivers[c].rtpReceiver&&i.transceivers[c].rtpReceiver.setTransport(i.transceivers[0].dtlsTransport)),\"offer\"!==o.type||h){if(\"answer\"===o.type&&!h){w=(b=i.transceivers[c]).iceGatherer,k=b.iceTransport,_=b.dtlsTransport,S=b.rtpReceiver,C=b.sendEncodingParameters,T=b.localCapabilities,i.transceivers[c].recvEncodingParameters=x,i.transceivers[c].remoteCapabilities=O,i.transceivers[c].rtcpParameters=j,I.length&&\"new\"===k.state&&(!u&&!D||p&&0!==c?I.forEach((function(e){ns(b.iceTransport,e)})):k.setRemoteCandidates(I)),p&&0!==c||(\"new\"===k.state&&k.start(w,P,\"controlling\"),\"new\"===_.state&&_.start(R)),!es(b.localCapabilities,b.remoteCapabilities).codecs.filter((function(e){return\"rtx\"===e.name.toLowerCase()})).length&&b.sendEncodingParameters[0].rtx&&delete b.sendEncodingParameters[0].rtx,i._transceive(b,\"sendrecv\"===g||\"recvonly\"===g,\"sendrecv\"===g||\"sendonly\"===g),!S||\"sendrecv\"!==g&&\"sendonly\"!==g?delete b.rtpReceiver:(E=S.track,y?(a[y.stream]||(a[y.stream]=new e.MediaStream),n(E,a[y.stream]),s.push([E,S,a[y.stream]])):(a.default||(a.default=new e.MediaStream),n(E,a.default),s.push([E,S,a.default])))}}else{(b=i.transceivers[c]||i._createTransceiver(f)).mid=v,b.iceGatherer||(b.iceGatherer=i._createIceGatherer(c,p)),I.length&&\"new\"===b.iceTransport.state&&(!D||p&&0!==c?I.forEach((function(e){ns(b.iceTransport,e)})):b.iceTransport.setRemoteCandidates(I)),T=e.RTCRtpReceiver.getCapabilities(f),t<15019&&(T.codecs=T.codecs.filter((function(e){return\"rtx\"!==e.name}))),C=b.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var A,M=!1;if(\"sendrecv\"===g||\"sendonly\"===g){if(M=!b.rtpReceiver,S=b.rtpReceiver||new e.RTCRtpReceiver(b.dtlsTransport,f),M)E=S.track,y&&\"-\"===y.stream||(y?(a[y.stream]||(a[y.stream]=new e.MediaStream,Object.defineProperty(a[y.stream],\"id\",{get:function(){return y.stream}})),Object.defineProperty(E,\"id\",{get:function(){return y.track}}),A=a[y.stream]):(a.default||(a.default=new e.MediaStream),A=a.default)),A&&(n(E,A),b.associatedRemoteMediaStreams.push(A)),s.push([E,S,A])}else b.rtpReceiver&&b.rtpReceiver.track&&(b.associatedRemoteMediaStreams.forEach((function(t){var n=t.getTracks().find((function(e){return e.id===b.rtpReceiver.track.id}));n&&function(t,n){n.removeTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent(\"removetrack\",{track:t}))}(n,t)})),b.associatedRemoteMediaStreams=[]);b.localCapabilities=T,b.remoteCapabilities=O,b.rtpReceiver=S,b.rtcpParameters=j,b.sendEncodingParameters=C,b.recvEncodingParameters=x,i._transceive(i.transceivers[c],!1,M)}}})),void 0===i._dtlsRole&&(i._dtlsRole=\"offer\"===o.type?\"active\":\"passive\"),i._remoteDescription={type:o.type,sdp:o.sdp},\"offer\"===o.type?i._updateSignalingState(\"have-remote-offer\"):i._updateSignalingState(\"stable\"),Object.keys(a).forEach((function(t){var n=a[t];if(n.getTracks().length){if(-1===i.remoteStreams.indexOf(n)){i.remoteStreams.push(n);var o=new Event(\"addstream\");o.stream=n,e.setTimeout((function(){i._dispatchEvent(\"addstream\",o)}))}s.forEach((function(e){var t=e[0],o=e[1];n.id===e[2].id&&r(i,t,o,[n])}))}})),s.forEach((function(e){e[2]||r(i,e[0],e[1],[])})),e.setTimeout((function(){i&&i.transceivers&&i.transceivers.forEach((function(e){e.iceTransport&&\"new\"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn(\"Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification\"),e.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},o.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState(\"closed\")},o.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event(\"signalingstatechange\");this._dispatchEvent(\"signalingstatechange\",t)},o.prototype._maybeFireNegotiationNeeded=function(){var t=this;\"stable\"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event(\"negotiationneeded\");t._dispatchEvent(\"negotiationneeded\",e)}}),0))},o.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++})),e=\"new\",t.failed>0?e=\"failed\":t.checking>0?e=\"checking\":t.disconnected>0?e=\"disconnected\":t.new>0?e=\"new\":t.connected>0?e=\"connected\":t.completed>0&&(e=\"completed\"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event(\"iceconnectionstatechange\");this._dispatchEvent(\"iceconnectionstatechange\",n)}},o.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)})),t.connected+=t.completed,e=\"new\",t.failed>0?e=\"failed\":t.connecting>0?e=\"connecting\":t.disconnected>0?e=\"disconnected\":t.new>0?e=\"new\":t.connected>0&&(e=\"connected\"),e!==this.connectionState){this.connectionState=e;var n=new Event(\"connectionstatechange\");this._dispatchEvent(\"connectionstatechange\",n)}},o.prototype.createOffer=function(){var n=this;if(n._isClosed)return Promise.reject(rs(\"InvalidStateError\",\"Can not call createOffer after close\"));var r=n.transceivers.filter((function(e){return\"audio\"===e.kind})).length,o=n.transceivers.filter((function(e){return\"video\"===e.kind})).length,i=arguments[0];if(i){if(i.mandatory||i.optional)throw new TypeError(\"Legacy mandatory/optional constraints not supported.\");void 0!==i.offerToReceiveAudio&&(r=!0===i.offerToReceiveAudio?1:!1===i.offerToReceiveAudio?0:i.offerToReceiveAudio),void 0!==i.offerToReceiveVideo&&(o=!0===i.offerToReceiveVideo?1:!1===i.offerToReceiveVideo?0:i.offerToReceiveVideo)}for(n.transceivers.forEach((function(e){\"audio\"===e.kind?--r<0&&(e.wantReceive=!1):\"video\"===e.kind&&--o<0&&(e.wantReceive=!1)}));r>0||o>0;)r>0&&(n._createTransceiver(\"audio\"),r--),o>0&&(n._createTransceiver(\"video\"),o--);var a=Xa.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach((function(r,o){var i=r.track,a=r.kind,s=r.mid||Xa.generateIdentifier();r.mid=s,r.iceGatherer||(r.iceGatherer=n._createIceGatherer(o,n.usingBundle));var c=e.RTCRtpSender.getCapabilities(a);t<15019&&(c.codecs=c.codecs.filter((function(e){return\"rtx\"!==e.name}))),c.codecs.forEach((function(e){\"H264\"===e.name&&void 0===e.parameters[\"level-asymmetry-allowed\"]&&(e.parameters[\"level-asymmetry-allowed\"]=\"1\"),r.remoteCapabilities&&r.remoteCapabilities.codecs&&r.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))})),c.headerExtensions.forEach((function(e){(r.remoteCapabilities&&r.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))}));var l=r.sendEncodingParameters||[{ssrc:1001*(2*o+1)}];i&&t>=15019&&\"video\"===a&&!l[0].rtx&&(l[0].rtx={ssrc:l[0].ssrc+1}),r.wantReceive&&(r.rtpReceiver=new e.RTCRtpReceiver(r.dtlsTransport,a)),r.localCapabilities=c,r.sendEncodingParameters=l})),\"max-compat\"!==n._config.bundlePolicy&&(a+=\"a=group:BUNDLE \"+n.transceivers.map((function(e){return e.mid})).join(\" \")+\"\\r\\n\"),a+=\"a=ice-options:trickle\\r\\n\",n.transceivers.forEach((function(e,t){a+=Qa(e,e.localCapabilities,\"offer\",e.stream,n._dtlsRole),a+=\"a=rtcp-rsize\\r\\n\",!e.iceGatherer||\"new\"===n.iceGatheringState||0!==t&&n.usingBundle||(e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1,a+=\"a=\"+Xa.writeCandidate(e)+\"\\r\\n\"})),\"completed\"===e.iceGatherer.state&&(a+=\"a=end-of-candidates\\r\\n\"))}));var s=new e.RTCSessionDescription({type:\"offer\",sdp:a});return Promise.resolve(s)},o.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(rs(\"InvalidStateError\",\"Can not call createAnswer after close\"));if(\"have-remote-offer\"!==n.signalingState&&\"have-local-pranswer\"!==n.signalingState)return Promise.reject(rs(\"InvalidStateError\",\"Can not call createAnswer in signalingState \"+n.signalingState));var r=Xa.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(r+=\"a=group:BUNDLE \"+n.transceivers.map((function(e){return e.mid})).join(\" \")+\"\\r\\n\"),r+=\"a=ice-options:trickle\\r\\n\";var o=Xa.getMediaSections(n._remoteDescription.sdp).length;n.transceivers.forEach((function(e,i){if(!(i+1>o)){if(e.rejected)return\"application\"===e.kind?\"DTLS/SCTP\"===e.protocol?r+=\"m=application 0 DTLS/SCTP 5000\\r\\n\":r+=\"m=application 0 \"+e.protocol+\" webrtc-datachannel\\r\\n\":\"audio\"===e.kind?r+=\"m=audio 0 UDP/TLS/RTP/SAVPF 0\\r\\na=rtpmap:0 PCMU/8000\\r\\n\":\"video\"===e.kind&&(r+=\"m=video 0 UDP/TLS/RTP/SAVPF 120\\r\\na=rtpmap:120 VP8/90000\\r\\n\"),void(r+=\"c=IN IP4 0.0.0.0\\r\\na=inactive\\r\\na=mid:\"+e.mid+\"\\r\\n\");var a;if(e.stream)\"audio\"===e.kind?a=e.stream.getAudioTracks()[0]:\"video\"===e.kind&&(a=e.stream.getVideoTracks()[0]),a&&t>=15019&&\"video\"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var s=es(e.localCapabilities,e.remoteCapabilities);!s.codecs.filter((function(e){return\"rtx\"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,r+=Qa(e,s,\"answer\",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(r+=\"a=rtcp-rsize\\r\\n\")}}));var i=new e.RTCSessionDescription({type:\"answer\",sdp:r});return Promise.resolve(i)},o.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError(\"sdpMLineIndex or sdpMid required\")):new Promise((function(r,o){if(!n._remoteDescription)return o(rs(\"InvalidStateError\",\"Can not add ICE candidate without a remote description\"));if(e&&\"\"!==e.candidate){var i=e.sdpMLineIndex;if(e.sdpMid)for(var a=0;a<n.transceivers.length;a++)if(n.transceivers[a].mid===e.sdpMid){i=a;break}var s=n.transceivers[i];if(!s)return o(rs(\"OperationError\",\"Can not add ICE candidate\"));if(s.rejected)return r();var c=Object.keys(e.candidate).length>0?Xa.parseCandidate(e.candidate):{};if(\"tcp\"===c.protocol&&(0===c.port||9===c.port))return r();if(c.component&&1!==c.component)return r();if((0===i||i>0&&s.iceTransport!==n.transceivers[0].iceTransport)&&!ns(s.iceTransport,c))return o(rs(\"OperationError\",\"Can not add ICE candidate\"));var l=e.candidate.trim();0===l.indexOf(\"a=\")&&(l=l.substr(2)),(t=Xa.getMediaSections(n._remoteDescription.sdp))[i]+=\"a=\"+(c.type?l:\"end-of-candidates\")+\"\\r\\n\",n._remoteDescription.sdp=Xa.getDescription(n._remoteDescription.sdp)+t.join(\"\")}else for(var u=0;u<n.transceivers.length&&(n.transceivers[u].rejected||(n.transceivers[u].iceTransport.addRemoteCandidate({}),(t=Xa.getMediaSections(n._remoteDescription.sdp))[u]+=\"a=end-of-candidates\\r\\n\",n._remoteDescription.sdp=Xa.getDescription(n._remoteDescription.sdp)+t.join(\"\"),!n.usingBundle));u++);r()}))},o.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var n=null;if(this.transceivers.forEach((function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)})),!n)throw rs(\"InvalidAccessError\",\"Invalid selector.\");return n.getStats()}var r=[];return this.transceivers.forEach((function(e){[\"rtpSender\",\"rtpReceiver\",\"iceGatherer\",\"iceTransport\",\"dtlsTransport\"].forEach((function(t){e[t]&&r.push(e[t].getStats())}))})),Promise.all(r).then((function(e){var t=new Map;return e.forEach((function(e){e.forEach((function(e){t.set(e.id,e)}))})),t}))};[\"RTCRtpSender\",\"RTCRtpReceiver\",\"RTCIceGatherer\",\"RTCIceTransport\",\"RTCDtlsTransport\"].forEach((function(t){var n=e[t];if(n&&n.prototype&&n.prototype.getStats){var r=n.prototype.getStats;n.prototype.getStats=function(){return r.apply(this).then((function(e){var t=new Map;return Object.keys(e).forEach((function(n){var r;e[n].type={inboundrtp:\"inbound-rtp\",outboundrtp:\"outbound-rtp\",candidatepair:\"candidate-pair\",localcandidate:\"local-candidate\",remotecandidate:\"remote-candidate\"}[(r=e[n]).type]||r.type,t.set(n,e[n])})),t}))}}}));var i=[\"createOffer\",\"createAnswer\"];return i.forEach((function(e){var t=o.prototype[e];o.prototype[e]=function(){var e=arguments;return\"function\"==typeof e[0]||\"function\"==typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){\"function\"==typeof e[0]&&e[0].apply(null,[t])}),(function(t){\"function\"==typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}})),(i=[\"setLocalDescription\",\"setRemoteDescription\",\"addIceCandidate\"]).forEach((function(e){var t=o.prototype[e];o.prototype[e]=function(){var e=arguments;return\"function\"==typeof e[1]||\"function\"==typeof e[2]?t.apply(this,arguments).then((function(){\"function\"==typeof e[1]&&e[1].apply(null)}),(function(t){\"function\"==typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}})),[\"getStats\"].forEach((function(e){var t=o.prototype[e];o.prototype[e]=function(){var e=arguments;return\"function\"==typeof e[1]?t.apply(this,arguments).then((function(){\"function\"==typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}})),o};function is(e){const t=e&&e.navigator,n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch((e=>Promise.reject(function(e){return{name:{PermissionDeniedError:\"NotAllowedError\"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString(){return this.name}}}(e))))}}function as(e){\"getDisplayMedia\"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&\"getDisplayMedia\"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}function ss(e,t){if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){const t=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,\"enabled\");Object.defineProperty(e.MediaStreamTrack.prototype,\"enabled\",{set(e){t.set.call(this,e);const n=new Event(\"enabled\");n.enabled=e,this.dispatchEvent(n)}})}e.RTCRtpSender&&!(\"dtmf\"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,\"dtmf\",{get(){return void 0===this._dtmf&&(\"audio\"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):\"video\"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);const n=os(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=function(e,t){let n=!1;return(e=JSON.parse(JSON.stringify(e))).filter((e=>{if(e&&(e.urls||e.url)){let t=e.urls||e.url;e.url&&!e.urls&&Ia(\"RTCIceServer.url\",\"RTCIceServer.urls\");const r=\"string\"==typeof t;return r&&(t=[t]),t=t.filter((e=>{if(0===e.indexOf(\"stun:\"))return!1;const t=e.startsWith(\"turn\")&&!e.startsWith(\"turn:[\")&&e.includes(\"transport=udp\");return t&&!n?(n=!0,!0):t&&!n})),delete e.url,e.urls=r?t[0]:t,!!t.length}}))}(e.iceServers,t.version),Da(\"ICE servers after filtering:\",e.iceServers)),new n(e)},e.RTCPeerConnection.prototype=n.prototype}function cs(e){e.RTCRtpSender&&!(\"replaceTrack\"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}var ls=Object.freeze({__proto__:null,shimPeerConnection:ss,shimReplaceTrack:cs,shimGetUserMedia:is,shimGetDisplayMedia:as});function us(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){Ia(\"navigator.getUserMedia\",\"navigator.mediaDevices.getUserMedia\"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&\"autoGainControl\"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return\"object\"==typeof n&&\"object\"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,\"autoGainControl\",\"mozAutoGainControl\"),e(n.audio,\"noiseSuppression\",\"mozNoiseSuppression\")),t(n)},r&&r.prototype.getSettings){const t=r.prototype.getSettings;r.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,\"mozAutoGainControl\",\"autoGainControl\"),e(n,\"mozNoiseSuppression\",\"noiseSuppression\"),n}}if(r&&r.prototype.applyConstraints){const t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(n){return\"audio\"===this.kind&&\"object\"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,\"autoGainControl\",\"mozAutoGainControl\"),e(n,\"noiseSuppression\",\"mozNoiseSuppression\")),t.apply(this,[n])}}}}function ps(e){\"object\"==typeof e&&e.RTCTrackEvent&&\"receiver\"in e.RTCTrackEvent.prototype&&!(\"transceiver\"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,\"transceiver\",{get(){return{receiver:this.receiver}}})}function ds(e,t){if(\"object\"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&[\"setLocalDescription\",\"setRemoteDescription\",\"addIceCandidate\"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new(\"addIceCandidate\"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}));const n={inboundrtp:\"inbound-rtp\",outboundrtp:\"outbound-rtp\",candidatepair:\"candidate-pair\",localcandidate:\"local-candidate\",remotecandidate:\"remote-candidate\"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,o,i]=arguments;return r.apply(this,[e||null]).then((e=>{if(t.version<53&&!o)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(t){if(\"TypeError\"!==t.name)throw t;e.forEach(((t,r)=>{e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(o,i)}}function fs(e){if(\"object\"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&\"getStats\"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function hs(e){if(\"object\"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&\"getStats\"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),Ra(e,\"track\",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function ms(e){e.RTCPeerConnection&&!(\"removeStream\"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){Ia(\"removeStream\",\"removeTrack\"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function gs(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function ys(e){if(\"object\"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const e=arguments[1],n=e&&\"sendEncodings\"in e;n&&e.sendEncodings.forEach((e=>{if(\"rid\"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError(\"Invalid RID value provided.\")}if(\"scaleResolutionDownBy\"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError(\"scale_resolution_down_by must be >= 1.0\");if(\"maxFramerate\"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError(\"max_framerate must be >= 0.0\")}));const r=t.apply(this,arguments);if(n){const{sender:t}=r,n=t.getParameters();(!(\"encodings\"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e.sendEncodings,t.sendEncodings=e.sendEncodings,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return r})}function vs(e){if(\"object\"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return\"encodings\"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function bs(e){if(\"object\"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function ws(e){if(\"object\"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var ks=Object.freeze({__proto__:null,shimOnTrack:ps,shimPeerConnection:ds,shimSenderGetStats:fs,shimReceiverGetStats:hs,shimRemoveStream:ms,shimRTCDataChannel:gs,shimAddTransceiver:ys,shimGetParameters:vs,shimCreateOffer:bs,shimCreateAnswer:ws,shimGetUserMedia:us,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&\"getDisplayMedia\"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException(\"getDisplayMedia without video constraints is undefined\");return e.name=\"NotFoundError\",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}});function _s(e){if(\"object\"==typeof e&&e.RTCPeerConnection){if(\"getLocalStreams\"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!(\"addStream\"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e,...n){return n&&n.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}\"removeStream\"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach((e=>{n.includes(e.track)&&this.removeTrack(e)}))})}}function Ss(e){if(\"object\"==typeof e&&e.RTCPeerConnection&&(\"getRemoteStreams\"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!(\"onaddstream\"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,\"onaddstream\",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener(\"addstream\",this._onaddstream),this.removeEventListener(\"track\",this._onaddstreampoly)),this.addEventListener(\"addstream\",this._onaddstream=e),this.addEventListener(\"track\",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event(\"addstream\");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener(\"track\",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event(\"addstream\");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function Cs(e){if(\"object\"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,o=t.setLocalDescription,i=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],o=n.apply(this,[r]);return t?(o.then(e,t),Promise.resolve()):o},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],o=r.apply(this,[n]);return t?(o.then(e,t),Promise.resolve()):o};let s=function(e,t,n){const r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){const r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){const r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=s}function xs(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(Ts(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function Ts(e){return e&&void 0!==e.video?Object.assign({},e,{video:Ma(e.video)}):e}function Es(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];!r.hasOwnProperty(\"urls\")&&r.hasOwnProperty(\"url\")?(Ia(\"RTCIceServer.url\",\"RTCIceServer.urls\"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,\"generateCertificate\"in t&&Object.defineProperty(e.RTCPeerConnection,\"generateCertificate\",{get:()=>t.generateCertificate})}function Ps(e){\"object\"==typeof e&&e.RTCTrackEvent&&\"receiver\"in e.RTCTrackEvent.prototype&&!(\"transceiver\"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,\"transceiver\",{get(){return{receiver:this.receiver}}})}function Rs(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>\"audio\"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?\"sendrecv\"===t.direction?t.setDirection?t.setDirection(\"sendonly\"):t.direction=\"sendonly\":\"recvonly\"===t.direction&&(t.setDirection?t.setDirection(\"inactive\"):t.direction=\"inactive\"):!0!==e.offerToReceiveAudio||t||this.addTransceiver(\"audio\"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find((e=>\"video\"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?\"sendrecv\"===n.direction?n.setDirection?n.setDirection(\"sendonly\"):n.direction=\"sendonly\":\"recvonly\"===n.direction&&(n.setDirection?n.setDirection(\"inactive\"):n.direction=\"inactive\"):!0!==e.offerToReceiveVideo||n||this.addTransceiver(\"video\")}return t.apply(this,arguments)}}function Os(e){\"object\"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var js=Object.freeze({__proto__:null,shimLocalStreamsAPI:_s,shimRemoteStreamsAPI:Ss,shimCallbacksAPI:Cs,shimGetUserMedia:xs,shimConstraints:Ts,shimRTCIceServerUrls:Es,shimTrackEventTransceiver:Ps,shimCreateOfferLegacy:Rs,shimAudioContext:Os});function Ds(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&\"foundation\"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if(\"object\"==typeof e&&e.candidate&&0===e.candidate.indexOf(\"a=\")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const n=new t(e),r=Ka.parseCandidate(e.candidate),o=Object.assign(n,r);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,Ra(e,\"icecandidate\",(t=>(t.candidate&&Object.defineProperty(t,\"candidate\",{value:new e.RTCIceCandidate(t.candidate),writable:\"false\"}),t)))}function Is(e,t){if(!e.RTCPeerConnection)return;\"sctp\"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,\"sctp\",{get(){return void 0===this._sctp?null:this._sctp}});const n=function(e){if(!e||!e.sdp)return!1;const t=Ka.splitSections(e.sdp);return t.shift(),t.some((e=>{const t=Ka.parseMLine(e);return t&&\"application\"===t.kind&&-1!==t.protocol.indexOf(\"SCTP\")}))},r=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n},o=function(e){let n=65536;return\"firefox\"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},i=function(e,n){let r=65536;\"firefox\"===t.browser&&57===t.version&&(r=65535);const o=Ka.matchPrefix(e.sdp,\"a=max-message-size:\");return o.length>0?r=parseInt(o[0].substr(19),10):\"firefox\"===t.browser&&-1!==n&&(r=2147483637),r},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,\"chrome\"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();\"plan-b\"===e&&Object.defineProperty(this,\"sctp\",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const e=r(arguments[0]),t=o(e),n=i(arguments[0],e);let a;a=0===t&&0===n?Number.POSITIVE_INFINITY:0===t||0===n?Math.max(t,n):Math.min(t,n);const s={};Object.defineProperty(s,\"maxMessageSize\",{get:()=>a}),this._sctp=s}return a.apply(this,arguments)}}function As(e){if(!e.RTCPeerConnection||!(\"createDataChannel\"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const r=arguments[0],o=r.length||r.size||r.byteLength;if(\"open\"===e.readyState&&t.sctp&&o>t.sctp.maxMessageSize)throw new TypeError(\"Message too large (can send a maximum of \"+t.sctp.maxMessageSize+\" bytes)\");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},Ra(e,\"datachannel\",(e=>(t(e.channel,e.target),e)))}function Ms(e){if(!e.RTCPeerConnection||\"connectionState\"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,\"connectionState\",{get(){return{completed:\"connected\",checking:\"connecting\"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,\"onconnectionstatechange\",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener(\"connectionstatechange\",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener(\"connectionstatechange\",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),[\"setLocalDescription\",\"setRemoteDescription\"].forEach((e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event(\"connectionstatechange\",e);t.dispatchEvent(n)}return e},this.addEventListener(\"iceconnectionstatechange\",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function Ls(e,t){if(!e.RTCPeerConnection)return;if(\"chrome\"===t.browser&&t.version>=71)return;if(\"safari\"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf(\"\\na=extmap-allow-mixed\")){const n=t.sdp.split(\"\\n\").filter((e=>\"a=extmap-allow-mixed\"!==e.trim())).join(\"\\n\");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function zs(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(\"chrome\"===t.browser&&t.version<78||\"firefox\"===t.browser&&t.version<68||\"safari\"===t.browser)&&arguments[0]&&\"\"===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}var Bs=Object.freeze({__proto__:null,shimRTCIceCandidate:Ds,shimMaxMessageSize:Is,shimSendThrowTypeError:As,shimConnectionState:Ms,removeExtmapAllowMixed:Ls,shimAddIceCandidateNullOrEmpty:zs});const Ns=function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const n=Da,r=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser=\"Not a browser.\",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser=\"firefox\",t.version=Pa(n.userAgent,/Firefox\\/(\\d+)\\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser=\"chrome\",t.version=Pa(n.userAgent,/Chrom(e|ium)\\/(\\d+)\\./,2);else if(n.mediaDevices&&n.userAgent.match(/Edge\\/(\\d+).(\\d+)$/))t.browser=\"edge\",t.version=Pa(n.userAgent,/Edge\\/(\\d+).(\\d+)$/,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\\/(\\d+)\\./))return t.browser=\"Not a supported browser.\",t;t.browser=\"safari\",t.version=Pa(n.userAgent,/AppleWebKit\\/(\\d+)\\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&\"currentDirection\"in e.RTCRtpTransceiver.prototype}return t}(e),o={browserDetails:r,commonShim:Bs,extractVersion:Pa,disableLog:Oa,disableWarnings:ja};switch(r.browser){case\"chrome\":if(!Za||!Ha||!t.shimChrome)return n(\"Chrome shim is not included in this adapter release.\"),o;if(null===r.version)return n(\"Chrome shim can not determine version, not shimming.\"),o;n(\"adapter.js shimming chrome.\"),o.browserShim=Za,zs(e,r),Na(e,r),Fa(e),Ha(e,r),Ua(e),Ja(e,r),$a(e),qa(e),Ga(e),Wa(e,r),Ds(e),Ms(e),Is(e,r),As(e),Ls(e,r);break;case\"firefox\":if(!ks||!ds||!t.shimFirefox)return n(\"Firefox shim is not included in this adapter release.\"),o;n(\"adapter.js shimming firefox.\"),o.browserShim=ks,zs(e,r),us(e,r),ds(e,r),ps(e),ms(e),fs(e),hs(e),gs(e),ys(e),vs(e),bs(e),ws(e),Ds(e),Ms(e),Is(e,r),As(e);break;case\"edge\":if(!ls||!ss||!t.shimEdge)return n(\"MS edge shim is not included in this adapter release.\"),o;n(\"adapter.js shimming edge.\"),o.browserShim=ls,is(e),as(e),ss(e,r),cs(e),Is(e,r),As(e);break;case\"safari\":if(!js||!t.shimSafari)return n(\"Safari shim is not included in this adapter release.\"),o;n(\"adapter.js shimming safari.\"),o.browserShim=js,zs(e,r),Es(e),Rs(e),Cs(e),_s(e),Ss(e),Ps(e),xs(e),Os(e),Ds(e),Is(e,r),As(e),Ls(e,r);break;default:n(\"Unsupported browser!\")}return o}({window:\"undefined\"==typeof window?void 0:window});function Fs(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}var Us=Ns.default||Ns,$s=new(function(){function e(){this.isIOS=[\"iPad\",\"iPhone\",\"iPod\"].includes(navigator.platform),this.supportedBrowsers=[\"firefox\",\"chrome\",\"safari\"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return e.prototype.isWebRTCSupported=function(){return\"undefined\"!=typeof RTCPeerConnection},e.prototype.isBrowserSupported=function(){var e=this.getBrowser(),t=this.getVersion();return!!this.supportedBrowsers.includes(e)&&(\"chrome\"===e?t>=this.minChromeVersion:\"firefox\"===e?t>=this.minFirefoxVersion:\"safari\"===e&&(!this.isIOS&&t>=this.minSafariVersion))},e.prototype.getBrowser=function(){return Us.browserDetails.browser},e.prototype.getVersion=function(){return Us.browserDetails.version||0},e.prototype.isUnifiedPlanSupported=function(){var e,t=this.getBrowser(),n=Us.browserDetails.version||0;if(\"chrome\"===t&&n<this.minChromeVersion)return!1;if(\"firefox\"===t&&n>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!(\"currentDirection\"in RTCRtpTransceiver.prototype))return!1;var r=!1;try{(e=new RTCPeerConnection).addTransceiver(\"audio\"),r=!0}catch(e){}finally{e&&e.close()}return r},e.prototype.toString=function(){return\"Supports:\\n    browser:\".concat(this.getBrowser(),\"\\n    version:\").concat(this.getVersion(),\"\\n    isIOS:\").concat(this.isIOS,\"\\n    isWebRTCSupported:\").concat(this.isWebRTCSupported(),\"\\n    isBrowserSupported:\").concat(this.isBrowserSupported(),\"\\n    isUnifiedPlanSupported:\").concat(this.isUnifiedPlanSupported())},e}()),qs={iceServers:[{urls:\"stun:stun.l.google.com:19302\"},{urls:[\"turn:eu-0.turn.peerjs.com:3478\",\"turn:us-0.turn.peerjs.com:3478\"],username:\"peerjs\",credential:\"peerjsp\"}],sdpSemantics:\"unified-plan\"},Gs=new(function(){function e(){this.CLOUD_HOST=\"0.peerjs.com\",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=qs,this.browser=$s.getBrowser(),this.browserVersion=$s.getVersion(),this.supports=function(){var e,t={browser:$s.isBrowserSupported(),webRTC:$s.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!t.webRTC)return t;try{e=new RTCPeerConnection(qs),t.audioVideo=!0;var n=void 0;try{n=e.createDataChannel(\"_PEERJSTEST\",{ordered:!0}),t.data=!0,t.reliable=!!n.ordered;try{n.binaryType=\"blob\",t.binaryBlob=!$s.isIOS}catch(e){}}catch(e){}finally{n&&n.close()}}catch(e){}finally{e&&e.close()}return t}(),this.pack=_a.pack,this.unpack=_a.unpack,this._dataCount=1}return e.prototype.noop=function(){},e.prototype.validateId=function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e)},e.prototype.chunk=function(e){for(var t=[],n=e.size,r=Math.ceil(n/Gs.chunkedMTU),o=0,i=0;i<n;){var a=Math.min(n,i+Gs.chunkedMTU),s=e.slice(i,a),c={__peerData:this._dataCount,n:o,data:s,total:r};t.push(c),i=a,o++}return this._dataCount++,t},e.prototype.blobToArrayBuffer=function(e,t){var n=new FileReader;return n.onload=function(e){e.target&&t(e.target.result)},n.readAsArrayBuffer(e),n},e.prototype.binaryStringToArrayBuffer=function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=255&e.charCodeAt(n);return t.buffer},e.prototype.randomToken=function(){return Math.random().toString(36).slice(2)},e.prototype.isSecure=function(){return\"https:\"===location.protocol},e}()),Vs={};Fs(Vs,\"Peer\",(()=>qc),(e=>qc=e));var Js,Hs=Object.prototype.hasOwnProperty,Ws=\"~\";function Zs(){}function Ys(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function Ks(e,t,n,r,o){if(\"function\"!=typeof n)throw new TypeError(\"The listener must be a function\");var i=new Ys(n,r||e,o),a=Ws?Ws+t:t;return e._events[a]?e._events[a].fn?e._events[a]=[e._events[a],i]:e._events[a].push(i):(e._events[a]=i,e._eventsCount++),e}function Xs(e,t){0==--e._eventsCount?e._events=new Zs:delete e._events[t]}function Qs(){this._events=new Zs,this._eventsCount=0}Object.create&&(Zs.prototype=Object.create(null),(new Zs).__proto__||(Ws=!1)),Qs.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)Hs.call(e,t)&&n.push(Ws?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},Qs.prototype.listeners=function(e){var t=Ws?Ws+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,o=n.length,i=new Array(o);r<o;r++)i[r]=n[r].fn;return i},Qs.prototype.listenerCount=function(e){var t=Ws?Ws+e:e,n=this._events[t];return n?n.fn?1:n.length:0},Qs.prototype.emit=function(e,t,n,r,o,i){var a=Ws?Ws+e:e;if(!this._events[a])return!1;var s,c,l=this._events[a],u=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),u){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,r),!0;case 5:return l.fn.call(l.context,t,n,r,o),!0;case 6:return l.fn.call(l.context,t,n,r,o,i),!0}for(c=1,s=new Array(u-1);c<u;c++)s[c-1]=arguments[c];l.fn.apply(l.context,s)}else{var p,d=l.length;for(c=0;c<d;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),u){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,n);break;case 4:l[c].fn.call(l[c].context,t,n,r);break;default:if(!s)for(p=1,s=new Array(u-1);p<u;p++)s[p-1]=arguments[p];l[c].fn.apply(l[c].context,s)}}return!0},Qs.prototype.on=function(e,t,n){return Ks(this,e,t,n,!1)},Qs.prototype.once=function(e,t,n){return Ks(this,e,t,n,!0)},Qs.prototype.removeListener=function(e,t,n,r){var o=Ws?Ws+e:e;if(!this._events[o])return this;if(!t)return Xs(this,o),this;var i=this._events[o];if(i.fn)i.fn!==t||r&&!i.once||n&&i.context!==n||Xs(this,o);else{for(var a=0,s=[],c=i.length;a<c;a++)(i[a].fn!==t||r&&!i[a].once||n&&i[a].context!==n)&&s.push(i[a]);s.length?this._events[o]=1===s.length?s[0]:s:Xs(this,o)}return this},Qs.prototype.removeAllListeners=function(e){var t;return e?(t=Ws?Ws+e:e,this._events[t]&&Xs(this,t)):(this._events=new Zs,this._eventsCount=0),this},Qs.prototype.off=Qs.prototype.removeListener,Qs.prototype.addListener=Qs.prototype.on,Qs.prefixed=Ws,Qs.EventEmitter=Qs,Js=Qs;var ec={};Fs(ec,\"LogLevel\",(()=>tc),(e=>tc=e)),Fs(ec,\"default\",(()=>pc),(e=>pc=e));var tc,nc=function(e,t){var n=\"function\"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},rc=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},oc=\"PeerJS: \";!function(e){e[e.Disabled=0]=\"Disabled\",e[e.Errors=1]=\"Errors\",e[e.Warnings=2]=\"Warnings\",e[e.All=3]=\"All\"}(tc||(tc={}));var ic,ac,sc,cc,lc,uc=function(){function e(){this._logLevel=tc.Disabled}return Object.defineProperty(e.prototype,\"logLevel\",{get:function(){return this._logLevel},set:function(e){this._logLevel=e},enumerable:!1,configurable:!0}),e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=tc.All&&this._print.apply(this,rc([tc.All],nc(e),!1))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=tc.Warnings&&this._print.apply(this,rc([tc.Warnings],nc(e),!1))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=tc.Errors&&this._print.apply(this,rc([tc.Errors],nc(e),!1))},e.prototype.setLogFunction=function(e){this._print=e},e.prototype._print=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=rc([oc],nc(t),!1);for(var o in r)r[o]instanceof Error&&(r[o]=\"(\"+r[o].name+\") \"+r[o].message);e>=tc.All?console.log.apply(console,rc([],nc(r),!1)):e>=tc.Warnings?console.warn.apply(console,rc([\"WARNING\"],nc(r),!1)):e>=tc.Errors&&console.error.apply(console,rc([\"ERROR\"],nc(r),!1))},e}(),pc=new uc,dc={};Fs(dc,\"Socket\",(()=>gc),(e=>gc=e)),function(e){e.Data=\"data\",e.Media=\"media\"}(ic||(ic={})),function(e){e.BrowserIncompatible=\"browser-incompatible\",e.Disconnected=\"disconnected\",e.InvalidID=\"invalid-id\",e.InvalidKey=\"invalid-key\",e.Network=\"network\",e.PeerUnavailable=\"peer-unavailable\",e.SslUnavailable=\"ssl-unavailable\",e.ServerError=\"server-error\",e.SocketError=\"socket-error\",e.SocketClosed=\"socket-closed\",e.UnavailableID=\"unavailable-id\",e.WebRTC=\"webrtc\"}(ac||(ac={})),function(e){e.Binary=\"binary\",e.BinaryUTF8=\"binary-utf8\",e.JSON=\"json\"}(sc||(sc={})),function(e){e.Message=\"message\",e.Disconnected=\"disconnected\",e.Error=\"error\",e.Close=\"close\"}(cc||(cc={})),function(e){e.Heartbeat=\"HEARTBEAT\",e.Candidate=\"CANDIDATE\",e.Offer=\"OFFER\",e.Answer=\"ANSWER\",e.Open=\"OPEN\",e.Error=\"ERROR\",e.IdTaken=\"ID-TAKEN\",e.InvalidKey=\"INVALID-KEY\",e.Leave=\"LEAVE\",e.Expire=\"EXPIRE\"}(lc||(lc={}));var fc;fc=JSON.parse('{\"name\":\"peerjs\",\"version\":\"1.4.7\",\"keywords\":[\"peerjs\",\"webrtc\",\"p2p\",\"rtc\"],\"description\":\"PeerJS client\",\"homepage\":\"https://peerjs.com\",\"bugs\":{\"url\":\"https://github.com/peers/peerjs/issues\"},\"repository\":{\"type\":\"git\",\"url\":\"https://github.com/peers/peerjs\"},\"license\":\"MIT\",\"contributors\":[\"Michelle Bu <michelle@michellebu.com>\",\"afrokick <devbyru@gmail.com>\",\"ericz <really.ez@gmail.com>\",\"Jairo <kidandcat@gmail.com>\",\"Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>\",\"Jairo Caro-Accino Viciana <jairo@galax.be>\",\"Carlos Caballero <carlos.caballero.gonzalez@gmail.com>\",\"hc <hheennrryy@gmail.com>\",\"Muhammad Asif <capripio@gmail.com>\",\"PrashoonB <prashoonbhattacharjee@gmail.com>\",\"Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>\",\"akotynski <aleksanderkotbury@gmail.com>\",\"lmb <i@lmb.io>\",\"Jairooo <jairocaro@msn.com>\",\"Moritz Stückler <moritz.stueckler@gmail.com>\",\"Simon <crydotsnakegithub@gmail.com>\",\"Denis Lukov <denismassters@gmail.com>\",\"Philipp Hancke <fippo@andyet.net>\",\"Hans Oksendahl <hansoksendahl@gmail.com>\",\"Jess <jessachandler@gmail.com>\",\"khankuan <khankuan@gmail.com>\",\"DUODVK <kurmanov.work@gmail.com>\",\"XiZhao <kwang1imsa@gmail.com>\",\"Matthias Lohr <matthias@lohr.me>\",\"=frank tree <=frnktrb@googlemail.com>\",\"Andre Eckardt <aeckardt@outlook.com>\",\"Chris Cowan <agentme49@gmail.com>\",\"Alex Chuev <alex@chuev.com>\",\"alxnull <alxnull@e.mail.de>\",\"Yemel Jardi <angel.jardi@gmail.com>\",\"Ben Parnell <benjaminparnell.94@gmail.com>\",\"Benny Lichtner <bennlich@gmail.com>\",\"fresheneesz <bitetrudpublic@gmail.com>\",\"bob.barstead@exaptive.com <bob.barstead@exaptive.com>\",\"chandika <chandika@gmail.com>\",\"emersion <contact@emersion.fr>\",\"Christopher Van <cvan@users.noreply.github.com>\",\"eddieherm <edhermoso@gmail.com>\",\"Eduardo Pinho <enet4mikeenet@gmail.com>\",\"Evandro Zanatta <ezanatta@tray.net.br>\",\"Gardner Bickford <gardner@users.noreply.github.com>\",\"Gian Luca <gianluca.cecchi@cynny.com>\",\"PatrickJS <github@gdi2290.com>\",\"jonnyf <github@jonathanfoss.co.uk>\",\"Hizkia Felix <hizkifw@gmail.com>\",\"Hristo Oskov <hristo.oskov@gmail.com>\",\"Isaac Madwed <i.madwed@gmail.com>\",\"Ilya Konanykhin <ilya.konanykhin@gmail.com>\",\"jasonbarry <jasbarry@me.com>\",\"Jonathan Burke <jonathan.burke.1311@googlemail.com>\",\"Josh Hamit <josh.hamit@gmail.com>\",\"Jordan Austin <jrax86@gmail.com>\",\"Joel Wetzell <jwetzell@yahoo.com>\",\"xizhao <kevin.wang@cloudera.com>\",\"Alberto Torres <kungfoobar@gmail.com>\",\"Jonathan Mayol <mayoljonathan@gmail.com>\",\"Jefferson Felix <me@jsfelix.dev>\",\"Rolf Erik Lekang <me@rolflekang.com>\",\"Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>\",\"Pepijn de Vos <pepijndevos@gmail.com>\",\"JooYoung <qkdlql@naver.com>\",\"Tobias Speicher <rootcommander@gmail.com>\",\"Steve Blaurock <sblaurock@gmail.com>\",\"Kyrylo Shegeda <shegeda@ualberta.ca>\",\"Diwank Singh Tomer <singh@diwank.name>\",\"Sören Balko <Soeren.Balko@gmail.com>\",\"Arpit Solanki <solankiarpit1997@gmail.com>\",\"Yuki Ito <yuki@gnnk.net>\",\"Artur Zayats <zag2art@gmail.com>\"],\"funding\":{\"type\":\"opencollective\",\"url\":\"https://opencollective.com/peer\"},\"collective\":{\"type\":\"opencollective\",\"url\":\"https://opencollective.com/peer\"},\"files\":[\"dist/*\"],\"sideEffects\":[\"lib/global.ts\",\"lib/supports.ts\"],\"main\":\"dist/bundler.cjs\",\"module\":\"dist/bundler.mjs\",\"browser-minified\":\"dist/peerjs.min.js\",\"browser-unminified\":\"dist/peerjs.js\",\"types\":\"dist/types.d.ts\",\"engines\":{\"node\":\">= 10\"},\"targets\":{\"types\":{\"source\":\"lib/exports.ts\"},\"main\":{\"source\":\"lib/exports.ts\",\"sourceMap\":{\"inlineSources\":true}},\"module\":{\"source\":\"lib/exports.ts\",\"includeNodeModules\":[\"eventemitter3\"],\"sourceMap\":{\"inlineSources\":true}},\"browser-minified\":{\"context\":\"browser\",\"outputFormat\":\"global\",\"optimize\":true,\"engines\":{\"browsers\":\"cover 99%, not dead\"},\"source\":\"lib/global.ts\"},\"browser-unminified\":{\"context\":\"browser\",\"outputFormat\":\"global\",\"optimize\":false,\"engines\":{\"browsers\":\"cover 99%, not dead\"},\"source\":\"lib/global.ts\"}},\"scripts\":{\"contributors\":\"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\\\\"chore(contributors): update and sort contributors list\\\\\"\",\"check\":\"tsc --noEmit\",\"watch\":\"parcel watch\",\"build\":\"rm -rf dist && parcel build\",\"prepublishOnly\":\"npm run build\",\"test\":\"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts\",\"format\":\"prettier --write .\",\"semantic-release\":\"semantic-release\"},\"devDependencies\":{\"@parcel/config-default\":\"^2.5.0\",\"@parcel/packager-ts\":\"^2.5.0\",\"@parcel/transformer-typescript-tsc\":\"^2.5.0\",\"@parcel/transformer-typescript-types\":\"^2.5.0\",\"@semantic-release/changelog\":\"^6.0.1\",\"@semantic-release/git\":\"^10.0.1\",\"@types/chai\":\"^4.3.0\",\"@types/mocha\":\"^9.1.0\",\"@types/node\":\"^17.0.18\",\"chai\":\"^4.3.6\",\"git-authors-cli\":\"^1.0.40\",\"jsdom\":\"^19.0.0\",\"jsdom-global\":\"^3.0.2\",\"mocha\":\"^9.2.0\",\"mock-socket\":\"8.0.5\",\"parcel\":\"^2.5.0\",\"parcel-transformer-tsc-sourcemaps\":\"^1.0.2\",\"prettier\":\"^2.6.2\",\"semantic-release\":\"^19.0.2\",\"standard\":\"^16.0.4\",\"ts-node\":\"^10.5.0\",\"typescript\":\"^4.5.5\"},\"dependencies\":{\"@swc/helpers\":\"^0.3.13\",\"eventemitter3\":\"^4.0.7\",\"peerjs-js-binarypack\":\"1.0.1\",\"webrtc-adapter\":\"^7.7.1\"}}');var hc,mc=(hc=function(e,t){return(hc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Class extends value \"+String(t)+\" is not a constructor or null\");function n(){this.constructor=e}hc(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),gc=function(e){function t(t,n,r,o,i,a){void 0===a&&(a=5e3);var s=e.call(this)||this;s.pingInterval=a,s._disconnected=!0,s._messagesQueue=[];var c=t?\"wss://\":\"ws://\";return s._baseUrl=c+n+\":\"+r+o+\"peerjs?key=\"+i,s}return mc(t,e),t.prototype.start=function(e,t){var n=this;this._id=e;var r=\"\".concat(this._baseUrl,\"&id=\").concat(e,\"&token=\").concat(t);!this._socket&&this._disconnected&&(this._socket=new WebSocket(r+\"&version=\"+fc.version),this._disconnected=!1,this._socket.onmessage=function(e){var t;try{t=JSON.parse(e.data),ec.default.log(\"Server message received:\",t)}catch(t){return void ec.default.log(\"Invalid server message\",e.data)}n.emit(cc.Message,t)},this._socket.onclose=function(e){n._disconnected||(ec.default.log(\"Socket closed.\",e),n._cleanup(),n._disconnected=!0,n.emit(cc.Disconnected))},this._socket.onopen=function(){n._disconnected||(n._sendQueuedMessages(),ec.default.log(\"Socket open\"),n._scheduleHeartbeat())})},t.prototype._scheduleHeartbeat=function(){var e=this;this._wsPingTimer=setTimeout((function(){e._sendHeartbeat()}),this.pingInterval)},t.prototype._sendHeartbeat=function(){if(this._wsOpen()){var e=JSON.stringify({type:lc.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}else ec.default.log(\"Cannot send heartbeat, because socket closed\")},t.prototype._wsOpen=function(){return!!this._socket&&1===this._socket.readyState},t.prototype._sendQueuedMessages=function(){var e,t,n=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}([],function(e,t){var n=\"function\"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}(this._messagesQueue),!1);this._messagesQueue=[];try{for(var r=function(e){var t=\"function\"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&\"number\"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")}(n),o=r.next();!o.done;o=r.next()){var i=o.value;this.send(i)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},t.prototype.send=function(e){if(!this._disconnected)if(this._id)if(e.type){if(this._wsOpen()){var t=JSON.stringify(e);this._socket.send(t)}}else this.emit(cc.Error,\"Invalid message\");else this._messagesQueue.push(e)},t.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},t.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},t}(Js.EventEmitter),yc={};Fs(yc,\"MediaConnection\",(()=>Pc),(e=>Pc=e));var vc={};Fs(vc,\"Negotiator\",(()=>_c),(e=>_c=e));var bc=function(){return bc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},bc.apply(this,arguments)},wc=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},kc=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},\"function\"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError(\"Generator is already executing.\");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},_c=function(){function e(e){this.connection=e}return e.prototype.startConnection=function(e){var t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===ic.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){if(this.connection.type===ic.Data){var n=this.connection,r={ordered:!!e.reliable},o=t.createDataChannel(n.label,r);n.initialize(o)}this._makeOffer()}else this.handleSDP(\"OFFER\",e.sdp)},e.prototype._startPeerConnection=function(){ec.default.log(\"Creating RTCPeerConnection.\");var e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e},e.prototype._setupListeners=function(e){var t=this,n=this.connection.peer,r=this.connection.connectionId,o=this.connection.type,i=this.connection.provider;ec.default.log(\"Listening for ICE candidates.\"),e.onicecandidate=function(e){e.candidate&&e.candidate.candidate&&(ec.default.log(\"Received ICE candidates for \".concat(n,\":\"),e.candidate),i.socket.send({type:lc.Candidate,payload:{candidate:e.candidate,type:o,connectionId:r},dst:n}))},e.oniceconnectionstatechange=function(){switch(e.iceConnectionState){case\"failed\":ec.default.log(\"iceConnectionState is failed, closing connections to \"+n),t.connection.emit(\"error\",new Error(\"Negotiation of connection to \"+n+\" failed.\")),t.connection.close();break;case\"closed\":ec.default.log(\"iceConnectionState is closed, closing connections to \"+n),t.connection.emit(\"error\",new Error(\"Connection to \"+n+\" closed.\")),t.connection.close();break;case\"disconnected\":ec.default.log(\"iceConnectionState changed to disconnected on the connection with \"+n);break;case\"completed\":e.onicecandidate=Gs.noop}t.connection.emit(\"iceStateChanged\",e.iceConnectionState)},ec.default.log(\"Listening for data channel\"),e.ondatachannel=function(e){ec.default.log(\"Received data channel\");var t=e.channel;i.getConnection(n,r).initialize(t)},ec.default.log(\"Listening for remote stream\"),e.ontrack=function(e){ec.default.log(\"Received remote stream\");var o=e.streams[0],a=i.getConnection(n,r);if(a.type===ic.Media){var s=a;t._addStreamToMediaConnection(o,s)}}},e.prototype.cleanup=function(){ec.default.log(\"Cleaning up PeerConnection to \"+this.connection.peer);var e=this.connection.peerConnection;if(e){this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=function(){};var t=\"closed\"!==e.signalingState,n=!1;if(this.connection.type===ic.Data){var r=this.connection.dataChannel;r&&(n=!!r.readyState&&\"closed\"!==r.readyState)}(t||n)&&e.close()}},e.prototype._makeOffer=function(){return wc(this,void 0,Promise,(function(){var e,t,n,r,o,i,a;return kc(this,(function(s){switch(s.label){case 0:e=this.connection.peerConnection,t=this.connection.provider,s.label=1;case 1:return s.trys.push([1,7,,8]),[4,e.createOffer(this.connection.options.constraints)];case 2:n=s.sent(),ec.default.log(\"Created offer.\"),this.connection.options.sdpTransform&&\"function\"==typeof this.connection.options.sdpTransform&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp),s.label=3;case 3:return s.trys.push([3,5,,6]),[4,e.setLocalDescription(n)];case 4:return s.sent(),ec.default.log(\"Set localDescription:\",n,\"for:\".concat(this.connection.peer)),r={sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:Gs.browser},this.connection.type===ic.Data&&(o=this.connection,r=bc(bc({},r),{label:o.label,reliable:o.reliable,serialization:o.serialization})),t.socket.send({type:lc.Offer,payload:r,dst:this.connection.peer}),[3,6];case 5:return\"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer\"!=(i=s.sent())&&(t.emitError(ac.WebRTC,i),ec.default.log(\"Failed to setLocalDescription, \",i)),[3,6];case 6:return[3,8];case 7:return a=s.sent(),t.emitError(ac.WebRTC,a),ec.default.log(\"Failed to createOffer, \",a),[3,8];case 8:return[2]}}))}))},e.prototype._makeAnswer=function(){return wc(this,void 0,Promise,(function(){var e,t,n,r,o;return kc(this,(function(i){switch(i.label){case 0:e=this.connection.peerConnection,t=this.connection.provider,i.label=1;case 1:return i.trys.push([1,7,,8]),[4,e.createAnswer()];case 2:n=i.sent(),ec.default.log(\"Created answer.\"),this.connection.options.sdpTransform&&\"function\"==typeof this.connection.options.sdpTransform&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp),i.label=3;case 3:return i.trys.push([3,5,,6]),[4,e.setLocalDescription(n)];case 4:return i.sent(),ec.default.log(\"Set localDescription:\",n,\"for:\".concat(this.connection.peer)),t.socket.send({type:lc.Answer,payload:{sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,browser:Gs.browser},dst:this.connection.peer}),[3,6];case 5:return r=i.sent(),t.emitError(ac.WebRTC,r),ec.default.log(\"Failed to setLocalDescription, \",r),[3,6];case 6:return[3,8];case 7:return o=i.sent(),t.emitError(ac.WebRTC,o),ec.default.log(\"Failed to create answer, \",o),[3,8];case 8:return[2]}}))}))},e.prototype.handleSDP=function(e,t){return wc(this,void 0,Promise,(function(){var n,r,o,i;return kc(this,(function(a){switch(a.label){case 0:t=new RTCSessionDescription(t),n=this.connection.peerConnection,r=this.connection.provider,ec.default.log(\"Setting remote description\",t),o=this,a.label=1;case 1:return a.trys.push([1,5,,6]),[4,n.setRemoteDescription(t)];case 2:return a.sent(),ec.default.log(\"Set remoteDescription:\".concat(e,\" for:\").concat(this.connection.peer)),\"OFFER\"!==e?[3,4]:[4,o._makeAnswer()];case 3:a.sent(),a.label=4;case 4:return[3,6];case 5:return i=a.sent(),r.emitError(ac.WebRTC,i),ec.default.log(\"Failed to setRemoteDescription, \",i),[3,6];case 6:return[2]}}))}))},e.prototype.handleCandidate=function(e){return wc(this,void 0,Promise,(function(){var t,n,r,o,i,a;return kc(this,(function(s){switch(s.label){case 0:ec.default.log(\"handleCandidate:\",e),t=e.candidate,n=e.sdpMLineIndex,r=e.sdpMid,o=this.connection.peerConnection,i=this.connection.provider,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,o.addIceCandidate(new RTCIceCandidate({sdpMid:r,sdpMLineIndex:n,candidate:t}))];case 2:return s.sent(),ec.default.log(\"Added ICE candidate for:\".concat(this.connection.peer)),[3,4];case 3:return a=s.sent(),i.emitError(ac.WebRTC,a),ec.default.log(\"Failed to handleCandidate, \",a),[3,4];case 4:return[2]}}))}))},e.prototype._addTracksToConnection=function(e,t){if(ec.default.log(\"add tracks from stream \".concat(e.id,\" to peer connection\")),!t.addTrack)return ec.default.error(\"Your browser does't support RTCPeerConnection#addTrack. Ignored.\");e.getTracks().forEach((function(n){t.addTrack(n,e)}))},e.prototype._addStreamToMediaConnection=function(e,t){ec.default.log(\"add stream \".concat(e.id,\" to media connection \").concat(t.connectionId)),t.addStream(e)},e}(),Sc={};Fs(Sc,\"BaseConnection\",(()=>xc),(e=>xc=e));var Cc=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if(\"function\"!=typeof n&&null!==n)throw new TypeError(\"Class extends value \"+String(n)+\" is not a constructor or null\");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),xc=function(e){function t(t,n,r){var o=e.call(this)||this;return o.peer=t,o.provider=n,o.options=r,o._open=!1,o.metadata=r.metadata,o}return Cc(t,e),Object.defineProperty(t.prototype,\"open\",{get:function(){return this._open},enumerable:!1,configurable:!0}),t}(Js.EventEmitter),Tc=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if(\"function\"!=typeof n&&null!==n)throw new TypeError(\"Class extends value \"+String(n)+\" is not a constructor or null\");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ec=function(){return Ec=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Ec.apply(this,arguments)},Pc=function(e){function t(n,r,o){var i=e.call(this,n,r,o)||this;return i._localStream=i.options._stream,i.connectionId=i.options.connectionId||t.ID_PREFIX+Gs.randomToken(),i._negotiator=new vc.Negotiator(i),i._localStream&&i._negotiator.startConnection({_stream:i._localStream,originator:!0}),i}return Tc(t,e),Object.defineProperty(t.prototype,\"type\",{get:function(){return ic.Media},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"localStream\",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"remoteStream\",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),t.prototype.addStream=function(t){ec.default.log(\"Receiving stream\",t),this._remoteStream=t,e.prototype.emit.call(this,\"stream\",t)},t.prototype.handleMessage=function(e){var t=e.type,n=e.payload;switch(e.type){case lc.Answer:this._negotiator.handleSDP(t,n.sdp),this._open=!0;break;case lc.Candidate:this._negotiator.handleCandidate(n.candidate);break;default:ec.default.warn(\"Unrecognized message type:\".concat(t,\" from peer:\").concat(this.peer))}},t.prototype.answer=function(e,t){var n,r;if(void 0===t&&(t={}),this._localStream)ec.default.warn(\"Local stream already exists on this MediaConnection. Are you answering a call twice?\");else{this._localStream=e,t&&t.sdpTransform&&(this.options.sdpTransform=t.sdpTransform),this._negotiator.startConnection(Ec(Ec({},this.options._payload),{_stream:e}));var o=this.provider._getMessages(this.connectionId);try{for(var i=function(e){var t=\"function\"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&\"number\"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")}(o),a=i.next();!a.done;a=i.next()){var s=a.value;this.handleMessage(s)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}this._open=!0}},t.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,e.prototype.emit.call(this,\"close\"))},t.ID_PREFIX=\"mc_\",t}(Sc.BaseConnection),Rc={};Fs(Rc,\"DataConnection\",(()=>Ac),(e=>Ac=e));var Oc={};Fs(Oc,\"EncodingQueue\",(()=>Dc),(e=>Dc=e));var jc=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if(\"function\"!=typeof n&&null!==n)throw new TypeError(\"Class extends value \"+String(n)+\" is not a constructor or null\");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Dc=function(e){function t(){var t=e.call(this)||this;return t.fileReader=new FileReader,t._queue=[],t._processing=!1,t.fileReader.onload=function(e){t._processing=!1,e.target&&t.emit(\"done\",e.target.result),t.doNextTask()},t.fileReader.onerror=function(e){ec.default.error(\"EncodingQueue error:\",e),t._processing=!1,t.destroy(),t.emit(\"error\",e)},t}return jc(t,e),Object.defineProperty(t.prototype,\"queue\",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"size\",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"processing\",{get:function(){return this._processing},enumerable:!1,configurable:!0}),t.prototype.enque=function(e){this.queue.push(e),this.processing||this.doNextTask()},t.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},t.prototype.doNextTask=function(){0!==this.size&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},t}(Js.EventEmitter),Ic=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if(\"function\"!=typeof n&&null!==n)throw new TypeError(\"Class extends value \"+String(n)+\" is not a constructor or null\");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ac=function(e){function t(n,r,o){var i=e.call(this,n,r,o)||this;return i.stringify=JSON.stringify,i.parse=JSON.parse,i._buffer=[],i._bufferSize=0,i._buffering=!1,i._chunkedData={},i._encodingQueue=new Oc.EncodingQueue,i.connectionId=i.options.connectionId||t.ID_PREFIX+Gs.randomToken(),i.label=i.options.label||i.connectionId,i.serialization=i.options.serialization||sc.Binary,i.reliable=!!i.options.reliable,i._encodingQueue.on(\"done\",(function(e){i._bufferedSend(e)})),i._encodingQueue.on(\"error\",(function(){ec.default.error(\"DC#\".concat(i.connectionId,\": Error occured in encoding from blob to arraybuffer, close DC\")),i.close()})),i._negotiator=new vc.Negotiator(i),i._negotiator.startConnection(i.options._payload||{originator:!0}),i}return Ic(t,e),Object.defineProperty(t.prototype,\"type\",{get:function(){return ic.Data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"dataChannel\",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"bufferSize\",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){this._dc=e,this._configureDataChannel()},t.prototype._configureDataChannel=function(){var e=this;Gs.supports.binaryBlob&&!Gs.supports.reliable||(this.dataChannel.binaryType=\"arraybuffer\"),this.dataChannel.onopen=function(){ec.default.log(\"DC#\".concat(e.connectionId,\" dc connection success\")),e._open=!0,e.emit(\"open\")},this.dataChannel.onmessage=function(t){ec.default.log(\"DC#\".concat(e.connectionId,\" dc onmessage:\"),t.data),e._handleDataMessage(t)},this.dataChannel.onclose=function(){ec.default.log(\"DC#\".concat(e.connectionId,\" dc closed for:\"),e.peer),e.close()}},t.prototype._handleDataMessage=function(t){var n=this,r=t.data,o=r.constructor,i=r;if(this.serialization===sc.Binary||this.serialization===sc.BinaryUTF8){if(o===Blob)return void Gs.blobToArrayBuffer(r,(function(e){var t=Gs.unpack(e);n.emit(\"data\",t)}));if(o===ArrayBuffer)i=Gs.unpack(r);else if(o===String){var a=Gs.binaryStringToArrayBuffer(r);i=Gs.unpack(a)}}else this.serialization===sc.JSON&&(i=this.parse(r));i.__peerData?this._handleChunk(i):e.prototype.emit.call(this,\"data\",i)},t.prototype._handleChunk=function(e){var t=e.__peerData,n=this._chunkedData[t]||{data:[],count:0,total:e.total};if(n.data[e.n]=e.data,n.count++,this._chunkedData[t]=n,n.total===n.count){delete this._chunkedData[t];var r=new Blob(n.data);this._handleDataMessage({data:r})}},t.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,e.prototype.emit.call(this,\"close\"))},t.prototype.send=function(t,n){if(this.open)if(this.serialization===sc.JSON)this._bufferedSend(this.stringify(t));else if(this.serialization===sc.Binary||this.serialization===sc.BinaryUTF8){var r=Gs.pack(t);if(!n&&r.size>Gs.chunkedMTU)return void this._sendChunks(r);Gs.supports.binaryBlob?this._bufferedSend(r):this._encodingQueue.enque(r)}else this._bufferedSend(t);else e.prototype.emit.call(this,\"error\",new Error(\"Connection is not open. You should listen for the `open` event before sending messages.\"))},t.prototype._bufferedSend=function(e){!this._buffering&&this._trySend(e)||(this._buffer.push(e),this._bufferSize=this._buffer.length)},t.prototype._trySend=function(e){var n=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>t.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout((function(){n._buffering=!1,n._tryBuffer()}),50),!1;try{this.dataChannel.send(e)}catch(e){return ec.default.error(\"DC#:\".concat(this.connectionId,\" Error when sending:\"),e),this._buffering=!0,this.close(),!1}return!0},t.prototype._tryBuffer=function(){if(this.open&&0!==this._buffer.length){var e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},t.prototype._sendChunks=function(e){var t,n,r=Gs.chunk(e);ec.default.log(\"DC#\".concat(this.connectionId,\" Try to send \").concat(r.length,\" chunks...\"));try{for(var o=function(e){var t=\"function\"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&\"number\"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")}(r),i=o.next();!i.done;i=o.next()){var a=i.value;this.send(a,!0)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},t.prototype.handleMessage=function(e){var t=e.payload;switch(e.type){case lc.Answer:this._negotiator.handleSDP(e.type,t.sdp);break;case lc.Candidate:this._negotiator.handleCandidate(t.candidate);break;default:ec.default.warn(\"Unrecognized message type:\",e.type,\"from peer:\",this.peer)}},t.ID_PREFIX=\"dc_\",t.MAX_BUFFERED_AMOUNT=8388608,t}(Sc.BaseConnection),Mc={};Fs(Mc,\"API\",(()=>Bc),(e=>Bc=e));var Lc=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},zc=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},\"function\"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError(\"Generator is already executing.\");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Bc=function(){function e(e){this._options=e}return e.prototype._buildRequest=function(e){var t=this._options.secure?\"https\":\"http\",n=this._options,r=n.host,o=n.port,i=n.path,a=n.key,s=new URL(\"\".concat(t,\"://\").concat(r,\":\").concat(o).concat(i).concat(a,\"/\").concat(e));return s.searchParams.set(\"ts\",\"\".concat(Date.now()).concat(Math.random())),s.searchParams.set(\"version\",fc.version),fetch(s.href,{referrerPolicy:this._options.referrerPolicy})},e.prototype.retrieveId=function(){return Lc(this,void 0,Promise,(function(){var e,t,n;return zc(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this._buildRequest(\"id\")];case 1:if(200!==(e=r.sent()).status)throw new Error(\"Error. Status:\".concat(e.status));return[2,e.text()];case 2:throw t=r.sent(),ec.default.error(\"Error retrieving ID\",t),n=\"\",\"/\"===this._options.path&&this._options.host!==Gs.CLOUD_HOST&&(n=\" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer.\"),new Error(\"Could not get an ID from the server.\"+n);case 3:return[2]}}))}))},e.prototype.listAllPeers=function(){return Lc(this,void 0,Promise,(function(){var e,t,n;return zc(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this._buildRequest(\"peers\")];case 1:if(200!==(e=r.sent()).status){if(401===e.status)throw t=\"\",t=this._options.host===Gs.CLOUD_HOST?\"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.\":\"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.\",new Error(\"It doesn't look like you have permission to list peers IDs. \"+t);throw new Error(\"Error. Status:\".concat(e.status))}return[2,e.json()];case 2:throw n=r.sent(),ec.default.error(\"Error retrieving list peers\",n),new Error(\"Could not get list peers from the server.\"+n);case 3:return[2]}}))}))},e}(),Nc=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if(\"function\"!=typeof n&&null!==n)throw new TypeError(\"Class extends value \"+String(n)+\" is not a constructor or null\");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Fc=function(){return Fc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Fc.apply(this,arguments)},Uc=function(e){var t=\"function\"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&\"number\"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")},$c=function(e,t){var n=\"function\"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},qc=function(e){function t(n,r){var o,i=e.call(this)||this;return i._id=null,i._lastServerId=null,i._destroyed=!1,i._disconnected=!1,i._open=!1,i._connections=new Map,i._lostMessages=new Map,n&&n.constructor==Object?r=n:n&&(o=n.toString()),r=Fc({debug:0,host:Gs.CLOUD_HOST,port:Gs.CLOUD_PORT,path:\"/\",key:t.DEFAULT_KEY,token:Gs.randomToken(),config:Gs.defaultConfig,referrerPolicy:\"strict-origin-when-cross-origin\"},r),i._options=r,\"/\"===i._options.host&&(i._options.host=window.location.hostname),i._options.path&&(\"/\"!==i._options.path[0]&&(i._options.path=\"/\"+i._options.path),\"/\"!==i._options.path[i._options.path.length-1]&&(i._options.path+=\"/\")),void 0===i._options.secure&&i._options.host!==Gs.CLOUD_HOST?i._options.secure=Gs.isSecure():i._options.host==Gs.CLOUD_HOST&&(i._options.secure=!0),i._options.logFunction&&ec.default.setLogFunction(i._options.logFunction),ec.default.logLevel=i._options.debug||0,i._api=new Mc.API(r),i._socket=i._createServerConnection(),Gs.supports.audioVideo||Gs.supports.data?o&&!Gs.validateId(o)?(i._delayedAbort(ac.InvalidID,'ID \"'.concat(o,'\" is invalid')),i):(o?i._initialize(o):i._api.retrieveId().then((function(e){return i._initialize(e)})).catch((function(e){return i._abort(ac.ServerError,e)})),i):(i._delayedAbort(ac.BrowserIncompatible,\"The current browser does not support WebRTC\"),i)}return Nc(t,e),Object.defineProperty(t.prototype,\"id\",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"options\",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"open\",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"socket\",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"connections\",{get:function(){var e,t,n=Object.create(null);try{for(var r=Uc(this._connections),o=r.next();!o.done;o=r.next()){var i=$c(o.value,2),a=i[0],s=i[1];n[a]=s}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"destroyed\",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"disconnected\",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),t.prototype._createServerConnection=function(){var e=this,t=new dc.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return t.on(cc.Message,(function(t){e._handleMessage(t)})),t.on(cc.Error,(function(t){e._abort(ac.SocketError,t)})),t.on(cc.Disconnected,(function(){e.disconnected||(e.emitError(ac.Network,\"Lost connection to server.\"),e.disconnect())})),t.on(cc.Close,(function(){e.disconnected||e._abort(ac.SocketClosed,\"Underlying socket is already closed.\")})),t},t.prototype._initialize=function(e){this._id=e,this.socket.start(e,this._options.token)},t.prototype._handleMessage=function(e){var t,n,r=e.type,o=e.payload,i=e.src;switch(r){case lc.Open:this._lastServerId=this.id,this._open=!0,this.emit(\"open\",this.id);break;case lc.Error:this._abort(ac.ServerError,o.msg);break;case lc.IdTaken:this._abort(ac.UnavailableID,'ID \"'.concat(this.id,'\" is taken'));break;case lc.InvalidKey:this._abort(ac.InvalidKey,'API KEY \"'.concat(this._options.key,'\" is invalid'));break;case lc.Leave:ec.default.log(\"Received leave message from \".concat(i)),this._cleanupPeer(i),this._connections.delete(i);break;case lc.Expire:this.emitError(ac.PeerUnavailable,\"Could not connect to peer \".concat(i));break;case lc.Offer:var a=o.connectionId;if((f=this.getConnection(i,a))&&(f.close(),ec.default.warn(\"Offer received for existing Connection ID:\".concat(a))),o.type===ic.Media){var s=new yc.MediaConnection(i,this,{connectionId:a,_payload:o,metadata:o.metadata});f=s,this._addConnection(i,f),this.emit(\"call\",s)}else{if(o.type!==ic.Data)return void ec.default.warn(\"Received malformed connection type:\".concat(o.type));var c=new Rc.DataConnection(i,this,{connectionId:a,_payload:o,metadata:o.metadata,label:o.label,serialization:o.serialization,reliable:o.reliable});f=c,this._addConnection(i,f),this.emit(\"connection\",c)}var l=this._getMessages(a);try{for(var u=Uc(l),p=u.next();!p.done;p=u.next()){var d=p.value;f.handleMessage(d)}}catch(e){t={error:e}}finally{try{p&&!p.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}break;default:if(!o)return void ec.default.warn(\"You received a malformed message from \".concat(i,\" of type \").concat(r));var f;a=o.connectionId;(f=this.getConnection(i,a))&&f.peerConnection?f.handleMessage(e):a?this._storeMessage(a,e):ec.default.warn(\"You received an unrecognized message:\",e)}},t.prototype._storeMessage=function(e,t){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(t)},t.prototype._getMessages=function(e){var t=this._lostMessages.get(e);return t?(this._lostMessages.delete(e),t):[]},t.prototype.connect=function(e,t){if(void 0===t&&(t={}),this.disconnected)return ec.default.warn(\"You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available.\"),void this.emitError(ac.Disconnected,\"Cannot connect to new Peer after disconnecting from server.\");var n=new Rc.DataConnection(e,this,t);return this._addConnection(e,n),n},t.prototype.call=function(e,t,n){if(void 0===n&&(n={}),this.disconnected)return ec.default.warn(\"You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect.\"),void this.emitError(ac.Disconnected,\"Cannot connect to new Peer after disconnecting from server.\");if(t){var r=new yc.MediaConnection(e,this,Fc(Fc({},n),{_stream:t}));return this._addConnection(e,r),r}ec.default.error(\"To call a peer, you must provide a stream from your browser's `getUserMedia`.\")},t.prototype._addConnection=function(e,t){ec.default.log(\"add connection \".concat(t.type,\":\").concat(t.connectionId,\" to peerId:\").concat(e)),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(t)},t.prototype._removeConnection=function(e){var t=this._connections.get(e.peer);if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}this._lostMessages.delete(e.connectionId)},t.prototype.getConnection=function(e,t){var n,r,o=this._connections.get(e);if(!o)return null;try{for(var i=Uc(o),a=i.next();!a.done;a=i.next()){var s=a.value;if(s.connectionId===t)return s}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return null},t.prototype._delayedAbort=function(e,t){var n=this;setTimeout((function(){n._abort(e,t)}),0)},t.prototype._abort=function(e,t){ec.default.error(\"Aborting!\"),this.emitError(e,t),this._lastServerId?this.disconnect():this.destroy()},t.prototype.emitError=function(e,t){var n;ec.default.error(\"Error:\",t),(n=\"string\"==typeof t?new Error(t):t).type=e,this.emit(\"error\",n)},t.prototype.destroy=function(){this.destroyed||(ec.default.log(\"Destroy peer with ID:\".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit(\"close\"))},t.prototype._cleanup=function(){var e,t;try{for(var n=Uc(this._connections.keys()),r=n.next();!r.done;r=n.next()){var o=r.value;this._cleanupPeer(o),this._connections.delete(o)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.socket.removeAllListeners()},t.prototype._cleanupPeer=function(e){var t,n,r=this._connections.get(e);if(r)try{for(var o=Uc(r),i=o.next();!i.done;i=o.next()){i.value.close()}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},t.prototype.disconnect=function(){if(!this.disconnected){var e=this.id;ec.default.log(\"Disconnect peer with ID:\".concat(e)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit(\"disconnected\",e)}},t.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)ec.default.log(\"Attempting reconnection to server with ID \".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error(\"This peer cannot reconnect to the server. It has already been destroyed.\");if(this.disconnected||this.open)throw new Error(\"Peer \".concat(this.id,\" cannot reconnect because it is not disconnected from the server!\"));ec.default.error(\"In a hurry? We're still trying to make the initial connection!\")}},t.prototype.listAllPeers=function(e){var t=this;void 0===e&&(e=function(e){}),this._api.listAllPeers().then((function(t){return e(t)})).catch((function(e){return t._abort(ac.ServerError,e)}))},t.DEFAULT_KEY=\"peerjs\",t}(Js.EventEmitter),Gc=Et(\"multiplayer\").log;var Vc,Jc,Hc={get id(){return document.getElementById(\"session-id\")&&document.getElementById(\"session-id\").value},set id(e){document.getElementById(\"session-id\").value=e}};function Wc(e){document.getElementById(\"connection-status\").innerHTML=e}function Zc(e){e.on(\"data\",(function(e){Yc(e.name)&&(Gc(\"Syncing FROM another client...\"),Gc(\"name: \".concat(e.name,\", previous: \").concat(e.previous,\", value: \").concat(e.value)),Qt(e.name,e.value,!0))})),e.on(\"open\",(function(){Wc(\"Connected\"),Ze.on(\"state-change\",(function(t){var n=t.name,r=t.previous,o=t.value;!t.isFromPeers&&Yc(n)&&(Gc(\"Syncing TO other clients...\"),Gc(\"name: \".concat(n,\", previous: \").concat(r,\", value: \").concat(o)),e.send({name:n,previous:r,value:o}))}))})),e.on(\"error\",(function(e){Gc(\"peer connection error: connection issue\"),console.error(e),Wc(\"Error\")}))}function Yc(e){return\"$\"===e.charAt(0)}Dt(document.querySelector(\"tw-storydata\")),window.engine={extend:function(e,t){var n=nn(\"engine.version\"),r=ci(e),o=ci(n);o[0]<r[0]?si(\"The current engine version (\".concat(n,\") has a lower major version than requested (\").concat(e,\"); skipping\")):(o[0]>r[0]?si(\"The current engine version (\".concat(n,\") has a higher major version than requested (\").concat(e,\"); running code but you may encounter problems\")):(o[1]<r[1]&&si(\"The current engine version (\".concat(n,\") has a lower minor version than requested (\").concat(e,\"); running code but you may encounter problems\")),o[1]===r[1]&&o[2]<r[2]&&si(\"The current engine version (\".concat(n,\") has a lower patch version than requested (\").concat(e,\"); running code but you may encounter problems\"))),t())},event:Ze,log:xt,render:ai,state:pn,story:$t,warn:Tt},Yt(),Object.assign(window,{go:fn,restart:hn}),Fi.dataset.cbGoogleFontLoader=\"\",Fi.setAttribute(\"hidden\",!0),Ui.dataset.cbTypekitFontLoader=\"\",Ui.setAttribute(\"hidden\",!0),$i.dataset.cbUrlFontLoader=\"\",$i.setAttribute(\"hidden\",!0),document.body.appendChild(Fi),document.body.appendChild(Ui),document.body.appendChild($i),Ze.on(\"state-change\",(function(e){var t=e.name;if(\"config\"===t||\"config.style\"===t||\"config.style.fonts\"===t){var n=nn(\"config.style.fonts\");if(!n)return;Object.keys(n).forEach((function(e){var t=n[e].name,r=n[e].url;t&&r&&Gi(e,r,t)}))}else{var r=t.match(/^config\\.style\\.fonts\\.([^.]+)/i);if(r){var o=r[1],i=nn(\"config.style.fonts.\".concat(o,\".name\")),a=nn(\"config.style.fonts.\".concat(o,\".url\"));return void(a&&i&&(Ni(\"Adding font from URL (\".concat(i,\")\")),Gi(o,a,i)))}}Xt(t,\"config.style.googleFont\")&&(Ni(\"Adding Google font\"),Fi.innerHTML=nn(\"config.style.googleFont\")),Xt(t,\"config.style.typekitFont\")&&(Ni(\"Adding Typekit font\"),Ui.innerHTML=nn(\"config.style.typekitFont\"))})),ga.dataset.cbAuthorStyles=\"\",document.head.appendChild(ga),Ze.on(\"state-change\",(function(e){var t=e.name,n=e.value;if(Xt(t,\"config.style.backdrop\")&&(fa(\"Setting backdrop color\"),ya(\"#backdrop\",{\"background-color\":da(nn(\"config.style.backdrop\")).color})),Xt(t,\"config.style.page.fork.divider.color\")&&(fa(\"Setting fork divider color\"),ya(\"#page .fork p a + a\",{\"border-top-color\":da(nn(\"config.style.page.fork.divider.color\")).color})),Xt(t,\"config.style.page.fork.divider.size\")&&(fa(\"Setting fork divider size\"),ya(\"#page .fork p a + a\",{\"border-top-width\":\"\".concat(nn(\"config.style.page.fork.divider.size\"),\"px\")})),Xt(t,\"config.style.page.fork.divider.style\")&&(fa(\"Setting fork divider style\"),ya(\"#page .fork p a + a\",{\"border-top-style\":nn(\"config.style.page.fork.divider.style\")})),Xt(t,\"config.style.page.style\")||Xt(t,\"config.style.page.style.borderColor\"))switch(fa(\"Setting page style\"),nn(\"config.style.page.style\")){case\"none\":ya(\"#page\",{border:\"none\",\"box-shadow\":\"none\"});break;case\"shadow\":ya(\"#page\",{border:\"none\",\"box-shadow\":\"0 4px 8px hsla(0, 0%, 0%, 0.25)\"});break;case\"thick-line\":ya(\"#page\",{border:\"4px solid \".concat(da(nn(\"config.style.page.style.borderColor\")).color),\"box-shadow\":\"none\"});break;case\"thin-line\":ya(\"#page\",{border:\"1px solid \".concat(da(nn(\"config.style.page.style.borderColor\")).color),\"box-shadow\":\"none\"})}if(Xt(t,\"config.style.page.verticalAlign\"))switch(fa(\"Setting page vertical alignment\"),nn(\"config.style.page.verticalAlign\")){case\"top\":ya(\"#page article\",{\"align-items\":\"flex-start\"});break;case\"center\":ya(\"#page article\",{\"align-items\":\"center\"});break;case\"bottom\":ya(\"#page article\",{\"align-items\":\"flex-end\"})}/^config\\.style\\.page\\..*\\.((line)?color|font)$/i.test(t)&&va(t,n),Xt(t,\"config.style.page\")&&[\"config.style.page\",\"config.style.page.header\",\"config.style.page.footer\"].forEach((function(e){var t=nn(e);t&&function(e,t){[\"color\",\"font\",\"lineColor\"].forEach((function(n){t[n]&&va(\"\".concat(e,\".\").concat(n),t[n]),t.link&&(t.link[n]&&va(\"\".concat(e,\".link.\").concat(n),t.link[n]),t.link.active&&t.link.active[n]&&va(\"\".concat(e,\".link.active.\").concat(n),t.link.active[n]))}))}(e,t)}))})),[Yn,St,zi,mi,Ht,ha,ii].forEach((function(e){return Object.keys(e).forEach((function(t){\"function\"==typeof e[t]?en(t,e[t]()):en(t,e[t])}))})),function(e){e(\"browser.height\",(function(){return window.innerHeight})),e(\"browser.online\",(function(){return window.navigator.onLine})),e(\"browser.width\",(function(){return window.innerWidth}))}(tn),function(e){e(\"engine.version\",(function(){return ki}))}(tn),function(e){e(\"now.second\",(function(){return(new Date).getSeconds()})),e(\"now.minute\",(function(){return(new Date).getMinutes()})),e(\"now.hour\",(function(){return(new Date).getHours()})),e(\"now.day\",(function(){return(new Date).getDate()})),e(\"now.weekday\",(function(){return(new Date).getDay()+1})),e(\"now.weekdayName\",(function(){return(new Date).toLocaleString(navigator.language,{weekday:\"long\"})})),e(\"now.month\",(function(){return(new Date).getMonth()+1})),e(\"now.monthName\",(function(){return(new Date).toLocaleString(navigator.language,{month:\"long\"})})),e(\"now.year\",(function(){return(new Date).getFullYear()})),e(\"now.timestamp\",(function(){return(new Date).toLocaleString(navigator.language,{hour:\"numeric\",minute:\"numeric\",second:\"numeric\"})}))}(tn),function(e){e(\"passage.name\",(function(){var e=nn(\"trail\");if(e)return e[e.length-1]})),e(\"passage.visits\",(function(){var e=nn(\"trail\"),t=nn(\"passage.name\");if(e)return e.reduce((function(e,n){return n===t?e+1:e}),0)}))}(tn),function(e){e(\"random.coinFlip\",(function(){return Bi()>.5})),e(\"random.fraction\",(function(){return Bi()})),[4,5,6,8,10,12,20,25,50,100,1e3].forEach((function(t){e(\"random.d\".concat(t),(function(){return 1+Math.round(Bi()*(t-1))}))}))}(tn),function(e){e(\"story.name\",zt)}(tn),window.addEventListener(\"error\",jn),window.addEventListener(\"unhandledrejection\",(function(e){return jn(e.reason)})),Vc=window.console.warn,Jc=document.querySelector(\"#page .warnings\"),console.warn=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(nn(\"config.testing\"))try{Jc.removeAttribute(\"hidden\"),t.forEach((function(e){var t=document.createElement(\"li\");t.className=\"warning\",t.innerHTML=\"Warning: \".concat(Wn(e)),Jc.appendChild(t)}))}catch(e){}Vc.apply(window.console,t)},Ze.on(\"state-change\",(function(e){\"trail\"===e.name&&(Jc.setAttribute(\"hidden\",\"\"),Jc.innerHTML=\"\")})),Vn=document.querySelector(\"#page article\"),Hn=document.querySelector(\"#page #spinner\"),Jn={},[\"header\",\"footer\"].forEach((function(e){Jn[e]={container:document.querySelector(\"#page \".concat(e))},[\"left\",\"center\",\"right\"].forEach((function(t){Jn[e][t]=document.querySelector(\"#page \".concat(e,\" .\").concat(t))}))})),Ze.on(\"state-change\",(function(e){var t=e.name;return tr(\"trail\"===t)})),[\"change\",\"click\"].forEach((function(e){document.body.addEventListener(e,(function(e){for(var t=e.target;t;)t.dataset&&Object.keys(t.dataset).some((function(e){return/^cb[A-Z]/.test(e)}))&&Ze.emit(\"dom-\".concat(e.type),t),t=t.parentNode}))})),(ui=document.createElement(\"div\")).setAttribute(\"hidden\",!0),ui.dataset.cbSounds=\"\",document.body.appendChild(ui),Ze.on(\"state-change\",(function(e){var t=e.name,n=e.value,r=Xt(t,\"sound.ambient\"),o=Xt(t,\"sound.effect\");if(r){var i=nn(\"sound.ambient\");i&&Object.keys(i).forEach((function(e){i[e].url&&gi(e,i[e].url,!1),i[e].volume&&bi(e,i[e].volume),void 0!==i[e].muted&&wi(e,i[e].muted),i[e].playing&&yi(e,!0).catch((function(t){return fi('Could not resume playing ambient sound \"'.concat(e,'\" (').concat(t.message,\")\"))}))}))}if(o){var a=nn(\"sound.effect\");a&&Object.keys(a).forEach((function(e){a[e].url&&gi(e,a[e].url,!0),a[e].volume&&bi(e,a[e].volume),void 0!==a[e].muted&&wi(e,a[e].muted),a[e].playing&&yi(e,!1).then((function(){return Qt(\"sound.effect.\".concat(e,\".playing\"),!1)})).catch((function(t){return fi('Could not resume playing sound effect \"'.concat(e,'\" (').concat(t.message))}))}))}if(!r&&!o){var s=/^sound\\.(ambient|effect)\\.(.+?)\\.(.+)$/i.exec(t);if(s)switch(s[3].toLowerCase()){case\"playing\":n?\"ambient\"===s[1]?yi(s[2],!0,kn(nn(\"\".concat(s[2],\".transitionDuration\"))||nn(\"sound.transitionDuration\")||\"0s\",\"ms\")):yi(s[2],!1).then((function(){return Qt(t,!1)})):\"ambient\"===s[1]?vi(s[2],kn(nn(\"\".concat(s[2],\".transitionDuration\"))||nn(\"sound.transitionDuration\")||\"0s\",\"ms\")):vi(s[2]);break;case\"url\":gi(s[2],n,\"effect\"===s[1]);break;case\"volume\":bi(s[2],n)}}})),It(),document.addEventListener(\"DOMContentLoaded\",(function(){Hc.id=\"\",document.getElementById(\"host-game\").addEventListener(\"click\",(function(){Hc.id=\"\",function(){Wc(\"Connecting...\");var e=new qc;e.on(\"error\",(function(e){Gc(\"peer connection error: host\"),console.error(e),Wc(\"Error\")})),e.on(\"open\",(function(e){Hc.id=e,Wc(\"Connected\")})),e.on(\"connection\",(function(e){Zc(e)}))}()})),document.getElementById(\"join-game\").addEventListener(\"click\",(function(){var e=Hc.id;e?function(e){Wc(\"Connecting...\");var t=new qc;t.on(\"error\",(function(e){Gc(\"peer connection error: join\"),console.error(e),Wc(\"Error\")})),t.on(\"open\",(function(n){Zc(t.connect(e))}))}(e):(Gc(\"Failed to join session due to missing session id\"),Wc(\"Error\"))}))})),n&&nn(\"config.testing\")&&n.init(),!nn(\"config.testing\")&&cn()&&ln(),Mt(),At()}(backstage);\n</script></body></html>","author":"Chris Klimas","description":"1.2.2","hydrate":"!function(e){\"use strict\";function t(e){return e&&\"object\"==typeof e&&\"default\"in e?e:{default:e}}var n=t(e);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i=a(a({},function(e){return Object.keys(e).reduce((function(t,n){return a(a({},t),{},r({},n,(function(t){var o=e[n],a=o.matcher,r=o.wrapper;t.replaceSelections(t.getSelections().map((function(e){return a.test(e)?e.replace(a,\"$1\"):r(e)})),\"around\"),t.focus()})))}),{})}({boldText:{matcher:/^(?:__|\\*\\*)(.+)(?:__|\\*\\*)$/,wrapper:function(e){return\"**\".concat(e,\"**\")}},italicText:{matcher:/^(?:_|\\*)(.+)(?:_|\\*)$/,wrapper:function(e){return\"*\".concat(e,\"*\")}},monospacedText:{matcher:/^`(.+)`$/,wrapper:function(e){return\"`\"+e+\"`\"}},smallCapsText:{matcher:/^~~(.+)~~$/,wrapper:function(e){return\"~~\".concat(e,\"~~\")}}})),function(e){return Object.keys(e).reduce((function(t,n){return a(a({},t),{},r({},n,(function(t){t.replaceSelection(e[n]),t.focus()})))}),{})}({insertAfter:\"\\n[after 1 second]\\nText\\n\\n[continued]\",insertAppend:\"\\n[append]\\n\",insertBlockquote:\"\\n<blockquote>Text</blockquote>\\n\",insertContinue:\"\\n[continued]\\n\",insertBulletedList:\"\\n- Item\\n- Item\\n\",insertCss:\"\\n[CSS]\\n.page article {\\n  color: green;\\n}\\n\\n[continued]\\n\",insertCyclingLink:\"{cycling link for: 'variable name', choices: ['choice', 'choice']}\",insertDropdownMenu:\"{dropdown menu for: 'variable name', choices: ['choice', 'choice']}\",insertEmbedAmbientSound:\"{ambient sound: 'sound name'}\",insertEmbedSoundEffect:\"{sound effect: 'sound name'}\",insertEmbedPassage:\"{embed passage: 'Passage name'}\",insertEmbedYouTubeVideo:\"{embed YouTube video: 'URL'}\",insertImageFlickr:\"{embed Flickr image: 'Flickr embed code'}\",insertImageUrl:\"{embed image: 'URL to image'}\",insertImageUnsplash:\"{embed Unsplash image: }\",insertForkList:\"\\n> Link\\n> Link\\n\",insertIf:\"\\n[if condition]\\nText\\n\\n[continue]\\n\",insertIfElse:\"\\n[if condition]\\nText\\n\\n[else]Text\\n\\n[continued]\\n\",insertJs:\"\\n[JavaScript]\\nwrite('Hello from JavaScript');\\n\\n[continued]\\n\",insertNote:\"\\n[note]\\nNote to self\\n\\n[continued]\\n\",insertNumberedList:\"\\n1. Item\\n2. Item\\n\",insertPassageLink:\"{link to: 'Passage name', label: 'Label text'}\",insertRestartLink:\"{restart link, label: 'Label text'}\",insertRevealPassageLink:\"{restart link: 'Label text', passage: 'Passage name'}\",insertRevealTextLink:\"{restart link: 'Label text', text: 'Displayed text'}\",insertSectionBreak:\"\\n***\\n\",insertTextInput:\"{text input for: 'variable name', choices: ['choice', 'choice']}\",insertUnless:\"\\n[unless condition]\\nText\\n\\n[continued]\\n\"})),s=\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' class='icon icon-tabler icon-tabler-brackets' width='24' height='24' viewBox='0 0 24 24' stroke-width='2' stroke='currentColor' fill='none' stroke-linecap='round' stroke-linejoin='round'%3e %3cpath stroke='none' d='M0 0h24v24H0z' fill='none'/%3e %3cpath d='M8 4h-3v16h3' /%3e %3cpath d='M16 4h3v16h-3' /%3e%3c/svg%3e\",l=\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' class='icon icon-tabler icon-tabler-brush' width='24' height='24' viewBox='0 0 24 24' stroke-width='2' stroke='currentColor' fill='none' stroke-linecap='round' stroke-linejoin='round'%3e %3cpath stroke='none' d='M0 0h24v24H0z' fill='none'/%3e %3cpath d='M3 21v-4a4 4 0 1 1 4 4h-4' /%3e %3cpath d='M21 3a16 16 0 0 0 -12.8 10.2' /%3e %3cpath d='M21 3a16 16 0 0 1 -10.2 12.8' /%3e %3cpath d='M10.6 9a9 9 0 0 1 4.4 4.4' /%3e%3c/svg%3e\",c=\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' class='icon icon-tabler icon-tabler-frame' width='24' height='24' viewBox='0 0 24 24' stroke-width='2' stroke='currentColor' fill='none' stroke-linecap='round' stroke-linejoin='round'%3e %3cpath stroke='none' d='M0 0h24v24H0z' fill='none'/%3e %3cline x1='4' y1='7' x2='20' y2='7' /%3e %3cline x1='4' y1='17' x2='20' y2='17' /%3e %3cline x1='7' y1='4' x2='7' y2='20' /%3e %3cline x1='17' y1='4' x2='17' y2='20' /%3e%3c/svg%3e\",d=\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' class='icon icon-tabler icon-tabler-hand-click' width='24' height='24' viewBox='0 0 24 24' stroke-width='2' stroke='currentColor' fill='none' stroke-linecap='round' stroke-linejoin='round'%3e %3cpath stroke='none' d='M0 0h24v24H0z' fill='none'/%3e %3cpath d='M8 13v-8.5a1.5 1.5 0 0 1 3 0v7.5' /%3e %3cpath d='M11 11.5v-2a1.5 1.5 0 0 1 3 0v2.5' /%3e %3cpath d='M14 10.5a1.5 1.5 0 0 1 3 0v1.5' /%3e %3cpath d='M17 11.5a1.5 1.5 0 0 1 3 0v4.5a6 6 0 0 1 -6 6h-2h.208a6 6 0 0 1 -5.012 -2.7l-.196 -.3c-.312 -.479 -1.407 -2.388 -3.286 -5.728a1.5 1.5 0 0 1 .536 -2.022a1.867 1.867 0 0 1 2.28 .28l1.47 1.47' /%3e %3cpath d='M5 3l-1 -1' /%3e %3cpath d='M4 7h-1' /%3e %3cpath d='M14 3l1 -1' /%3e %3cpath d='M15 6h1' /%3e%3c/svg%3e\",u=\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' class='icon icon-tabler icon-tabler-link' width='24' height='24' viewBox='0 0 24 24' stroke-width='2' stroke='currentColor' fill='none' stroke-linecap='round' stroke-linejoin='round'%3e %3cpath stroke='none' d='M0 0h24v24H0z' fill='none'/%3e %3cpath d='M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5' /%3e %3cpath d='M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5' /%3e%3c/svg%3e\";var m={\"^2.4.0-beta2\":{codeMirror:{commands:i,mode:function(){return{startState:function(){return{inVarsSection:!1}},token:function(e,t){if(void 0===t.hasVarsSection){for(var n=1,o=e.lookAhead(1);o&&void 0===t.hasVarsSection;o=e.lookAhead(++n))\"--\"===o&&(t.hasVarsSection=!0,t.inVarsSection=!0);void 0===t.hasVarsSection&&(t.hasVarsSection=!1)}return t.hasVarsSection&&t.inVarsSection&&e.sol()?e.match(/^--$/)?(t.inVarsSection=!1,\"punctuation\"):(e.skipTo(\":\"),\"def\"):e.sol()&&e.match(/^\\[[^[].*\\]$/)||e.match(/^\\{.+?\\}/)?\"keyword\":e.match(/^\\[\\[[^\\]]+?\\]\\]/)?\"link\":(e.eatWhile(/[^[{]/)||e.skipToEnd(),\"text\")}}},toolbar:function(e,t){var n=e.getDoc().somethingSelected();return[{type:\"menu\",icon:l.replace(/currentColor/g,t.foregroundColor),label:\"Style\",items:[{type:\"button\",iconOnly:!0,label:\"Bold\",command:\"boldText\",disabled:!n},{type:\"button\",label:\"Italic\",command:\"italicText\",disabled:!n},{type:\"button\",label:\"Monospaced Text\",command:\"monospacedText\",disabled:!n},{type:\"button\",label:\"Small Caps\",command:\"smallCapsText\",disabled:!n},{type:\"separator\"},{type:\"button\",label:\"Blockquote\",command:\"insertBlockquote\",disabled:n},{type:\"button\",label:\"Bulleted List\",command:\"insertBulletedList\",disabled:n},{type:\"button\",label:\"Fork List\",command:\"insertForkList\",disabled:n},{type:\"button\",label:\"Numbered List\",command:\"insertNumberedList\",disabled:n},{type:\"button\",label:\"Section Break\",command:\"insertSectionBreak\",disabled:n}]},{type:\"menu\",icon:u.replace(/currentColor/g,t.foregroundColor),label:\"Link\",disabled:n,items:[{type:\"button\",label:\"Passage Link\",command:\"insertPassageLink\"},{type:\"button\",label:\"Restart Link\",command:\"insertRestartLink\"},{type:\"button\",label:\"Reveal Passage Link\",command:\"insertRevealPassageLink\"},{type:\"button\",label:\"Reveal Text Link\",command:\"insertRevealTextLink\"}]},{type:\"menu\",icon:s.replace(/currentColor/g,t.foregroundColor),label:\"Modifiers\",disabled:n,items:[{type:\"button\",label:\"If\",command:\"insertIf\"},{type:\"button\",label:\"If and Else\",command:\"insertIfElse\"},{type:\"button\",label:\"Unless\",command:\"insertUnless\"},{type:\"button\",label:\"Continue\",command:\"insertContinue\"},{type:\"separator\"},{type:\"button\",label:\"After Delay\",command:\"insertAfter\"},{type:\"button\",label:\"Append Text\",command:\"insertAppend\"},{type:\"button\",label:\"Note\",command:\"insertNote\"},{type:\"separator\"},{type:\"button\",label:\"JavaScript\",command:\"insertJs\"},{type:\"button\",label:\"CSS\",command:\"insertCss\"}]},{type:\"menu\",icon:c.replace(/currentColor/g,t.foregroundColor),label:\"Embed\",disabled:n,items:[{type:\"button\",label:\"Embed Passage\",command:\"insertEmbedPassage\"},{type:\"button\",label:\"Embed Image from Flickr\",command:\"insertImageFlickr\"},{type:\"button\",label:\"Embed Image from URL\",command:\"insertImageUrl\"},{type:\"button\",label:\"Embed Image from Unsplash\",command:\"insertImageUnsplash\"},{type:\"button\",label:\"Embed Ambient Sound\",command:\"insertEmbedAmbientSound\"},{type:\"button\",label:\"Embed Sound Effect\",command:\"insertEmbedSoundEffect\"},{type:\"button\",label:\"Embed YouTube Video\",command:\"insertEmbedYouTubeVideo\"}]},{type:\"menu\",icon:d.replace(/currentColor/g,t.foregroundColor),label:\"Input\",disabled:n,items:[{type:\"button\",label:\"Cycling Link\",command:\"insertCyclingLink\"},{type:\"button\",label:\"Dropdown Menu\",command:\"insertDropdownMenu\"},{type:\"button\",label:\"Text Input\",command:\"insertTextInput\"}]}]}},references:{parsePassageText:function(e){for(var t=[],n=0,o=[/\\{embed\\s+passage\\s*:\\s*['\"](.+?)['\"]\\s*}/g,/\\{link\\s+to\\s*:\\s*['\"](.+?)['\"]\\s*\\}/g,/\\{reveal\\s+link.+passage\\s*:\\s*['\"](.+?)['\"].*\\}/g];n<o.length;n++)for(var a=o[n],r=void 0;r=a.exec(e);)t.push(r[1]);return t}}}};n.default.editorExtensions={twine:m}}(this);\n","image":"logo.svg","name":"Chapbook","proofing":false,"version":"1.2.2"})